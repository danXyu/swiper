/*

twilio-rtc-conversations.js v0.8 (0.8.1.b1-eff9212)

Copyright (c) 2015 Twilio, Inc. All rights reserved. <https://twilio.com>

THIS SOFTWARE IS PROVIDED BY THE AUTHOR "AS IS" AND ANY EXPRESS OR IMPLIED
WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT
SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT
OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING
IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY
OF SUCH DAMAGE.

This software includes third party open source software components: SIP.js.
Each of these software components have their own license. Please see below.

--- begin SIP.js license ---

Name: SIP.js
Copyright (c) 2014 Junction Networks, Inc. <http://www.onsip.com>

License: The MIT License

Permission is hereby granted, free of charge, to any person obtaining
a copy of this software and associated documentation files (the
"Software"), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to
the following conditions:

The above copyright notice and this permission notice shall be
included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

~~~ SIP.js contains substantial portions of the JsSIP software under the following license: ~~~

Copyright (c) 2012-2013 Jos? Luis Mill?n - Versatica <http://www.versatica.com>

License: The MIT License

Permission is hereby granted, free of charge, to any person obtaining
a copy of this software and associated documentation files (the
"Software"), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to
the following conditions:

The above copyright notice and this permission notice shall be
included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

~~~ end JsSIP license ~~~

--- end SIP.js license ---
*/
(function e$$0(l,n,b){function h(e,a){if(!n[e]){if(!l[e]){var c="function"==typeof require&&require;if(!a&&c)return c(e,!0);if(f)return f(e,!0);c=Error("Cannot find module '"+e+"'");throw c.code="MODULE_NOT_FOUND",c;}c=n[e]={exports:{}};l[e][0].call(c.exports,function(a){var b=l[e][1][a];return h(b?b:a)},c,c.exports,e$$0,l,n,b)}return n[e].exports}for(var f="function"==typeof require&&require,e=0;e<b.length;e++)h(b[e]);return h})({1:[function(k,l,n){function b(e){if(e instanceof b)return e;if(!(this instanceof
b))return new b(e);f.call(this);var a=h(e),c=null,d=!1,m=!1,p=new Date(1E3*a.exp),w=a.grants||[];w.forEach(function(a){var b=a.res.match(/^sip:(.*)@/);b&&(c=b[1],d=-1!==a.act.indexOf("invite"),m=-1!==a.act.indexOf("listen"))});var z=this;setTimeout(function(){z.emit("expired",z)},p-Date.now());Object.defineProperties(this,{accountSid:{enumerable:!0,value:a.sub},address:{enumerable:!0,value:c},canInvite:{enumerable:!0,value:d},canListen:{enumerable:!0,value:m},expires:{enumerable:!0,value:p},grants:{enumerable:!0,
value:w},isExpired:{enumerable:!0,get:function(){return new Date>=p}},jwt:{enumerable:!0,value:e},signingKeySid:{enumerable:!0,value:a.iss}});return Object.freeze(this)}function h(b){b=b.split(".");if(3!==b.length)throw Error("Token is invalid or malformed");b=e.base64URL.decode(b[1]);return JSON.parse(b)}n=k("util").inherits;var f=k("events").EventEmitter,e=k("./util");n(b,f);l.exports=b},{"./util":20,events:30,util:34}],2:[function(k,l,n){function b(d,c){if(!(this instanceof b))return new b(d,c);
var e=this;f.call(this);var g=new Set,h=null,A=new Set,k=new a("Conversation",d._logLevel);Object.defineProperties(this,{_dialogs:{value:g},_endpoint:{value:d},_localMedia:{set:function(a){h=a}},_log:{value:k},localMedia:{enumerable:!0,get:function(){return h}},participants:{enumerable:!0,value:A},sid:{enumerable:!0,get:function(){var a=null;g.forEach(function(b){a=a||b.conversationSid});return a}}});c=c||[];c.forEach(function(a){e._addDialog(a)});return Object.freeze(this)}var h=k("./util/constants"),
f=k("events").EventEmitter;n=k("util").inherits;k("./media/track");var e=k("./participant"),g=k("q"),a=k("./util/log"),c=h.twilioErrors;n(b,f);b.prototype._addDialog=function(a){if(this._dialogs.has(a))return this;var b=this;this._localMedia=this.localMedia||a.localMedia;var c=new e(this,a);this._dialogs.add(a);this.participants.add(c);setTimeout(function(){b.emit("participantConnected",c);setTimeout(function(){c.on("trackAdded",function z(a){if(!b.participants.has(c))return c.removeListener("trackAdded",
z);b.emit("trackAdded",c,a)});c.on("trackRemoved",function A(a){if(!b.participants.has(c))return c.removeListener("trackRemoved",A);b.emit("trackRemoved",c,a)});c.media.audioTracks.forEach(function(a){c.emit("trackAdded",a)});c.media.videoTracks.forEach(function(a){c.emit("trackAdded",a)})})});a.once("ended",function(){b._removeDialog(a)});return this};b.prototype._removeDialog=function(a){var b=this,c=null;this.participants.forEach(function(e){e._dialog===a&&(c=e,b.participants.delete(c))});this._dialogs.delete(a);
this.emit("participantDisconnected",c);this._dialogs.size||this.emit("ended",this);return this};b.prototype.getStats=function(){var a=[];this._dialogs.forEach(function(b){a.push(b.getStats())});return g.all(a)};b.prototype.disconnect=function(){var a=this,b=[];this._dialogs.forEach(function(a){b.push(a.end())});return g.all(b).then(function(){return a})};b.prototype.invite=function(a){a||this._log.throw(c.INVALID_ARGUMENT,"No address was provided");var b=!!a.forEach;a=b?a:[a];var e;this._dialogs.forEach(function(a){e=
e||a});a=a.map(this._invite.bind(this,e));return b?a:a[0]};b.prototype._invite=function(a,b){function e(a){a.address===b&&(z.removeListener("participantConnected",e),f.resolve(a))}var f=g.defer(),z=this;this.on("participantConnected",e);setTimeout(function(){z.removeListener("participantConnected",e);var a=c.CONVERSATION_INVITE_FAILED.clone("Invite to Participant timed out.");z.emit("participantFailed",b,a);f.reject(a)},h.DEFAULT_CALL_TIMEOUT);a.refer(b).catch(function(a){z.emit("participantFailed",
b,a);z.removeListener("participantConnected",e);f.reject(a)});return f.promise};Object.freeze(b.prototype);l.exports=b},{"./media/track":6,"./participant":7,"./util/constants":19,"./util/log":21,events:30,q:35,util:34}],3:[function(k,l,n){function b(e,f){if(!(this instanceof b))return new b(e,f);var p=this;a.call(this);f=A.withDefaults(f,{debug:h.DEBUG,eventGateway:h.EVENT_GATEWAY,userAgent:w,logLevel:"warn"});var k=f.logLevel,v=new d("Endpoint",k);e=this._createToken(e,v);var l=null;f.iceServers&&
(A.isValidIceServerArray(f.iceServers)||v.throw(g.INVALID_ARGUMENT,"Invalid ICE Servers"),l=new m(f.iceServers));var l=(l||A.fetchIceServers(e,v)).then(function(a){a=A.separateIceServers(a);p._userAgent._stunServers=a.stunServers;p._userAgent._turnServers=a.turnServers}),E=new Set,n=new Set,y=f.eventGateway,x=new Set,I=!1,D=new Map,G=new Set,J=new f.userAgent(e,f);J.on("invite",function(a){var b=a.conversationSid,d=a.participantSid,e=a.cookie,f=p._pendingConversations.get(e);if(f)return a.accept({localMedia:f.conversation.localMedia}).then(f.onReceiveInvite).catch(function(a){a=
g.CONVERSATION_INVITE_FAILED.clone(a.message||a);f.conversation.emit("participantFailed",a)});if(E.has(e))return a.reject();var m=null;n.forEach(function(a){a.sid===b&&(m=m||a)});if(m)return a.accept({localMedia:m.localMedia}).then(m._addDialog.bind(m));if(G.has(b+d))return a.reject();var D=null;x.forEach(function(a){a.conversationSid===b&&a.participantSid===d&&(D=D||a)});if(D)return D._inviteServerTransactions.push(a);if(!p.isListening)return a.reject();var w=new c(p,a);x.add(w);w._promise.then(function(a){x.delete(w);
n.add(a);a.once("ended",function(){n.delete(a);p._unregisterIfNotNeeded()})},function(){x.delete(w);p._unregisterIfNotNeeded();G.add(b+d);setTimeout(function(){G.delete(b+d)},3*h.DEFAULT_CALL_TIMEOUT)});p.emit("invite",w)});J.on("dialogCreated",function(a){new z(y,a,k)});Object.defineProperties(this,{_canceledConversations:{value:E},_fetchIceServers:{value:l},_isListening:{set:function(a){I=a}},_isRegistered:{enumerable:!0,get:function(){return this._userAgent.isRegistered}},_log:{value:v},_logLevel:{value:k},
_pendingConversations:{value:D},_needsRegistration:{get:function(){return I||D.size||n.size||x.size||J.inviteClientTransactions.size}},_options:{value:f},_userAgent:{value:J},address:{enumerable:!0,get:function(){return this._userAgent.token.address}},conversations:{enumerable:!0,value:n},invites:{enumerable:!0,value:x},isListening:{enumerable:!0,get:function(){return I}},token:{enumerable:!0,get:function(){return this._userAgent.token}}});return Object.freeze(this)}n=k("util").inherits;var h=k("./util/constants"),
f=k("./conversation"),e=k("./util/cancelablepromise"),g=h.twilioErrors,a=k("events").EventEmitter;k("./webrtc/getusermedia");var c=k("./invite"),d=k("./util/log"),m=k("q"),p=k("./accesstoken"),w=k("./signaling/sipjsuseragent"),z=k("./statsreporter"),A=k("./util"),v=k("./media").LocalMedia;n(b,a);b.prototype.unlisten=function(){this._isListening=!1;return this._unregisterIfNotNeeded()};b.prototype._unregister=function(){if(!this._isRegistered)return new m(this);var a=this;return this._userAgent.unregister().then(function(){a._isListening=
!1;return a})};b.prototype.listen=function(a){return this._register(a).then(function(a){a._isListening=!0;return a})};b.prototype._register=function(a){var b=this;return this._fetchIceServers.then(function(){a=b._createToken.call(b,a);return b._userAgent.register(a)}).then(function(){return b},function(a){var c=A.getOrNull(a,"headers.X-Twilio-Error.0.raw");(a=a.cause)?b._log.throw(g.LISTEN_FAILED,"Received SIP error: "+a):b._log.throw(g.LISTEN_FAILED,"Gateway responded with: "+c)})};b.prototype.createConversation=
function(a,b){function c(a){z._addDialog(a);z.once("ended",function(){n.conversations.delete(z);n._unregisterIfNotNeeded()});n.conversations.add(z);a=k.promise;a.isFulfilled()||a.isRejected()||k.resolve(z)}var d=(b=A.withDefaults({},b,this._options))&&b.localMedia,p=b.localStreamConstraints,w=b.localStream;!d||d instanceof v||this._log.throw(g.INVALID_ARGUMENT,"Invalid local media");w&&"object"!==typeof w&&this._log.throw(g.INVALID_ARGUMENT,"Invalid local media stream");p&&"undefined"===typeof p.audio&&
"undefined"===typeof p.video&&this._log.throw(g.INVALID_ARGUMENT,"Invalid local media stream constraints");a||this._log.throw(g.INVALID_ARGUMENT,"No address was provided");a=a.forEach?a:[a];var z=new f(this),k=m.defer(),y=null,l=!1,n=this,D=this._userAgent;if(1<a.length){var G=A.makeUUID();b.cookie=G;this._pendingConversations.set(G,{conversation:z,onReceiveInvite:c});setTimeout(function(){n._pendingConversations.delete(G);n._canceledConversations.delete(G);n._unregisterIfNotNeeded()},3*h.DEFAULT_CALL_TIMEOUT)}(d?
new m(d):v.getLocalMedia(b)).catch(function(a){-1<["PermissionDeniedError","PERMISSION_DENIED"].indexOf(a.name)&&(a=g.MEDIA_ACCESS_DENIED);k.reject(a)}).then(function(a){z._localMedia=a;b.localMedia=a}).then(this._register.bind(this)).then(function(){if(l)throw Error("canceled");return y=D.invite(a,b)}).catch(function(a){switch(a.message){case "canceled":a="Conversation invite was canceled";break;case "rejected":a="Conversation invite was rejected or Participant does not exist";break;case "ignored":a=
"Conversation invite timed out";break;case "failed":a="Unable to reach Participant";break;default:a="An unknown error occurred"}k.reject(g.CONVERSATION_CREATE_FAILED.clone(a))}).then(c);d=new e(k.promise);d.catch(function(a){"canceled"===a.message&&(n._canceledConversations.add(G),n._pendingConversations.delete(G),y?y.cancel():l=!0,n._unregisterIfNotNeeded());n._log.throw(a)});return d};b.prototype._createToken=function(a,b){if(!a)return this.token;b=b||this._log;try{a=new p(a)}catch(c){b.throw(g.INVALID_TOKEN,
c.message)}var d=this;a.once("expired",function(a){a===d.token&&d.emit("error",g.TOKEN_EXPIRED)});return a};b.prototype._unregisterIfNotNeeded=function(){return this._needsRegistration?new m(this):this._unregister()};Object.freeze(b.prototype);l.exports=b},{"./accesstoken":1,"./conversation":2,"./invite":4,"./media":5,"./signaling/sipjsuseragent":15,"./statsreporter":17,"./util":20,"./util/cancelablepromise":18,"./util/constants":19,"./util/log":21,"./webrtc/getusermedia":25,events:30,q:35,util:34}],
4:[function(k,l,n){function b(a,d){if(!(this instanceof b))return new b(a,d);var m=this;f.call(this);var g=null,h=d.from,z=d.participantSid,A=d.to,k=e.defer(),l=[d];Object.defineProperties(this,{_conversation:{set:function(a){g=a},get:function(){return g}},_deferred:{value:k},_endpoint:{value:a},_inviteServerTransaction:{value:d},_inviteServerTransactions:{value:l},_promise:{value:k.promise},accepted:{enumerable:!0,get:function(){return l.reduce(function(a,b){return a||b.accepted},!1)}},canceled:{enumerable:!0,
get:function(){return l.reduce(function(a,b){return a&&b.canceled},!0)}},conversationSid:{enumerable:!0,value:d.conversationSid},from:{enumerable:!0,value:h},participantAddresses:{enumerable:!0,get:function(){return l.map(function(a){return a.from})}},participantSid:{value:z},rejected:{enumerable:!0,get:function(){return l.reduce(function(a,b){return a||b.accepted},!1)?!1:l.reduce(function(a,b){return a||b.rejected},!1)}},status:{enumerable:!0,get:function(){switch(!0){case this.accepted:return"accepted";
case this.rejected:return"rejected";case this.canceled:return"canceled";default:return"pending"}}},to:{enumerable:!0,value:A}});d.once("canceled",function(){m.emit("canceled",m)});return Object.freeze(this)}var h=k("./conversation"),f=k("events").EventEmitter;n=k("util").inherits;var e=k("q"),g=k("./util"),a=k("./media").LocalMedia;n(b,f);b.prototype.accept=function(b){var d=this;if(this.accepted)return new e(this._conversation);b=b||{};return a.getLocalMedia(b).then(function(a){b.localMedia=a;a=
d._inviteServerTransactions.map(function(a){return a.accept(b).then(function(a){d._conversation||(d._conversation=new h(d._endpoint),d._deferred.resolve(d._conversation));d._conversation._addDialog(a);return a})});return g.race(a).then(function(){setTimeout(function(){d.emit("accepted",d)});return d._conversation},function(a){setTimeout(function(){d.emit("failed",d)});d._deferred.reject(a);throw a;})})};b.prototype.reject=function(){var a=this;return this.rejected?new e(this):this._inviteServerTransaction.reject().then(function(){setTimeout(function(){a.emit("rejected",
a)});return a},function(b){setTimeout(function(){a.emit("rejected",a)});return a})};Object.freeze(b.prototype);l.exports=b},{"./conversation":2,"./media":5,"./util":20,events:30,q:35,util:34}],5:[function(k,l,n){function b(a){c.call(this);a=new Map;var b=new Set,d=new Set,e=new Set;Object.defineProperties(this,{attachments:{enumerable:!0,value:a},audioTracks:{enumerable:!0,value:b},mediaStreams:{enumerable:!0,value:d},muted:{enumerable:!0,get:function(){var a=!0;b.forEach(function(b){a=a&&b.muted});
return a},set:function(a){b.forEach(function(b){b.muted=a})}},paused:{enumerable:!0,get:function(){var a=!0;e.forEach(function(b){a=a&&b.paused});return a},set:function(a){e.forEach(function(b){b.paused=a})}},videoTracks:{enumerable:!0,value:e}});return this}function h(a,b){if(a.attachments.has(b))return b;var c=new Map;[a.audioTracks,a.videoTracks].forEach(function(d){d.forEach(function(d){a._attachTrack(b,c,d)},a)},a);a.on("trackAdded",function q(d){if(!a.attachments.has(b))return a.removeListener("trackAdded",
q);a._attachTrack(b,c,d)});a.attachments.set(b,c);return b}function f(a,b){if(!a.attachments.has(b))return b;var c=a.attachments.get(b);a.attachments.delete(b);c.forEach(function(d,e){a._detachTrack(b,c,e)});return b}function e(a){var b=[];a.attachments.forEach(function(c,d){b.push(d);f(a,d)});return b}function g(){if(!(this instanceof g))return new g;b.call(this);var a=null;Object.defineProperties(this,{_needs:{value:new Set},_nextUserMedia:{get:function(){return a},set:function(b){a=b}}});return Object.freeze(this)}
function a(a){this.mediaStreams.add(a);a.getAudioTracks().forEach(function(b){b=new p(a,b);this._addTrack(b)},this);a.getVideoTracks().forEach(function(b){b=new w(a,b);this._addTrack(b)},this);return this}var c=k("events").EventEmitter,d=k("../webrtc/getusermedia");n=k("util").inherits;var m=k("q");k=k("./track");var p=k.AudioTrack,w=k.VideoTrack;n(b,c);b.prototype._addStream=a;b.prototype._addTrack=function(a){var b=this;this.mediaStreams.add(a.mediaStream);("audio"===a.kind?this.audioTracks:this.videoTracks).add(a);
a.once("ended",function(c){b._removeTrack(a)});this.emit("trackAdded",a);return this};b.prototype._attachTrack=function(a,b,c){var d=this,e=c.attach();this instanceof g&&c instanceof p&&(e.muted=!0);a.appendChild(e);b.set(c,e);c.once("ended",function(){d._detachTrack(a,b,c)});return this};b.prototype._detachTrack=function(a,b,c){var d=b.get(c);if(!d)return this;c.detach(d);a.removeChild(d);b.delete(c);return this};b.prototype._removeTrack=function(a){this.mediaStreams.delete(a.mediaStream);("audio"===
a.kind?this.audioTracks:this.videoTracks).delete(a);this.emit("trackRemoved",a);return this};b.prototype.attach=function(a){if(a){if("string"===typeof a){if("undefined"===typeof document)throw Error("document is undefined");a=document.querySelector(a);if(!a)throw Error("document.querySelector returned nothing");return this.attach(a)}return h(this,a)}if("undefined"===typeof document)throw Error("document is undefined");return this.attach(document.createElement("div"))};b.prototype.detach=function(a){if(a){if("string"===
typeof a){if("undefined"===typeof document)throw Error("document is undefined");a=document.querySelector(a);if(!a)throw Error("document.querySelector returned nothing");}return f(this,a)}return e(this)};g.getLocalMedia=function(a){a=a||{};if(a.localMedia)return new m(a.localMedia);var b=new g;return a.localStream?(b.addStream(a.localStream),new m(b.addStream(a.localStream))):d(a.localStreamConstraints).then(function(a){return b.addStream(a)})};n(g,b);g.prototype.addMicrophone=function(){var a=this,
b=null;this.audioTracks.forEach(function(a){b=b||"microphone"===a.label&&a});return b?new m(b):d({audio:!0,video:!1}).then(function(b){b=new p(b,b.audioTracks[0]);a._addTrack(b);return b})};g.prototype.removeMicrophone=function(){var a=null;this.audioTracks.forEach(function(b){a=a||"microphone"===b.label&&b});return a?this._removeTrack(a):null};g.prototype.addCamera=function(){var a=this,b=null;this.videoTracks.forEach(function(a){b=b||"camera"===a.label&&a});return b?new m(b):d({audio:!1,video:!0}).then(function(b){b=
new w(b,b.videoTracks[0]);a._addTrack(b);return b})};g.prototype.removeCamera=function(){var a=null;this.videoTracks.forEach(function(b){a=a||"camera"===b.label&&b});return a?this._removeTrack(a):null};g.prototype.addStream=a;g.prototype._removeTrack=function(a){var c=this;b.prototype._removeTrack.call(this,a);a.mediaStream.stop();[this.audioTracks,this.videoTracks].forEach(function(b){b.forEach(function(b){b.mediaStream===a.mediaStream&&(this._removeTrack(b),this._needs.add(b.label),this._nextUserMedia||
(this._nextUserMedia=setTimeout(function(){c._nextUserMedia=null;var a=c._needs.has("camera");c._needs.delete("camera");var b=c._needs.has("microphone");c._needs.delete("microphone");if(a||b)a&&!b?c.addCamera():b&&!a?c.addMicrophone():d().then(c.addStream.bind(c))})))},this)},this);this._needs.delete(a.label);return a};g.prototype.stop=function(){[this.audioTracks,this.videoTracks].forEach(function(a){a.forEach(function(a){a.stop()})});return this};b.LocalMedia=g;l.exports=b},{"../webrtc/getusermedia":25,
"./track":6,events:30,q:35,util:34}],6:[function(k,l,n){function b(a,b){w.call(this);Object.defineProperties(this,{label:{enumerable:!0,value:"audio"===b.kind?"microphone":"camera"},kind:{enumerable:!0,value:b.kind},mediaStream:{enumerable:!0,value:a},mediaStreamTrack:{enumerable:!0,value:b}});var c=this;b.onended=function(){c.emit("ended",c)}}function h(a,c){if(!(this instanceof h))return new h(a,c);b.call(this,a,c);Object.defineProperties(this,{muted:{enumerable:!0,get:function(){return!c.enabled},
set:function(a){c.enabled=!a}},attachments:{enumerable:!0,value:new Set}});return Object.freeze(this)}function f(a,b){if("undefined"!==typeof window&&"undefined"!==typeof navigator)return"function"===typeof navigator.webkitGetUserMedia?a.src=(window.URL||window.webkitURL).createObjectURL(b):"function"===typeof navigator.mozGetUserMedia&&(a.mozSrcObject=b),a.play(),a;throw Error("Cannot attach to <audio> element");}function e(a,c){if(!(this instanceof e))return new e(a,c);b.call(this,a,c);Object.defineProperties(this,
{paused:{enumerable:!0,get:function(){return!c.enabled},set:function(a){c.enabled=!a}},attachments:{value:new Set}});a.onaddtrack=function(){this.attachments.forEach(function(b){d(this,b);g(b,a)},this)}.bind(this);return Object.freeze(this)}function g(a,b){if("undefined"!==typeof window&&"undefined"!==typeof navigator)return"function"===typeof navigator.webkitGetUserMedia?a.src=(window.URL||window.webkitURL).createObjectURL(b):"function"===typeof navigator.mozGetUserMedia&&(a.mozSrcObject=b),a.muted=
!0,a.play(),a;throw Error("Cannot attach to <video> element");}function a(a,b){if(b){if("string"===typeof b){if("undefined"===typeof document)throw Error("document is undefined");var d=document.querySelector(b);if(!d)throw Error("document.querySelector returned nothing");return c(a,d)}return c(a,b)}if("undefined"===typeof document)throw Error("document is undefined");d=document.createElement(a.kind);return c(a,d)}function c(a,b){if(a.attachments.has(b))return b;("audio"===a.kind?f:g)(b,a.mediaStream);
a.attachments.add(b);return b}function d(a,b){if(b){if("string"===typeof b){if("undefined"===typeof document)throw Error("document is undefined");var c=document.querySelector(b);if(!c)throw Error("document.querySelector returned nothing");return m(a,c)}return m(a,b)}return p(a)}function m(a,b){if(!a.attachments.has(b))return b;b.removeAttribute("src");a.attachments.delete(b);return b}function p(a){var b=[];a.attachments.forEach(function(c){b.push(c);m(a,c)});return b}var w=k("events").EventEmitter;
k=k("util").inherits;k(b,w);b.prototype.stop=function(){this.mediaStreamTrack.stop();return this};k(h,b);h.prototype.attach=function(b){return a(this,b)};h.prototype.detach=function(a){return d(this,a)};k(e,b);e.prototype.attach=function(b){return a(this,b)};e.prototype.detach=function(a){return d(this,a)};b.AudioTrack=h;b.VideoTrack=e;l.exports=b},{events:30,util:34}],7:[function(k,l,n){function b(e,g){if(!(this instanceof b))return new b(e,g);h.call(this);var a=g.remoteMedia,c=g&&f.getOrNull(g,
"session.mediaHandler.peerConnection");Object.defineProperties(this,{_dialog:{value:g},address:{enumerable:!0,value:g.remote},conversation:{enumerable:!0,value:e},media:{enumerable:!0,value:a},peerConnection:{enumerable:!0,value:c},sid:{enumerable:!0,value:null}});a.on("trackAdded",this.emit.bind(this,"trackAdded"));a.on("trackRemoved",this.emit.bind(this,"trackRemoved"));return Object.freeze(this)}var h=k("events").EventEmitter;n=k("util").inherits;var f=k("./util");n(b,h);Object.freeze(b.prototype);
l.exports=b},{"./util":20,events:30,util:34}],8:[function(k,l,n){function b(a,b,d,e,g,w,k){function l(a,b){if(v.ended)g.removeListener("trackAdded",t),g.removeListener("trackRemoved",r);else{var c=!a,d=k.getLocalStreams();if(d){var e=!1;d.forEach(function(a){a===b.mediaStream&&(e=!0)});a&&!e?(k.addStream(b.mediaStream),v._reinvite()):c&&e&&(k.removeStream(b.mediaStream),v._reinvite())}}}var v=this;f.call(this);var n=!1,q=null;Object.defineProperties(this,{_ended:{set:function(a){n=a}},_sampleInterval:{get:function(){return q},
set:function(a){q=a}},callSid:{enumerable:!0,value:e},conversationSid:{enumerable:!0,value:d},ended:{enumerable:!0,get:function(){return n}},localMedia:{enumerable:!0,value:g},peerConnection:{enumerable:!0,value:k},remote:{enumerable:!0,value:b},remoteMedia:{enumerable:!0,value:w},userAgent:{enumerable:!0,value:a}});var t=l.bind(null,!0),r=l.bind(null,!1);g.on("trackAdded",t);g.on("trackRemoved",r);try{h(this,1E3)}catch(u){throw console.error(u),u;}return this}function h(a,b){var d=a.peerConnection;
a._sampleInterval=setInterval(function(){e(d,function(b,c){b||a.emit("stats",c)})},b);a.once("ended",function(){a._sampleInterval&&(clearInterval(a._sampleInterval),a._sampleInterval=null)})}var f=k("events").EventEmitter,e=k("../webrtc/getstatistics");n=k("util").inherits;var g=k("q");n(b,f);b.prototype.end=function(){if(this.ended)throw Error("Dialog already ended");this._ended=!0;var a=this,b=g.defer();setTimeout(function(){b.resolve(a);a.emit("ended",a)});return b.promise};b.prototype._reinvite=
function(){var a=this,b=g.defer();setTimeout(function(){b.resolve(a);a.emit("reinvite",a)});return b.promise};b.prototype.refer=function(a){return this._refer(a).then(this._onReferSuccess.bind(this),this._onReferFailure.bind(this))};b.prototype._refer=function(a){var b=this,d=g.defer();setTimeout(function(){d.resolve(b)});return d.promise};b.prototype._onReferSuccess=function(){return this};b.prototype._onReferFailure=function(a){throw a;};b.prototype.getStats=function(){var a=this,b=g.defer();e(this.peerConnection,
function(d,e){if(d)return b.reject(d);b.resolve({callsid:a.callSid,samples:[e]})});return b.promise};l.exports=b},{"../webrtc/getstatistics":24,events:30,q:35,util:34}],9:[function(k,l,n){function b(b){var g=this;h.call(this);var a=!1,c=!1,d=!1,m=!1,p=null,w=f.defer(),k=w.promise.then(function(a){p=a;setTimeout(function(){g.emit("accepted",p)});return p},function(a){switch(!0){case g.canceled:setTimeout(function(){g.emit("canceled",a)});break;case g.rejected:setTimeout(function(){g.emit("rejected",
a)});break;default:setTimeout(function(){g.emit("failed",a)})}throw a;});Object.defineProperties(this,{_accepted:{set:function(b){a=b}},_canceled:{set:function(a){c=a}},_deferred:{value:w},_failed:{set:function(a){d=a}},_promise:{value:k},_rejected:{set:function(a){m=a}},accepted:{enumerable:!0,get:function(){return a}},canceled:{enumerable:!0,get:function(){return c}},dialog:{enumerable:!0,get:function(){return p}},failed:{enumerable:!0,get:function(){return d}},rejected:{enumerable:!0,get:function(){return m}},
userAgent:{enumerable:!0,value:b}});return this}var h=k("events").EventEmitter;n=k("util").inherits;var f=k("q");b._checkInviteTransactionState=function(b){if(b.accepted)throw Error("InviteTransaction already accepted");if(b.canceled)throw Error("InviteTransaction already canceled");if(b.rejected)throw Error("InviteTransaction already rejected");if(b.failed)throw Error("InviteTransaction failed");};n(b,h);b.prototype.then=function(b,f){return this._promise.then(b,f)};Object.freeze(b.prototype);l.exports=
b},{events:30,q:35,util:34}],10:[function(k,l,n){function b(b,g,a){h.call(this,b,g,a);a=f.withDefaults(a,{});var c=a.localMedia;Object.defineProperties(this,{_media:{set:function(a){c=a}},media:{enumerable:!0,get:function(){return c}},to:{enumerable:!0,value:g}})}n=k("util").inherits;var h=k("./");k("q");var f=k("../../util");n(b,h);b.prototype.cancel=function(){var b=this;setTimeout(function(){try{h._checkInviteTransactionState(b)}catch(f){return}b._canceled=!0;b._deferred.reject(b)});return this.then(function(){h._checkInviteTransactionState(b)},
function(b){if(b.canceled)return b;h._checkInviteTransactionState(b)})};l.exports=b},{"../../util":20,"./":9,q:35,util:34}],11:[function(k,l,n){function b(b,f,a,c,d,m){h.call(this,b);Object.defineProperties(this,{callSid:{enumerable:!0,value:c},conversationSid:{enumerable:!0,value:a},cookie:{enumerable:!0,value:m},from:{enumerable:!0,value:f},participantSid:{value:d}});return this}n=k("util").inherits;var h=k("./"),f=k("../../util");n(b,h);b.prototype.accept=function(b){var g=this;b=f.withDefaults(b,
{});setTimeout(function(){try{h._checkInviteTransactionState(g)}catch(a){return}g._accepted=!0;g._deferred.resolve(g.dialog)});return this.then(function(){h._checkInviteTransactionState(g);return g},function(a){throw a;})};b.prototype.reject=function(){var b=this;setTimeout(function(){try{h._checkInviteTransactionState(b)}catch(f){return}b._rejected=!0;b._deferred.reject(b)});return this.then(function(){h._checkInviteTransactionState(b)},function(b){throw b;})};l.exports=b},{"../../util":20,"./":9,
util:34}],12:[function(k,l,n){function b(f,w,k){if(!(this instanceof b))return new b(f,w,k);var l=this;e.call(this,f);k=c.withDefaults(k,{stunServers:f.stunServers,turnServers:f.turnServers});w=w.forEach?w:[w];var v=k.callTimeout||g.DEFAULT_CALL_TIMEOUT,n=null,q=null;f.connect().then(function(){return m.getLocalMedia(k)}).then(function(b){l._media=b;q=h(f,w,k,b);n=setTimeout(function(){l.cancel();l._deferred.reject(Error("ignored"))},v);var e=Date.now(),g=null;q.on("progress",function(a){180===a.statusCode&&
(g=Date.now())});q.once("accepted",function(m){var h=m.getHeader("X-Twilio-CallSid"),k=q.mediaHandler.peerConnection,y=new d(k);q.mediaHandler.on("addStream",function(a){y._addStream(a.stream)});var z=g?g-e:null;m=c.parseConversationSIDFromContactHeader(m.getHeader("Contact"));h=new a(f,w[0],m,h,b,y,k,q,z);clearTimeout(n);l._deferred.resolve(h)});q.once("rejected",function(){l._rejected=!0;clearTimeout(n);l._deferred.reject(Error("rejected"))});q.once("failed",function(){l.accepted&&l.canceled||(l._failed=
!0,clearTimeout(n),l._deferred.reject(Error("failed")))})}).then(null,function(a){l._failed=!0;n&&clearTimeout(n);l._deferred.reject(a)});Object.defineProperties(this,{session:{enumerable:!0,get:function(){return q}}});return Object.freeze(this)}function h(a,b,c,d){var e=a.token,f=b.map(function(a){return"sip:"+a+"@"+g.REGISTRAR_SERVER(e.accountSid)});b=f.shift();var m=[g.headers.X_TWILIO_TOKEN+": "+e.jwt,g.headers.X_TWILIO_CLIENT+": "+JSON.stringify({p:"browser"}),g.headers.X_TWILIO_CLIENTVERSION+
": "+g.CLIENT_VERSION];f.length&&(f=f.join(",")+";cookie="+c.cookie,m.push(g.headers.X_TWILIO_PARTICIPANTS+": "+f));var h=[];d.mediaStreams.forEach(function(a){h.push(a)});return a._ua.invite(b,{extraHeaders:m,inviteWithoutSdp:c.inviteWithoutSdp,media:{stream:h[0]},stunServers:c.stunServers,turnServers:c.turnServers})}n=k("util").inherits;var f=k("./"),e=k("./inviteclienttransaction");k("q");var g=k("../../util/constants"),a=k("../sipjsdialog"),c=k("../../util"),d=k("../../media"),m=d.LocalMedia;
n(b,e);b.prototype.cancel=function(){var a=this;setTimeout(function(){try{f._checkInviteTransactionState(a)}catch(b){return}a.session.once("cancel",function(){try{f._checkInviteTransactionState(a)}catch(b){return}a._canceled=!0;a._deferred.reject(a)});a.session.cancel()});return this.then(function(){f._checkInviteTransactionState(a)},function(a){if(a.canceled)return a;f._checkInviteTransactionState(a)})};Object.freeze(b.prototype);l.exports=b},{"../../media":5,"../../util":20,"../../util/constants":19,
"../sipjsdialog":14,"./":9,"./inviteclienttransaction":10,q:35,util:34}],13:[function(k,l,n){function b(a,d){if(!(this instanceof b))return new b(a,d);var m=d.request,k=m.from.uri.user,l=c.parseConversationSIDFromContactHeader(m.getHeader("Contact")),n=m.getHeader(f.X_TWILIO_CALLSID),q=m.getHeader(f.X_TWILIO_PARTICIPANTSID),m=(q=q?q.split(";"):null)?q[0]:null,t=/^cookie=([^\s]+)/i,q=q&&q[1]&&t.test(q[1])&&q[1].match(t)[1];e.call(this,a,k,l,n,m,q);Object.defineProperties(this,{session:{enumerable:!0,
value:d}});var r=this;d.once("cancel",function(){try{g._checkInviteTransactionState(r)}catch(a){return}r._canceled=!0;var b=h.CONVERSATION_JOIN_FAILED.clone("Incoming Invite was canceled by the sender");r._deferred.reject(b)});d.once("failed",function(a){try{g._checkInviteTransactionState(r)}catch(b){return}r._failed=!0;a=c.getOrNull(a,"headers.X-Twilio-Error.0.raw")||"An unknown error occurred";a=h.CONVERSATION_JOIN_FAILED.clone(a);r._deferred.reject(a)});return Object.freeze(this)}var h=k("../../util/constants").twilioErrors,
f=k("../../util/constants").headers;n=k("util").inherits;var e=k("./inviteservertransaction"),g=k("./"),a=k("../sipjsdialog");k("q");var c=k("../../util"),d=k("../../media"),m=d.LocalMedia;n(b,e);b.prototype.accept=function(b){var e=this;g._checkInviteTransactionState(this);b=c.withDefaults(b,{});m.getLocalMedia(b).then(function(c){var f=[];c.mediaStreams.forEach(function(a){f.push(a)});b.media=b.media||{};b.media.stream=f[0];e.session.accept(b);e.session.once("accepted",function(){try{g._checkInviteTransactionState(e)}catch(b){return}var f=
null,m=e.session.mediaHandler.peerConnection,p=new d(m);e.session.mediaHandler.on("addStream",function(a){a&&p._addStream(a.stream)});(m.getRemoteStreams()||[]).forEach(p._addStream,p);if(!e.session.hasOffer)f=new a(e.userAgent,e.from,e.conversationSid,e.callSid,c,p,m,e.session,null),e._accepted=!0,e._deferred.resolve(f);else if(e.session.hasOffer&&e.session.hasAnswer)f=new a(e.userAgent,e.from,e.conversationSid,e.callSid,c,p,m,e.session,null),e._accepted=!0,e._deferred.resolve(f);else if(e.session.hasOffer&&
!e.session.hasAnswer)e.session.mediaHandler.once("addStream",function(){f=new a(e.userAgent,e.from,e.conversationSid,e.callSid,c,p,m,e.session,null);e._accepted=!0;e._deferred.resolve(f)})})});return this};b.prototype.reject=function(){var a=this;setTimeout(function(){try{g._checkInviteTransactionState(a)}catch(b){return}a.session.once("rejected",function(){try{g._checkInviteTransactionState(a)}catch(b){return}a._rejected=!0;a._deferred.reject(a)});a.session.reject()});return this.then(function(){g._checkInviteTransactionState(a)},
function(a){if(a.rejected)return a;g._checkInviteTransactionState(a)})};Object.freeze(b.prototype);l.exports=b},{"../../media":5,"../../util":20,"../../util/constants":19,"../sipjsdialog":14,"./":9,"./inviteservertransaction":11,q:35,util:34}],14:[function(k,l,n){function b(f,a,c,d,m,p,w,k,l){if(!(this instanceof b))return new b(f,a,c,d,m,p,w,k,l);var v=this;h.call(this,f,a,c,d,m,p,w);Object.defineProperties(this,{inviteTo180:{enumerable:!0,value:l},session:{enumerable:!0,value:k}});w.oniceconnectionstatechange=
function(a){switch(a.target.iceConnectionState){case "failed":return v.emit("failed",e.ICE_CONNECT_FAILED);case "disconnected":return v.emit("disconnected",e.ICE_DISCONNECTED)}};k.once("failed",function(){v._ended=!0;v.emit("failed",v)});k.once("bye",function(){v._ended=!0;v.emit("ended",v)});return Object.freeze(this)}var h=k("./dialog");n=k("util").inherits;var f=k("q"),e=k("../util/constants").twilioErrors;n(b,h);b.prototype.end=function(){if(this.ended)throw Error("Dialog already ended");this._ended=
!0;var b=this,a=f.defer();b.session.once("bye",function(){a.resolve(b);b.emit("ended",b)});b.session.bye();return a.promise};b.prototype._reinvite=function(){this.session.sendReinvite()};b.prototype._refer=function(b){var a=this,c=f.defer();a.session.refer(b,{receiveResponse:function(b){202==b.status_code?c.resolve(a):c.reject(b)}});return c.promise};Object.freeze(b.prototype);l.exports=b},{"../util/constants":19,"./dialog":8,q:35,util:34}],15:[function(k,l,n){function b(a,p){if(!(this instanceof
b))return new b(a,p);var w=a.accountSid,k=a.address+"@"+f.REGISTRAR_SERVER(w);p=d.withDefaults(p,{debug:f.DEBUG,inviteClientTransactionFactory:g,registrarServer:f.REGISTRAR_SERVER(w),wsServer:f.WS_SERVER(w),uaFactory:e.UA});var w=/^wss:\/\//.test(p.wsServer),l=h.call(this,new p.uaFactory({autostart:!1,log:{builtinEnabled:p.debug},register:!1,registrarServer:p.registrarServer,traceSip:p.debug,uri:k,wsServers:p.wsServer,hackWssInTransport:w})),v=[],n=[];Object.defineProperties(this,{_ua:{value:l},_stunServers:{set:function(a){v=
a;d.overwriteArray(l.configuration.stunServers,v)}},_turnServers:{set:function(a){n=a;d.overwriteArray(l.configuration.turnServers,n)}},stunServers:{enumerable:!0,get:function(){return v}},turnServers:{enumerable:!0,get:function(){return n}}});c.call(this,a,p);return Object.freeze(this)}function h(b){var c=this;b.on("invite",function(b){b=new a(c,b);c._handleInviteServerTransaction(b)});return b}var f=k("../util/constants");n=k("util").inherits;k("q");k("../conversation");k("../accesstoken");var e=
k("sip.js");k("./sipjsdialog.js");var g=k("./invitetransaction/sipjsinviteclienttransaction.js"),a=k("./invitetransaction/sipjsinviteservertransaction"),c=k("./useragent"),d=k("../util");n(b,c);b.prototype._register=function(a){function b(){var e=d.makeRegisterHeaders(a);c._ua.register({extraHeaders:e})}var c=this;return this.connect().then(function(){return d.promiseFromEvents(b,c._ua,"registered","registrationFailed")})};b.prototype._unregister=function(){function a(){var e=d.makeRegisterHeaders(c);
b._ua.unregister({extraHeaders:e})}var b=this,c=b.token;return this.connect().then(function(){return d.promiseFromEvents(a,b._ua,"unregistered")})};b.prototype._connect=function(){var a=this;return d.promiseFromEvents(function(){a._ua.start()},this._ua,"connected","disconnected")};b.prototype._disconnect=function(){var a=this;return d.promiseFromEvents(function(){a._ua.stop()},this._ua,"disconnected")};Object.freeze(b.prototype);l.exports=b},{"../accesstoken":1,"../conversation":2,"../util":20,"../util/constants":19,
"./invitetransaction/sipjsinviteclienttransaction.js":12,"./invitetransaction/sipjsinviteservertransaction":13,"./sipjsdialog.js":14,"./useragent":16,q:35,"sip.js":70,util:34}],16:[function(k,l,n){function b(a,b){h.call(this);b=g.withDefaults(b,{inviteClientTransactionFactory:f});var d=!1,e=!1;Object.defineProperties(this,{_inviteClientTransactionFactory:{value:b.inviteClientTransactionFactory},_isConnected:{set:function(a){e=a}},_isRegistered:{set:function(a){d=a}},_token:{set:function(b){a=b}},
callTimeout:{value:b&&b.callTimeout},dialogs:{enumerable:!0,value:new Set},inviteClientTransactions:{enumerable:!0,value:new Set},inviteServerTransactions:{enumerable:!0,value:new Set},isConnected:{enumerable:!0,get:function(){return e}},isRegistered:{enumerable:!0,get:function(){return d}},token:{enumerable:!0,get:function(){return a}}});if(!this.stunServers){var p=[];Object.defineProperties(this,{_stunServers:{set:function(a){p=a}},stunServers:{enumerable:!0,get:function(){return p}}})}if(!this.turnServers){var w=
[];Object.defineProperties(this,{_turnServers:{set:function(a){w=a}},turnServers:{enumerable:!0,get:function(){return w}}})}return this}var h=k("events").EventEmitter;n=k("util").inherits;var f=k("./invitetransaction/inviteclienttransaction"),e=k("q");k("../accesstoken");var g=k("../util");k("../util/constants");n(b,h);b.prototype.connect=function(){if(this.isConnected){var a=e.defer();setTimeout(a.resolve);return a.promise}return this._connect().then(this._onConnectSuccess.bind(this),this._onConnectFailure.bind(this))};
b.prototype._connect=function(){var a=e.defer();setTimeout(a.resolve);return a.promise};b.prototype._onConnectSuccess=function(){this.isConnected||this.emit("connected",this);this._isConnected=!0;return this};b.prototype._onConnectFailure=function(a){throw a;};b.prototype.disconnect=function(){if(this.isConnected){var a=e.defer();setTimeout(a.resolve);return a.promise}return this._disconnect().then(this._onDisconnectSuccess.bind(this),this._onDisconnectFailure.bind(this))};b.prototype._disconnect=
function(){var a=e.defer();setTimeout(a.resolve);return a.promise};b.prototype._onDisconnectSuccess=function(){this.isConnected&&this.emit("disconnected",this);this._isConnected=!1;return this};b.prototype._onDisconnectFailure=function(a){throw a;};b.prototype.register=function(a){a=a||this.token;return this._register(a).then(this._onRegisterSuccess.bind(this,a),this._onRegisterFailure.bind(this))};b.prototype._register=function(a){a=e.defer();setTimeout(a.resolve);return a.promise};b.prototype._onRegisterSuccess=
function(a){this._isRegistered=!0;this._token=a;this.emit("registered",this);return this};b.prototype._onRegisterFailure=function(a){this.emit("registrationFailed",this);throw a;};b.prototype.unregister=function(){return this._unregister().then(this._onUnregisterSuccess.bind(this),this._onUnregisterFailure.bind(this))};b.prototype._unregister=function(){var a=e.defer();setTimeout(a.resolve);return a.promise};b.prototype._onUnregisterSuccess=function(){this._isRegistered=!1;this.emit("unregistered",
this);return this};b.prototype._onUnregisterFailure=function(a){throw a;};b.prototype.invite=function(a,b){b=g.extend({callTimeout:this.callTimeout,stunServers:this.stunServers,turnServers:this.turnServers},b);var d=new this._inviteClientTransactionFactory(this,a,b);this.inviteClientTransactions.add(d);d.then(this._onInviteSuccess.bind(this,d),this._onInviteFailure.bind(this,d));return d};b.prototype._onInviteSuccess=function(a,b){this.inviteClientTransactions.delete(a);return this._dialogCreated(b)};
b.prototype._onInviteFailure=function(a,b){this.inviteClientTransactions.delete(a);throw b;};b.prototype._handleInviteServerTransaction=function(a){this.inviteServerTransactions.add(a);a.then(this._onAcceptSuccess.bind(this,a),this._onAcceptFailure.bind(this,a));setTimeout(this.emit.bind(this,"invite",a))};b.prototype._onAcceptSuccess=function(a,b){this.inviteServerTransactions.delete(a);return this._dialogCreated(b)};b.prototype._dialogCreated=function(a){var b=this;this.dialogs.add(a);a.once("disconnected",
function(d){b.emit("dialogDisconnected",a)});a.once("failed",function(d){b.dialogs.delete(a);b.emit("dialogFailed",a)});a.once("ended",function(){b.dialogs.delete(a);b.emit("dialogEnded",a)});this.emit("dialogCreated",a);return a};b.prototype._onAcceptFailure=function(a,b){this.inviteServerTransactions.delete(a);throw b;};l.exports=b},{"../accesstoken":1,"../util":20,"../util/constants":19,"./invitetransaction/inviteclienttransaction":10,events:30,q:35,util:34}],17:[function(k,l,n){(function(b){function h(a,
b,c){if(!(this instanceof h))return new h(a,b,c);var d=this,g=!1,p=[],k=b.userAgent.token;c=new m("StatsReporter",c||"warn");Object.defineProperties(this,{_log:{value:c},dialog:{enumerable:!0,value:b},eventGateway:{enumerable:!0,value:a},token:{enumerable:!0,value:k}});b.on("stats",function(a){g&&10<=p.length?(a=p.splice(0,p.length),f(d,a)):p.push(a)});b.once("ended",function(){if(g){var a=p.splice(0,p.length);f(d,a)}});e(this).then(function(){g=!0})}function f(a,b){var c=a._log;return g("https://"+
a.eventGateway+"/v1/Calls/"+a.dialog.callSid+"/Statistics",a.token.jwt,{callsid:a.dialog.callSid,samples:b}).then(c.debug.bind(c,"Post to gateway succeeded"),c.debug.bind(c,"Post to gateway failed"))}function e(a){var b=a._log;return g("https://"+a.eventGateway+"/v1/Calls",a.token.jwt,{callsid:a.dialog.callSid,sip:{invite_to_180:a.dialog.inviteTo180},platform:{name:p.name,version:p.version,media_engine:"WebRTC",sdk:c}}).then(b.debug.bind(b,"Initial post to gateway succeeded"),b.debug.bind(b,"Initial post to gateway failed"))}
function g(a,b,c){return d.post({url:a,body:c,headers:{"Content-Type":"application/json","X-Twilio-Token":b}})}var a=k("./util"),c=k("../package.json").version,d=k("./util/request"),m=k("./util/log"),p={name:"Unknown",version:"0.0"};"undefined"!==typeof navigator&&navigator.userAgent?p=a.parseUserAgent(navigator.userAgent):"undefined"!==typeof b&&(p={name:"Node",version:b.version.node});l.exports=h}).call(this,k("_process"))},{"../package.json":72,"./util":20,"./util/log":21,"./util/request":22,_process:32}],
18:[function(k,l,n){function b(f){if(!(this instanceof b))return new b(f);if("function"===typeof f.cancel)return f;var e=h.defer(),g=h.all([f,e.promise]),a=h.defer();Object.defineProperties(this,{_deferred:{value:a}});f.then(function(){e.resolve()});g.then(function(b){a.resolve(b[0])},function(b){a.reject(b)})}var h=k("q");b.prototype.then=function(){var b=this._deferred.promise;return b.then.apply(b,arguments)};b.prototype.catch=function(){var b=this._deferred.promise;return b.catch.apply(b,arguments)};
b.prototype.cancel=function(){return this._deferred.reject(Error("canceled"))};l.exports=b},{q:35}],19:[function(k,l,n){n=k("q");l.exports.REALM=".dev";l.exports.CHUNDER_PORT=10193;l.exports.CLIENT_VERSION=2;l.exports.DEBUG=!1;l.exports.EVENT_GATEWAY="eventgw.twilio.com";l.exports.REGISTRAR_SERVER=function(b){return b+".endpoint.twilio.com"};l.exports.WS_SERVER=function(b){return"wss://"+b+".endpoint.twilio.com"};l.exports.DEFAULT_PEER_NAME="Anonymous";l.exports.DEFAULT_CALL_TIMEOUT=5E4;l.exports.DEFAULT_ICE_SERVERS=
new n([{url:"stun:global.stun.twilio.com:3478?transport=udp"}]);l.exports.headers={X_TWILIO_ACCOUNTSID:"X-Twilio-Accountsid",X_TWILIO_APIVERSION:"X-Twilio-Apiversion",X_TWILIO_CALLSID:"X-Twilio-Callsid",X_TWILIO_CLIENT:"X-Twilio-Client",X_TWILIO_CLIENTVERSION:"X-Twilio-Clientversion",X_TWILIO_PARAMS:"X-Twilio-Params",X_TWILIO_PARTICIPANTS:"X-Twilio-Participants",X_TWILIO_PARTICIPANTSID:"X-Twilio-ParticipantSid",X_TWILIO_TOKEN:"X-Twilio-Token",X_TWILIO_USERNAME:"X-Twilio-Username",X_TWILIO_PASSWORD:"X-Twilio-Password",
X_TWILIO_SESSION:"X-Twilio-Session"};l.exports.SOUNDS={incoming:"//static.twilio.com/libs/twiliojs/refs/82278dd/sounds/incoming.mp3",outgoing:"//static.twilio.com/libs/twiliojs/refs/82278dd/sounds/outgoing.mp3",disconnect:"//static.twilio.com/libs/twiliojs/refs/82278dd/sounds/disconnect.mp3",dtmf0:"//static.twilio.com/libs/twiliojs/refs/82278dd/sounds/dtmf-0.mp3",dtmf1:"//static.twilio.com/libs/twiliojs/refs/82278dd/sounds/dtmf-1.mp3",dtmf2:"//static.twilio.com/libs/twiliojs/refs/82278dd/sounds/dtmf-2.mp3",
dtmf3:"//static.twilio.com/libs/twiliojs/refs/82278dd/sounds/dtmf-3.mp3",dtmf4:"//static.twilio.com/libs/twiliojs/refs/82278dd/sounds/dtmf-4.mp3",dtmf5:"//static.twilio.com/libs/twiliojs/refs/82278dd/sounds/dtmf-5.mp3",dtmf6:"//static.twilio.com/libs/twiliojs/refs/82278dd/sounds/dtmf-6.mp3",dtmf7:"//static.twilio.com/libs/twiliojs/refs/82278dd/sounds/dtmf-7.mp3",dtmf8:"//static.twilio.com/libs/twiliojs/refs/82278dd/sounds/dtmf-8.mp3",dtmf9:"//static.twilio.com/libs/twiliojs/refs/82278dd/sounds/dtmf-9.mp3"};
var b=k("./twilioerror");l.exports.twilioErrors=Array.prototype.reduce.call([{name:"GATEWAY_CONNECTION_FAILED",message:"Could not connect to Twilio's servers"},{name:"GATEWAY_DISCONNECTED",message:"Connection to Twilio's servers was lost"},{name:"INVALID_ARGUMENT",message:"One or more arguments passed were invalid"},{name:"INVALID_TOKEN",message:"The token is invalid or malformed"},{name:"LISTEN_FAILED",message:"Failed to listen with the supplied token"},{name:"TOKEN_EXPIRED",message:"Endpoint's active token has expired"},
{name:"CONVERSATION_CREATE_FAILED",message:"Failed to create Conversation"},{name:"CONVERSATION_INVITE_FAILED",message:"Failed to add Participant to Conversation"},{name:"CONVERSATION_JOIN_FAILED",message:"Failed to join Conversation"},{name:"SDP_NEGOTIATION_FAILED",message:"Failed to negotiate media with Participant(s)"},{name:"ICE_CONNECT_FAILED",message:"Could not find match for all candidates"},{name:"ICE_DISCONNECTED",message:"Liveliness check has failed; may be recoverable"},{name:"MEDIA_ACCESS_DENIED",
message:"Could not get access to microphone or camera"}],function(h,f){h[f.name]=new b(f);return h},{})},{"./twilioerror":23,q:35}],20:[function(k,l,n){(function(b,h){function f(a){return 0===a.length?[[]]:[a].concat(f(a.slice(1)))}function e(a){var b=[],c=[];a&&a.forEach(function(a){if(a.url){var d=a.url.split(":")[0];"stun"===d||"stuns"===d?b.push(a):"turn"!==d&&"turns"!==d||c.push(a)}});b=b.map(function(a){return a.url.split("?")[0]});c=c.map(function(a){return{urls:[a.url.split("?")[0]],username:a.username,
password:a.credential}});return{stunServers:b,turnServers:c}}k("util");var g=k("./cancelablepromise"),a=k("./constants"),c=a.twilioErrors,d=a.headers,m=k("q"),p=k("./request"),w="function"===typeof atob?atob:function(a){return(new h(a,"base64")).toString("ascii")},z="function"===typeof btoa?btoa:function(a){return(new h(a)).toString("base64")},n={decode:w,encode:z},v={decode:function(a){var b={};return function(){var c=Array.prototype.slice.call(arguments,0);return b[c]?b[c]:b[c]=a.apply(null,c)}}(function(a){var b=
a.length%4;0<b&&(a+=Array(4-b+1).join("="));a=a.replace(/-/g,"+").replace(/_/g,"/");return w(a)})},C=new Map;l.exports.base64=n;l.exports.base64URL=v;l.exports.deepClone=function(a){return JSON.parse(JSON.stringify(a))};l.exports.fromURLFormEncoded=function(a){if(!a)return{};var b={};a=a.split("&");for(var c=0;c<a.length;c++){var d=a[c].split("="),e=decodeURIComponent(d[0]),d=d[1]?decodeURIComponent(d[1]):null;b[e]=d}return b};l.exports.makeRegisterHeaders=function(c){var e="undefined"===typeof navigator?
{}:navigator;return[d.X_TWILIO_TOKEN+": "+c.jwt,d.X_TWILIO_CLIENT+": "+JSON.stringify({p:"browser",v:b.env.SDK_VERSION||"unknown",browser:{userAgent:e.userAgent||"unknown",platform:e.platform||"unknown"},plugin:"rtc"}),d.X_TWILIO_CLIENTVERSION+": "+a.CLIENT_VERSION]};l.exports.makeTarget=function(b){return"sip:"+b+"@"+a.CHUNDER_HOST};l.exports.makeURI=function(b,c){return encodeURIComponent(c||a.DEFAULT_PEER_NAME)+"@"+b+".chunder.twilio.com"};l.exports.toURLFormEncoded=function(a){var b="",c;for(c in a)b+=
encodeURIComponent(c)+"="+encodeURIComponent(a[c]);return b};l.exports.requireNoBrowserify=function(a){return eval("require('"+a+"')")};l.exports.getKeys=function(a){var b=[],c;for(c in a)b.push(c);return b};l.exports.getValues=function(a){var b=[],c;for(c in a)b.push(a[c]);return b};l.exports.makeUUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)})};l.exports.race=function(a){function b(a){e&&(e=!1,
d.resolve(a))}function c(a){e&&(e=!1,d.reject(a))}var d=m.defer(),e=!0;a.forEach(function(a){a.done(b,c)});return d.promise};l.exports.any=function(a){function b(a){e&&(e=!1,d.resolve(a))}function c(b){f.push(b);f.length===a.length&&d.reject(b)}a=a.map(g);var d=m.defer();d.promise=new g(d.promise);var e=!0,f=[];a.forEach(function(a){a.then(b,c)});var p=d.promise.cancel.bind(d.promise);Object.defineProperties(d.promise,{cancel:{value:function(){e&&(e=!1,a.forEach(function(a){a.cancel()}),p())}}});
return d.promise};l.exports.withDefaults=function(a,b){a=a||{};b=Array.prototype.slice.call(arguments,1);b.forEach(function(b){var c=a,d;for(d in b)d in c||(c[d]=b[d])});return a};l.exports.extend=function(a,b){a=a||{};b=Array.prototype.slice.call(arguments,1);b.forEach(function(b){var c=a,d;for(d in b)c[d]=b[d]});return a};l.exports.tails=f;l.exports.sessionRegistry=C;l.exports.return=function(a){return function(){return a}};l.exports.separateIceServers=e;l.exports.getStunServers=function(a){return e(a).stunServers};
l.exports.getTurnServers=function(a){return e(a).turnServers};l.exports.promiseFromEvents=function(a,b,c,d){function e(){var a=[].slice.call(arguments);d&&b.removeListener(d,f);g.resolve.apply(null,a)}function f(){var a=[].slice.call(arguments);b.removeListener(c,e);g.reject.apply(null,a)}var g=m.defer();b.once(c,e);if(d)b.once(d,f);a();return g.promise};l.exports.parseConversationSIDFromContactHeader=function(a){return(a=a.match(/<sip:(.*)@(.*)$/))?a[1]:null};l.exports.emitNext=function(){var a=
[].slice.call(arguments),b=a[0],a=a.slice(1);setTimeout(function(){b.emit.call(b,a)});return b};l.exports.getOrNull=function(a,b){return b.split(".").reduce(function(a,b){return a?a[b]:null},a)};l.exports.isValidIceServerArray=function(a){return"undefined"===typeof a.forEach?!1:a.reduce(function(a,b){return a&&"undefined"!==typeof b.url},!0)};l.exports.parseUserAgent=function(a){var b=a.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)\.(\d+)/i)||[],b={name:b[1],version:b[2]+"."+
b[3]};if(/trident/i.test(b.name))return a=/\brv[ :]+(\d+)\.(\d+)/g.exec(a)||[],{name:"IE",version:a[1]?a[1]+"."+a[2]:""};if("Chrome"===b.name&&(a=a.match(/\b(OPR|Edge)\/(\d+)\.(\d+)/),null!==a))return{name:"Opera",version:a[2]+"."+a[3]};"MSIE"===b.name&&(b.name="IE");return b};l.exports.fetchIceServers=function(b,d,e){b={url:"https://"+(e||"api.twilio.com")+"/2010-04-01/Accounts/"+b.accountSid+"/Tokens.json",headers:{Authorization:"Basic "+z("Token:"+b.jwt)}};return p.post(b).then(function(a){return JSON.parse(a).ice_servers},
function(b){d&&d.warn(c.ICE_FETCH_FAILED,"Failed to fetch ephemeral TURN server credential",b);return a.DEFAULT_ICE_SERVERS})};l.exports.overwriteArray=function(a,b){a.splice(0,a.length);b.forEach(function(b){a.push(b)})}}).call(this,k("_process"),k("buffer").Buffer)},{"./cancelablepromise":18,"./constants":19,"./request":22,_process:32,buffer:26,q:35,util:34}],21:[function(k,l,n){function b(f,e){if(!(this instanceof b))return new b(f);e=e?b.getLevelByName(e):b.INFO;Object.defineProperties(this,{logLevel:{value:e},
name:{value:f}})}k("./");k("./twilioerror");var h=k("./constants").twilioErrors;Object.defineProperties(b,{DEBUG:{value:0},INFO:{value:1},WARN:{value:2},ERROR:{value:3},OFF:{value:4},_levels:{value:[{name:"DEBUG",logFn:console.log},{name:"INFO",logFn:console.info},{name:"WARN",logFn:console.warn},{name:"ERROR",logFn:console.error},{name:"OFF",logFn:function(){}}]}});b.getLevelByName=function(f){if(!isNaN(f))return parseInt(f,10);f=f.toUpperCase();if(-1===["OFF","ERROR","WARN","INFO","DEBUG"].indexOf(f))throw h.INVALID_ARGUMENT.clone('Log level must be one of: ["off", "error", "warn", "info", "debug"]');
return b[f]};b.prototype.log=function(f,e){this.logLevel<=f&&b._levels[f].logFn.apply(console,[this.name,b._levels[f].name].concat(e));return this};b.prototype.debug=function(){return this.log.call(this,b.DEBUG,[].slice.call(arguments))};b.prototype.info=function(){return this.log.call(this,b.INFO,[].slice.call(arguments))};b.prototype.warn=function(){return this.log.call(this,b.WARN,[].slice.call(arguments))};b.prototype.error=function(){return this.log.call(this,b.ERROR,[].slice.call(arguments))};
b.prototype.throw=function(f,e){f.clone&&(f=f.clone(e));this.log.call(this,b.ERROR,f);throw f;};l.exports=b},{"./":20,"./constants":19,"./twilioerror":23}],22:[function(k,l,n){function b(b,g){var a=h.defer(),c=new f;c.open(b,g.url,!0);c.onreadystatechange=function(){4===c.readyState&&(200<=c.status&&300>c.status?a.resolve(c.responseText):a.reject(c.responseText))};for(var d in g.headers)c.setRequestHeader(d,g.headers[d]);c.send(JSON.stringify(g.body));return a.promise}var h=k("q"),f="undefined"===
typeof XMLHttpRequest?k("xmlhttprequest").XMLHttpRequest:XMLHttpRequest;b.get=function(e){return b("GET",e)};b.post=function(e){return b("POST",e)};l.exports=b},{q:35,xmlhttprequest:71}],23:[function(k,l,n){function b(b,f){Object.defineProperties(this,{_errorData:{value:b},name:{value:b.name},message:{value:f||b.message}})}k=k("util").inherits;k(b,Error);b.prototype.toString=function(){return[this.name,this.message].join(" | ")};b.prototype.clone=function(h){return new b(this._errorData,h)};l.exports=
b},{util:34}],24:[function(k,l,n){function b(a,b){var c=[],d=null,f=[],g=null;a.result().forEach(function(a){var b=null;switch(a.type){case "googCandidatePair":a:{for(var b={},p={},w=a.names(),k=a.timestamp?Math.floor(a.timestamp/1E3):null,E=0;E<w.length;E++){var l=w[E],y=a.stat(l);switch(l){case "googActiveConnection":if("true"!==y){b=null;break a}break;case "googChannelId":b.connection=y;break;case "googLocalAddress":y.split&&(l=y.split(":"),m(b,"local","address",l[0]),m(b,"local","port",Number(l[1])));
break;case "googLocalCandidateType":m(b,"local","type",y);break;case "googRemoteAddress":y.split&&(l=y.split(":"),m(b,"remote","address",l[0]),m(b,"remote","port",Number(l[1])));break;case "googRemoteCandidateType":m(b,"remote","type",y);break;case "googRtt":b.rtt=Number(y);break;case "":break;default:p[l]=y}}b.timestamp=k;b=e(b,p)}b&&(d=d||b.known);break;case "ssrc":b=h(a);c.push(b.known);break;default:f.push(a)}b&&b.known&&"timestamp"in b.known&&(g=g||b.known.timestamp,delete b.known.timestamp)});
b(null,{timestamp:g,tracks:c,transport:d})}function h(a){var b={},c={},d=a.names(),f=null,g=null,h=a.timestamp?Math.floor(a.timestamp/1E3):null;d.forEach(function(d){var e=a.stat(d);switch(d){case "audioInputLevel":g="audio";m(b,"audio","inlvl",Number(e));break;case "audioOutputLevel":g="audio";m(b,"audio","outlvl",Number(e));break;case "bytesReceived":f="receiving";m(b,"bytes","recv",Number(e));break;case "bytesSent":f="sending";m(b,"bytes","sent",Number(e));break;case "googCodecName":""!==e&&(b.codecName=
e);break;case "googFrameHeightReceived":f="receiving";g="video";m(b,"video","height_recv",Number(e));break;case "googFrameHeightSent":f="sending";g="video";m(b,"video","height_sent",Number(e));break;case "googFrameWidthReceived":f="receiving";g="video";m(b,"video","width_recv",Number(e));break;case "googFrameWidthSent":f="sending";g="video";m(b,"video","width_sent",Number(e));break;case "googFrameRateDecoded":f="receiving";g="video";m(b,"video","fps_recv",Number(e));break;case "googFrameRateSent":f=
"sending";g="video";m(b,"video","fps_sent",Number(e));break;case "googJitterBufferMs":b.googJitterBufferMs=Number(e);break;case "googJitterReceived":d=Number(e);-1!==d&&(b.jitter=d);break;case "googRtt":d=Number(e);-1!==d&&(b.rtt=d);break;case "packetsLost":f="sending";-1!==Number(e)&&m(b,"packets","lost",Number(e));break;case "packetsReceived":f="receiving";m(b,"packets","recv",Number(e));break;case "packetsSent":f="sending";m(b,"packets","sent",Number(e));break;case "ssrc":b[d]=e;break;case "transportId":b.connection=
e;break;default:c[d]=e}});f&&(b.direction=f);g&&(b.media=g);b.timestamp=h;return e(b,c)}function f(a,b){var c=[],f=[],m=null,h={},k={},l;a.forEach(function(a){var b=null;switch(a.type){case "inboundrtp":var d={direction:"receiving"},b={},g;for(g in a){var p=a[g];switch(g){case "mozRtt":d.rtt=p;break;case "timestamp":d[g]=Math.floor(p/1E3);break;case "jitter":d[g]=1E3*p;break;case "framerateMean":d.fps=Math.round(p);break;case "mediaType":d.media=p;break;case "bytesReceived":case "packetsLost":case "packetsReceived":case "ssrc":d[g]=
p;break;default:b[g]=p}}b=e(d,b);break;case "outboundrtp":if(!1===a.isRemote){g={direction:"sending"};b={};for(d in a)switch(p=a[d],d){case "timestamp":g[d]=Math.floor(p/1E3);break;case "mediaType":g.media=p;break;case "bytesSent":case "packetsSent":case "ssrc":g[d]=p;break;default:b[d]=p}b=e(g,b)}break;case "candidatepair":g=l&&l.componentId;!a.selected||g&&-1!==g.indexOf("video")||(l=a);break;case "localcandidate":h[a.id]=a;break;case "remotecandidate":k[a.id]=a;break;default:f.push(a)}b&&(m=m||
b.known.timestamp,delete b.known.timestamp,c.push(b))});if(0===c.length||0===(c=g(c)).length)return b(null,{timestamp:m,ssrcs:[]});var n=h[l.localCandidateId],u=k[l.remoteCandidateId],n={local:{address:n.ipAddress,port:n.portNumber,type:"host"===n.candidateType?"local":n.candidateType},remote:{address:u.ipAddress,port:u.portNumber,type:"host"===u.candidateType?"local":u.candidateType}},n={timestamp:m,tracks:c.map(d),transport:n};b(null,n)}function e(b,d){var c=null;a(b)||(c=c||{},c.known=b);a(d)||
(c=c||{},c.unknown=d);return c}function g(a){for(var b=[],c=0;c<a.length;c++){var d=a[c];d.known&&b.push(d.known)}return b}function a(a){if(!a)return!0;for(var b in a)return!1;return!0}function c(a,b){return function(){var c=Array.prototype.slice.call(arguments);c.push(b);return a.apply(null,c)}}function d(a){var b={ssrc:a.ssrc,media:a.media,direction:a.direction,codecName:a.codecName,packets:{lost:a.packetsLost,recvtot:a.packetsReceived,senttot:a.packetsSent},bytes:{recvtot:a.bytesReceived,senttot:a.bytesSent},
jitter:a.jitter,rtt:a.rtt};if("audioInputLevel"in a||"audioOutputLevel"in a)b.audio={inlvl:a.audioInputLevel,outlvl:a.audioOutputLevel};if("fps"in a||"width"in a||"height"in a)b.video={fps:a.fps,width:a.width,height:a.height};return b}function m(){var a=[].slice.call(arguments,0),b=a[0],c=a.slice(1,a.length-1),d=a[a.length-1],e=b;c.forEach(function(a,b){var f=b==c.length-1?d:{};e=e[a]=e[a]||f});return b}l.exports=function(a,d){var e=Error("WebRTC statistics are unsupported");null===a||"undefined"===
typeof navigator||"function"!==typeof a.getStats?d(e):navigator.webkitGetUserMedia?a.getStats(c(b,d),d):navigator.mozGetUserMedia?a.getStats(null,c(f,d),d):d(e)}},{}],25:[function(k,l,n){var b=k("q");l.exports=function(h){var f=b.defer();h=h||{audio:!0,video:!0};var e=f.resolve.bind(f),g=f.reject.bind(f);"undefined"!==typeof window&&"undefined"!==typeof navigator?"function"===typeof navigator.webkitGetUserMedia?navigator.webkitGetUserMedia(h,e,g):"function"===typeof navigator.mozGetUserMedia&&navigator.mozGetUserMedia(h,
e,g):g(Error("getUserMedia is not supported"));return f.promise}},{q:35}],26:[function(k,l,n){function b(d){if(!(this instanceof b))return 1<arguments.length?new b(d,arguments[1]):new b(d);this.length=0;this.parent=void 0;if("number"===typeof d){var c;c=f(this,0>d?0:e(d)|0);if(!b.TYPED_ARRAY_SUPPORT)for(var g=0;g<d;g++)c[g]=0;return c}if("string"===typeof d){c=this;g=1<arguments.length?arguments[1]:"utf8";if("string"!==typeof g||""===g)g="utf8";var m=a(d,g)|0;c=f(c,m);c.write(d,g);return c}return h(this,
d)}function h(a,d){if(b.isBuffer(d)){var c=a,g=e(d.length)|0,c=f(c,g);d.copy(c,0,0,g);return c}if(E(d)){for(var c=a,g=e(d.length)|0,c=f(c,g),m=0;m<g;m+=1)c[m]=d[m]&255;return c}if(null==d)throw new TypeError("must start with number, buffer, array or string");if("undefined"!==typeof ArrayBuffer&&d.buffer instanceof ArrayBuffer){c=a;g=e(d.length)|0;c=f(c,g);for(m=0;m<g;m+=1)c[m]=d[m]&255;return c}if(d.length){c=a;g=e(d.length)|0;c=f(c,g);for(m=0;m<g;m+=1)c[m]=d[m]&255;return c}c=a;m=0;"Buffer"===d.type&&
E(d.data)&&(g=d.data,m=e(g.length)|0);for(var c=f(c,m),p=0;p<m;p+=1)c[p]=g[p]&255;return c}function f(a,c){b.TYPED_ARRAY_SUPPORT?a=b._augment(new Uint8Array(c)):(a.length=c,a._isBuffer=!0);0!==c&&c<=b.poolSize>>>1&&(a.parent=y);return a}function e(a){if(a>=H)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+H.toString(16)+" bytes");return a|0}function g(a,c){if(!(this instanceof g))return new g(a,c);var d=new b(a,c);delete d.parent;return d}function a(a,b){"string"!==
typeof a&&(a=String(a));if(0===a.length)return 0;switch(b||"utf8"){case "ascii":case "binary":case "raw":return a.length;case "ucs2":case "ucs-2":case "utf16le":case "utf-16le":return 2*a.length;case "hex":return a.length>>>1;case "utf8":case "utf-8":return C(a).length;case "base64":return u.toByteArray(v(a)).length;default:return a.length}}function c(a,b,c){if(0!==a%1||0>a)throw new RangeError("offset is not uint");if(a+b>c)throw new RangeError("Trying to access beyond buffer length");}function d(a,
c,d,e,f,g){if(!b.isBuffer(a))throw new TypeError("buffer must be a Buffer instance");if(c>f||c<g)throw new RangeError("value is out of bounds");if(d+e>a.length)throw new RangeError("index out of range");}function m(a,b,c,d){0>b&&(b=65535+b+1);for(var e=0,f=Math.min(a.length-c,2);e<f;e++)a[c+e]=(b&255<<8*(d?e:1-e))>>>8*(d?e:1-e)}function p(a,b,c,d){0>b&&(b=4294967295+b+1);for(var e=0,f=Math.min(a.length-c,4);e<f;e++)a[c+e]=b>>>8*(d?e:3-e)&255}function w(a,b,c,d,e,f){if(b>e||b<f)throw new RangeError("value is out of bounds");
if(c+d>a.length)throw new RangeError("index out of range");if(0>c)throw new RangeError("index out of range");}function z(a,b,c,d,e){e||w(a,b,c,4,3.4028234663852886E38,-3.4028234663852886E38);F.write(a,b,c,d,23,4);return c+4}function A(a,b,c,d,e){e||w(a,b,c,8,1.7976931348623157E308,-1.7976931348623157E308);F.write(a,b,c,d,52,8);return c+8}function v(a){a=a.trim?a.trim():a.replace(/^\s+|\s+$/g,"");a=a.replace(I,"");if(2>a.length)return"";for(;0!==a.length%4;)a+="=";return a}function C(a,b){b=b||Infinity;
for(var c,d=a.length,e=null,f=[],g=0;g<d;g++){c=a.charCodeAt(g);if(55295<c&&57344>c)if(e)if(56320>c){-1<(b-=3)&&f.push(239,191,189);e=c;continue}else c=e-55296<<10|c-56320|65536,e=null;else{56319<c?-1<(b-=3)&&f.push(239,191,189):g+1===d?-1<(b-=3)&&f.push(239,191,189):e=c;continue}else e&&(-1<(b-=3)&&f.push(239,191,189),e=null);if(128>c){if(0>--b)break;f.push(c)}else if(2048>c){if(0>(b-=2))break;f.push(c>>6|192,c&63|128)}else if(65536>c){if(0>(b-=3))break;f.push(c>>12|224,c>>6&63|128,c&63|128)}else if(2097152>
c){if(0>(b-=4))break;f.push(c>>18|240,c>>12&63|128,c>>6&63|128,c&63|128)}else throw Error("Invalid code point");}return f}function q(a){for(var b=[],c=0;c<a.length;c++)b.push(a.charCodeAt(c)&255);return b}function t(a,b,c,d){for(var e=0;e<d&&!(e+c>=b.length||e>=a.length);e++)b[e+c]=a[e];return e}function r(a){try{return decodeURIComponent(a)}catch(b){return String.fromCharCode(65533)}}var u=k("base64-js"),F=k("ieee754"),E=k("is-array");n.Buffer=b;n.SlowBuffer=g;n.INSPECT_MAX_BYTES=50;b.poolSize=8192;
var H=1073741823,y={};b.TYPED_ARRAY_SUPPORT=function(){try{var a=new ArrayBuffer(0),b=new Uint8Array(a);b.foo=function(){return 42};return 42===b.foo()&&"function"===typeof b.subarray&&0===(new Uint8Array(1)).subarray(1,1).byteLength}catch(c){return!1}}();b.isBuffer=function(a){return!(null==a||!a._isBuffer)};b.compare=function(a,c){if(!b.isBuffer(a)||!b.isBuffer(c))throw new TypeError("Arguments must be Buffers");if(a===c)return 0;for(var d=a.length,e=c.length,f=0,g=Math.min(d,e);f<g&&a[f]===c[f];)++f;
f!==g&&(d=a[f],e=c[f]);return d<e?-1:e<d?1:0};b.isEncoding=function(a){switch(String(a).toLowerCase()){case "hex":case "utf8":case "utf-8":case "ascii":case "binary":case "base64":case "raw":case "ucs2":case "ucs-2":case "utf16le":case "utf-16le":return!0;default:return!1}};b.concat=function(a,c){if(!E(a))throw new TypeError("list argument must be an Array of Buffers.");if(0===a.length)return new b(0);if(1===a.length)return a[0];var d;if(void 0===c)for(d=c=0;d<a.length;d++)c+=a[d].length;var e=new b(c),
f=0;for(d=0;d<a.length;d++){var g=a[d];g.copy(e,f);f+=g.length}return e};b.byteLength=a;b.prototype.length=void 0;b.prototype.parent=void 0;b.prototype.toString=function(a,b,c){var d=!1;b|=0;c=void 0===c||Infinity===c?this.length:c|0;a||(a="utf8");0>b&&(b=0);c>this.length&&(c=this.length);if(c<=b)return"";for(;;)switch(a){case "hex":a=b;b=this.length;if(!a||0>a)a=0;if(!c||0>c||c>b)c=b;for(b="";a<c;a++)d=this[a],d=16>d?"0"+d.toString(16):d.toString(16),b+=d;return b;case "utf8":case "utf-8":a=b;d=
b="";for(c=Math.min(this.length,c);a<c;a++)127>=this[a]?(b+=r(d)+String.fromCharCode(this[a]),d=""):d+="%"+this[a].toString(16);return b+r(d);case "ascii":a=b;b="";for(c=Math.min(this.length,c);a<c;a++)b+=String.fromCharCode(this[a]&127);return b;case "binary":a=b;b="";for(c=Math.min(this.length,c);a<c;a++)b+=String.fromCharCode(this[a]);return b;case "base64":return a=b,c=0===a&&c===this.length?u.fromByteArray(this):u.fromByteArray(this.slice(a,c)),c;case "ucs2":case "ucs-2":case "utf16le":case "utf-16le":c=
this.slice(b,c);a="";for(b=0;b<c.length;b+=2)a+=String.fromCharCode(c[b]+256*c[b+1]);return a;default:if(d)throw new TypeError("Unknown encoding: "+a);a=(a+"").toLowerCase();d=!0}};b.prototype.equals=function(a){if(!b.isBuffer(a))throw new TypeError("Argument must be a Buffer");return this===a?!0:0===b.compare(this,a)};b.prototype.inspect=function(){var a="",b=n.INSPECT_MAX_BYTES;0<this.length&&(a=this.toString("hex",0,b).match(/.{2}/g).join(" "),this.length>b&&(a+=" ... "));return"<Buffer "+a+">"};
b.prototype.compare=function(a){if(!b.isBuffer(a))throw new TypeError("Argument must be a Buffer");return this===a?0:b.compare(this,a)};b.prototype.indexOf=function(a,c){function d(a,b,c){for(var e=-1,f=0;c+f<a.length;f++)if(a[c+f]===b[-1===e?0:f-e]){if(-1===e&&(e=f),f-e+1===b.length)return c+e}else e=-1;return-1}2147483647<c?c=2147483647:-2147483648>c&&(c=-2147483648);c>>=0;if(0===this.length||c>=this.length)return-1;0>c&&(c=Math.max(this.length+c,0));if("string"===typeof a)return 0===a.length?-1:
String.prototype.indexOf.call(this,a,c);if(b.isBuffer(a))return d(this,a,c);if("number"===typeof a)return b.TYPED_ARRAY_SUPPORT&&"function"===Uint8Array.prototype.indexOf?Uint8Array.prototype.indexOf.call(this,a,c):d(this,[a],c);throw new TypeError("val must be string, number or Buffer");};b.prototype.get=function(a){console.log(".get() is deprecated. Access using array indexes instead.");return this.readUInt8(a)};b.prototype.set=function(a,b){console.log(".set() is deprecated. Access using array indexes instead.");
return this.writeUInt8(a,b)};b.prototype.write=function(a,b,c,d){if(void 0===b)d="utf8",c=this.length,b=0;else if(void 0===c&&"string"===typeof b)d=b,c=this.length,b=0;else if(isFinite(b))b|=0,isFinite(c)?(c|=0,void 0===d&&(d="utf8")):(d=c,c=void 0);else{var e=d;d=b;b=c|0;c=e}e=this.length-b;if(void 0===c||c>e)c=e;if(0<a.length&&(0>c||0>b)||b>this.length)throw new RangeError("attempt to write outside buffer bounds");d||(d="utf8");for(e=!1;;)switch(d){case "hex":b=Number(b)||0;d=this.length-b;c?(c=
Number(c),c>d&&(c=d)):c=d;d=a.length;if(0!==d%2)throw Error("Invalid hex string");c>d/2&&(c=d/2);for(d=0;d<c;d++){e=parseInt(a.substr(2*d,2),16);if(isNaN(e))throw Error("Invalid hex string");this[b+d]=e}return d;case "utf8":case "utf-8":return t(C(a,this.length-b),this,b,c);case "ascii":return t(q(a),this,b,c);case "binary":return t(q(a),this,b,c);case "base64":return t(u.toByteArray(v(a)),this,b,c);case "ucs2":case "ucs-2":case "utf16le":case "utf-16le":d=this.length-b;for(var f=void 0,f=e=void 0,
g=[],m=0;m<a.length&&!(0>(d-=2));m++)f=a.charCodeAt(m),e=f>>8,f%=256,g.push(f),g.push(e);return t(g,this,b,c);default:if(e)throw new TypeError("Unknown encoding: "+d);d=(""+d).toLowerCase();e=!0}};b.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};b.prototype.slice=function(a,c){var d=this.length;a=~~a;c=void 0===c?d:~~c;0>a?(a+=d,0>a&&(a=0)):a>d&&(a=d);0>c?(c+=d,0>c&&(c=0)):c>d&&(c=d);c<a&&(c=a);if(b.TYPED_ARRAY_SUPPORT)d=b._augment(this.subarray(a,
c));else for(var e=c-a,d=new b(e,void 0),f=0;f<e;f++)d[f]=this[f+a];d.length&&(d.parent=this.parent||this);return d};b.prototype.readUIntLE=function(a,b,d){a|=0;b|=0;d||c(a,b,this.length);d=this[a];for(var e=1,f=0;++f<b&&(e*=256);)d+=this[a+f]*e;return d};b.prototype.readUIntBE=function(a,b,d){a|=0;b|=0;d||c(a,b,this.length);d=this[a+--b];for(var e=1;0<b&&(e*=256);)d+=this[a+--b]*e;return d};b.prototype.readUInt8=function(a,b){b||c(a,1,this.length);return this[a]};b.prototype.readUInt16LE=function(a,
b){b||c(a,2,this.length);return this[a]|this[a+1]<<8};b.prototype.readUInt16BE=function(a,b){b||c(a,2,this.length);return this[a]<<8|this[a+1]};b.prototype.readUInt32LE=function(a,b){b||c(a,4,this.length);return(this[a]|this[a+1]<<8|this[a+2]<<16)+16777216*this[a+3]};b.prototype.readUInt32BE=function(a,b){b||c(a,4,this.length);return 16777216*this[a]+(this[a+1]<<16|this[a+2]<<8|this[a+3])};b.prototype.readIntLE=function(a,b,d){a|=0;b|=0;d||c(a,b,this.length);d=this[a];for(var e=1,f=0;++f<b&&(e*=256);)d+=
this[a+f]*e;d>=128*e&&(d-=Math.pow(2,8*b));return d};b.prototype.readIntBE=function(a,b,d){a|=0;b|=0;d||c(a,b,this.length);d=b;for(var e=1,f=this[a+--d];0<d&&(e*=256);)f+=this[a+--d]*e;f>=128*e&&(f-=Math.pow(2,8*b));return f};b.prototype.readInt8=function(a,b){b||c(a,1,this.length);return this[a]&128?-1*(255-this[a]+1):this[a]};b.prototype.readInt16LE=function(a,b){b||c(a,2,this.length);var d=this[a]|this[a+1]<<8;return d&32768?d|4294901760:d};b.prototype.readInt16BE=function(a,b){b||c(a,2,this.length);
var d=this[a+1]|this[a]<<8;return d&32768?d|4294901760:d};b.prototype.readInt32LE=function(a,b){b||c(a,4,this.length);return this[a]|this[a+1]<<8|this[a+2]<<16|this[a+3]<<24};b.prototype.readInt32BE=function(a,b){b||c(a,4,this.length);return this[a]<<24|this[a+1]<<16|this[a+2]<<8|this[a+3]};b.prototype.readFloatLE=function(a,b){b||c(a,4,this.length);return F.read(this,a,!0,23,4)};b.prototype.readFloatBE=function(a,b){b||c(a,4,this.length);return F.read(this,a,!1,23,4)};b.prototype.readDoubleLE=function(a,
b){b||c(a,8,this.length);return F.read(this,a,!0,52,8)};b.prototype.readDoubleBE=function(a,b){b||c(a,8,this.length);return F.read(this,a,!1,52,8)};b.prototype.writeUIntLE=function(a,b,c,e){a=+a;b|=0;c|=0;e||d(this,a,b,c,Math.pow(2,8*c),0);e=1;var f=0;for(this[b]=a&255;++f<c&&(e*=256);)this[b+f]=a/e&255;return b+c};b.prototype.writeUIntBE=function(a,b,c,e){a=+a;b|=0;c|=0;e||d(this,a,b,c,Math.pow(2,8*c),0);e=c-1;var f=1;for(this[b+e]=a&255;0<=--e&&(f*=256);)this[b+e]=a/f&255;return b+c};b.prototype.writeUInt8=
function(a,c,e){a=+a;c|=0;e||d(this,a,c,1,255,0);b.TYPED_ARRAY_SUPPORT||(a=Math.floor(a));this[c]=a;return c+1};b.prototype.writeUInt16LE=function(a,c,e){a=+a;c|=0;e||d(this,a,c,2,65535,0);b.TYPED_ARRAY_SUPPORT?(this[c]=a,this[c+1]=a>>>8):m(this,a,c,!0);return c+2};b.prototype.writeUInt16BE=function(a,c,e){a=+a;c|=0;e||d(this,a,c,2,65535,0);b.TYPED_ARRAY_SUPPORT?(this[c]=a>>>8,this[c+1]=a):m(this,a,c,!1);return c+2};b.prototype.writeUInt32LE=function(a,c,e){a=+a;c|=0;e||d(this,a,c,4,4294967295,0);
b.TYPED_ARRAY_SUPPORT?(this[c+3]=a>>>24,this[c+2]=a>>>16,this[c+1]=a>>>8,this[c]=a):p(this,a,c,!0);return c+4};b.prototype.writeUInt32BE=function(a,c,e){a=+a;c|=0;e||d(this,a,c,4,4294967295,0);b.TYPED_ARRAY_SUPPORT?(this[c]=a>>>24,this[c+1]=a>>>16,this[c+2]=a>>>8,this[c+3]=a):p(this,a,c,!1);return c+4};b.prototype.writeIntLE=function(a,b,c,e){a=+a;b|=0;e||(e=Math.pow(2,8*c-1),d(this,a,b,c,e-1,-e));e=0;var f=1,g=0>a?1:0;for(this[b]=a&255;++e<c&&(f*=256);)this[b+e]=(a/f>>0)-g&255;return b+c};b.prototype.writeIntBE=
function(a,b,c,e){a=+a;b|=0;e||(e=Math.pow(2,8*c-1),d(this,a,b,c,e-1,-e));e=c-1;var f=1,g=0>a?1:0;for(this[b+e]=a&255;0<=--e&&(f*=256);)this[b+e]=(a/f>>0)-g&255;return b+c};b.prototype.writeInt8=function(a,c,e){a=+a;c|=0;e||d(this,a,c,1,127,-128);b.TYPED_ARRAY_SUPPORT||(a=Math.floor(a));0>a&&(a=255+a+1);this[c]=a;return c+1};b.prototype.writeInt16LE=function(a,c,e){a=+a;c|=0;e||d(this,a,c,2,32767,-32768);b.TYPED_ARRAY_SUPPORT?(this[c]=a,this[c+1]=a>>>8):m(this,a,c,!0);return c+2};b.prototype.writeInt16BE=
function(a,c,e){a=+a;c|=0;e||d(this,a,c,2,32767,-32768);b.TYPED_ARRAY_SUPPORT?(this[c]=a>>>8,this[c+1]=a):m(this,a,c,!1);return c+2};b.prototype.writeInt32LE=function(a,c,e){a=+a;c|=0;e||d(this,a,c,4,2147483647,-2147483648);b.TYPED_ARRAY_SUPPORT?(this[c]=a,this[c+1]=a>>>8,this[c+2]=a>>>16,this[c+3]=a>>>24):p(this,a,c,!0);return c+4};b.prototype.writeInt32BE=function(a,c,e){a=+a;c|=0;e||d(this,a,c,4,2147483647,-2147483648);0>a&&(a=4294967295+a+1);b.TYPED_ARRAY_SUPPORT?(this[c]=a>>>24,this[c+1]=a>>>
16,this[c+2]=a>>>8,this[c+3]=a):p(this,a,c,!1);return c+4};b.prototype.writeFloatLE=function(a,b,c){return z(this,a,b,!0,c)};b.prototype.writeFloatBE=function(a,b,c){return z(this,a,b,!1,c)};b.prototype.writeDoubleLE=function(a,b,c){return A(this,a,b,!0,c)};b.prototype.writeDoubleBE=function(a,b,c){return A(this,a,b,!1,c)};b.prototype.copy=function(a,c,d,e){d||(d=0);e||0===e||(e=this.length);c>=a.length&&(c=a.length);c||(c=0);0<e&&e<d&&(e=d);if(e===d||0===a.length||0===this.length)return 0;if(0>c)throw new RangeError("targetStart out of bounds");
if(0>d||d>=this.length)throw new RangeError("sourceStart out of bounds");if(0>e)throw new RangeError("sourceEnd out of bounds");e>this.length&&(e=this.length);a.length-c<e-d&&(e=a.length-c+d);e-=d;if(1E3>e||!b.TYPED_ARRAY_SUPPORT)for(var f=0;f<e;f++)a[f+c]=this[f+d];else a._set(this.subarray(d,d+e),c);return e};b.prototype.fill=function(a,b,c){a||(a=0);b||(b=0);c||(c=this.length);if(c<b)throw new RangeError("end < start");if(c!==b&&0!==this.length){if(0>b||b>=this.length)throw new RangeError("start out of bounds");
if(0>c||c>this.length)throw new RangeError("end out of bounds");if("number"===typeof a)for(;b<c;b++)this[b]=a;else{a=C(a.toString());for(var d=a.length;b<c;b++)this[b]=a[b%d]}return this}};b.prototype.toArrayBuffer=function(){if("undefined"!==typeof Uint8Array){if(b.TYPED_ARRAY_SUPPORT)return(new b(this)).buffer;for(var a=new Uint8Array(this.length),c=0,d=a.length;c<d;c+=1)a[c]=this[c];return a.buffer}throw new TypeError("Buffer.toArrayBuffer not supported in this browser");};var x=b.prototype;b._augment=
function(a){a.constructor=b;a._isBuffer=!0;a._set=a.set;a.get=x.get;a.set=x.set;a.write=x.write;a.toString=x.toString;a.toLocaleString=x.toString;a.toJSON=x.toJSON;a.equals=x.equals;a.compare=x.compare;a.indexOf=x.indexOf;a.copy=x.copy;a.slice=x.slice;a.readUIntLE=x.readUIntLE;a.readUIntBE=x.readUIntBE;a.readUInt8=x.readUInt8;a.readUInt16LE=x.readUInt16LE;a.readUInt16BE=x.readUInt16BE;a.readUInt32LE=x.readUInt32LE;a.readUInt32BE=x.readUInt32BE;a.readIntLE=x.readIntLE;a.readIntBE=x.readIntBE;a.readInt8=
x.readInt8;a.readInt16LE=x.readInt16LE;a.readInt16BE=x.readInt16BE;a.readInt32LE=x.readInt32LE;a.readInt32BE=x.readInt32BE;a.readFloatLE=x.readFloatLE;a.readFloatBE=x.readFloatBE;a.readDoubleLE=x.readDoubleLE;a.readDoubleBE=x.readDoubleBE;a.writeUInt8=x.writeUInt8;a.writeUIntLE=x.writeUIntLE;a.writeUIntBE=x.writeUIntBE;a.writeUInt16LE=x.writeUInt16LE;a.writeUInt16BE=x.writeUInt16BE;a.writeUInt32LE=x.writeUInt32LE;a.writeUInt32BE=x.writeUInt32BE;a.writeIntLE=x.writeIntLE;a.writeIntBE=x.writeIntBE;
a.writeInt8=x.writeInt8;a.writeInt16LE=x.writeInt16LE;a.writeInt16BE=x.writeInt16BE;a.writeInt32LE=x.writeInt32LE;a.writeInt32BE=x.writeInt32BE;a.writeFloatLE=x.writeFloatLE;a.writeFloatBE=x.writeFloatBE;a.writeDoubleLE=x.writeDoubleLE;a.writeDoubleBE=x.writeDoubleBE;a.fill=x.fill;a.inspect=x.inspect;a.toArrayBuffer=x.toArrayBuffer;return a};var I=/[^+\/0-9A-z\-]/g},{"base64-js":27,ieee754:28,"is-array":29}],27:[function(k,l,n){(function(b){function h(b){b=b.charCodeAt(0);if(43===b||45===b)return 62;
if(47===b||95===b)return 63;if(48>b)return-1;if(58>b)return b-48+52;if(91>b)return b-65;if(123>b)return b-97+26}var f="undefined"!==typeof Uint8Array?Uint8Array:Array;b.toByteArray=function(b){function g(a){p[k++]=a}var a,c,d,m,p;if(0<b.length%4)throw Error("Invalid string. Length must be a multiple of 4");a=b.length;m="="===b.charAt(a-2)?2:"="===b.charAt(a-1)?1:0;p=new f(3*b.length/4-m);c=0<m?b.length-4:b.length;var k=0;for(a=0;a<c;a+=4)d=h(b.charAt(a))<<18|h(b.charAt(a+1))<<12|h(b.charAt(a+2))<<
6|h(b.charAt(a+3)),g((d&16711680)>>16),g((d&65280)>>8),g(d&255);2===m?(d=h(b.charAt(a))<<2|h(b.charAt(a+1))>>4,g(d&255)):1===m&&(d=h(b.charAt(a))<<10|h(b.charAt(a+1))<<4|h(b.charAt(a+2))>>2,g(d>>8&255),g(d&255));return p};b.fromByteArray=function(b){var f,a=b.length%3,c="",d,m;f=0;for(m=b.length-a;f<m;f+=3)d=(b[f]<<16)+(b[f+1]<<8)+b[f+2],d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(d>>18&63)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(d>>
12&63)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(d>>6&63)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(d&63),c+=d;switch(a){case 1:d=b[b.length-1];c+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(d>>2);c+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(d<<4&63);c+="==";break;case 2:d=(b[b.length-2]<<8)+b[b.length-1],c+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(d>>
10),c+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(d>>4&63),c+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(d<<2&63),c+="="}return c}})("undefined"===typeof n?this.base64js={}:n)},{}],28:[function(k,l,n){n.read=function(b,h,f,e,g){var a;a=8*g-e-1;var c=(1<<a)-1,d=c>>1,m=-7;g=f?g-1:0;var p=f?-1:1,k=b[h+g];g+=p;f=k&(1<<-m)-1;k>>=-m;for(m+=a;0<m;f=256*f+b[h+g],g+=p,m-=8);a=f&(1<<-m)-1;f>>=-m;for(m+=e;0<m;a=256*a+b[h+g],g+=p,m-=8);if(0===f)f=
1-d;else{if(f===c)return a?NaN:Infinity*(k?-1:1);a+=Math.pow(2,e);f-=d}return(k?-1:1)*a*Math.pow(2,f-e)};n.write=function(b,h,f,e,g,a){var c,d=8*a-g-1,m=(1<<d)-1,p=m>>1,k=23===g?Math.pow(2,-24)-Math.pow(2,-77):0;a=e?0:a-1;var l=e?1:-1,n=0>h||0===h&&0>1/h?1:0;h=Math.abs(h);isNaN(h)||Infinity===h?(h=isNaN(h)?1:0,e=m):(e=Math.floor(Math.log(h)/Math.LN2),1>h*(c=Math.pow(2,-e))&&(e--,c*=2),h=1<=e+p?h+k/c:h+k*Math.pow(2,1-p),2<=h*c&&(e++,c/=2),e+p>=m?(h=0,e=m):1<=e+p?(h=(h*c-1)*Math.pow(2,g),e+=p):(h=h*
Math.pow(2,p-1)*Math.pow(2,g),e=0));for(;8<=g;b[f+a]=h&255,a+=l,h/=256,g-=8);e=e<<g|h;for(d+=g;0<d;b[f+a]=e&255,a+=l,e/=256,d-=8);b[f+a-l]|=128*n}},{}],29:[function(k,l,n){var b=Object.prototype.toString;l.exports=Array.isArray||function(h){return!!h&&"[object Array]"==b.call(h)}},{}],30:[function(k,l,n){function b(){this._events=this._events||{};this._maxListeners=this._maxListeners||void 0}function h(b){return"function"===typeof b}function f(b){return"object"===typeof b&&null!==b}l.exports=b;b.EventEmitter=
b;b.prototype._events=void 0;b.prototype._maxListeners=void 0;b.defaultMaxListeners=10;b.prototype.setMaxListeners=function(b){if("number"!==typeof b||0>b||isNaN(b))throw TypeError("n must be a positive number");this._maxListeners=b;return this};b.prototype.emit=function(b){var g,a,c,d;this._events||(this._events={});if("error"===b&&(!this._events.error||f(this._events.error)&&!this._events.error.length)){g=arguments[1];if(g instanceof Error)throw g;throw TypeError('Uncaught, unspecified "error" event.');
}a=this._events[b];if(void 0===a)return!1;if(h(a))switch(arguments.length){case 1:a.call(this);break;case 2:a.call(this,arguments[1]);break;case 3:a.call(this,arguments[1],arguments[2]);break;default:g=arguments.length;c=Array(g-1);for(d=1;d<g;d++)c[d-1]=arguments[d];a.apply(this,c)}else if(f(a)){g=arguments.length;c=Array(g-1);for(d=1;d<g;d++)c[d-1]=arguments[d];a=a.slice();g=a.length;for(d=0;d<g;d++)a[d].apply(this,c)}return!0};b.prototype.addListener=function(e,g){var a;if(!h(g))throw TypeError("listener must be a function");
this._events||(this._events={});this._events.newListener&&this.emit("newListener",e,h(g.listener)?g.listener:g);this._events[e]?f(this._events[e])?this._events[e].push(g):this._events[e]=[this._events[e],g]:this._events[e]=g;f(this._events[e])&&!this._events[e].warned&&(a=void 0!==this._maxListeners?this._maxListeners:b.defaultMaxListeners)&&0<a&&this._events[e].length>a&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",
this._events[e].length),"function"===typeof console.trace&&console.trace());return this};b.prototype.on=b.prototype.addListener;b.prototype.once=function(b,f){function a(){this.removeListener(b,a);c||(c=!0,f.apply(this,arguments))}if(!h(f))throw TypeError("listener must be a function");var c=!1;a.listener=f;this.on(b,a);return this};b.prototype.removeListener=function(b,g){var a,c,d;if(!h(g))throw TypeError("listener must be a function");if(!this._events||!this._events[b])return this;a=this._events[b];
d=a.length;c=-1;if(a===g||h(a.listener)&&a.listener===g)delete this._events[b],this._events.removeListener&&this.emit("removeListener",b,g);else if(f(a)){for(;0<d--;)if(a[d]===g||a[d].listener&&a[d].listener===g){c=d;break}if(0>c)return this;1===a.length?(a.length=0,delete this._events[b]):a.splice(c,1);this._events.removeListener&&this.emit("removeListener",b,g)}return this};b.prototype.removeAllListeners=function(b){var f;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?
this._events={}:this._events[b]&&delete this._events[b],this;if(0===arguments.length){for(f in this._events)"removeListener"!==f&&this.removeAllListeners(f);this.removeAllListeners("removeListener");this._events={};return this}f=this._events[b];if(h(f))this.removeListener(b,f);else for(;f.length;)this.removeListener(b,f[f.length-1]);delete this._events[b];return this};b.prototype.listeners=function(b){return this._events&&this._events[b]?h(this._events[b])?[this._events[b]]:this._events[b].slice():
[]};b.listenerCount=function(b,f){return b._events&&b._events[f]?h(b._events[f])?1:b._events[f].length:0}},{}],31:[function(k,l,n){l.exports="function"===typeof Object.create?function(b,h){b.super_=h;b.prototype=Object.create(h.prototype,{constructor:{value:b,enumerable:!1,writable:!0,configurable:!0}})}:function(b,h){b.super_=h;var f=function(){};f.prototype=h.prototype;b.prototype=new f;b.prototype.constructor=b}},{}],32:[function(k,l,n){function b(){if(!e){e=!0;for(var b,a=f.length;a;){b=f;f=[];
for(var c=-1;++c<a;)b[c]();a=f.length}e=!1}}function h(){}k=l.exports={};var f=[],e=!1;k.nextTick=function(g){f.push(g);e||setTimeout(b,0)};k.title="browser";k.browser=!0;k.env={};k.argv=[];k.version="";k.versions={};k.on=h;k.addListener=h;k.once=h;k.off=h;k.removeListener=h;k.removeAllListeners=h;k.emit=h;k.binding=function(b){throw Error("process.binding is not supported");};k.cwd=function(){return"/"};k.chdir=function(b){throw Error("process.chdir is not supported");};k.umask=function(){return 0}},
{}],33:[function(k,l,n){l.exports=function(b){return b&&"object"===typeof b&&"function"===typeof b.copy&&"function"===typeof b.fill&&"function"===typeof b.readUInt8}},{}],34:[function(k,l,n){(function(b,h){function f(a,b){var d={seen:[],stylize:g};3<=arguments.length&&(d.depth=arguments[2]);4<=arguments.length&&(d.colors=arguments[3]);v(b)?d.showHidden=b:b&&n._extend(d,b);t(d.showHidden)&&(d.showHidden=!1);t(d.depth)&&(d.depth=2);t(d.colors)&&(d.colors=!1);t(d.customInspect)&&(d.customInspect=!0);
d.colors&&(d.stylize=e);return c(d,a,d.depth)}function e(a,b){var c=f.styles[b];return c?"\u001b["+f.colors[c][0]+"m"+a+"\u001b["+f.colors[c][1]+"m":a}function g(a,b){return a}function a(a){var b={};a.forEach(function(a,c){b[a]=!0});return b}function c(b,e,f){if(b.customInspect&&e&&H(e.inspect)&&e.inspect!==n.inspect&&(!e.constructor||e.constructor.prototype!==e)){var g=e.inspect(f,b);q(g)||(g=c(b,g,f));return g}if(g=d(b,e))return g;var h=Object.keys(e),k=a(h);b.showHidden&&(h=Object.getOwnPropertyNames(e));
if(E(e)&&(0<=h.indexOf("message")||0<=h.indexOf("description")))return m(e);if(0===h.length){if(H(e))return b.stylize("[Function"+(e.name?": "+e.name:"")+"]","special");if(r(e))return b.stylize(RegExp.prototype.toString.call(e),"regexp");if(F(e))return b.stylize(Date.prototype.toString.call(e),"date");if(E(e))return m(e)}var g="",y=!1,v=["{","}"];A(e)&&(y=!0,v=["[","]"]);H(e)&&(g=" [Function"+(e.name?": "+e.name:"")+"]");r(e)&&(g=" "+RegExp.prototype.toString.call(e));F(e)&&(g=" "+Date.prototype.toUTCString.call(e));
E(e)&&(g=" "+m(e));if(0===h.length&&(!y||0==e.length))return v[0]+g+v[1];if(0>f)return r(e)?b.stylize(RegExp.prototype.toString.call(e),"regexp"):b.stylize("[Object]","special");b.seen.push(e);h=y?p(b,e,f,k,h):h.map(function(a){return w(b,e,f,k,a,y)});b.seen.pop();return l(h,g,v)}function d(a,b){if(t(b))return a.stylize("undefined","undefined");if(q(b)){var c="'"+JSON.stringify(b).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return a.stylize(c,"string")}if(C(b))return a.stylize(""+
b,"number");if(v(b))return a.stylize(""+b,"boolean");if(null===b)return a.stylize("null","null")}function m(a){return"["+Error.prototype.toString.call(a)+"]"}function p(a,b,c,d,e){for(var f=[],g=0,m=b.length;g<m;++g)Object.prototype.hasOwnProperty.call(b,String(g))?f.push(w(a,b,c,d,String(g),!0)):f.push("");e.forEach(function(e){e.match(/^\d+$/)||f.push(w(a,b,c,d,e,!0))});return f}function w(a,b,d,e,f,g){var m,p;b=Object.getOwnPropertyDescriptor(b,f)||{value:b[f]};b.get?p=b.set?a.stylize("[Getter/Setter]",
"special"):a.stylize("[Getter]","special"):b.set&&(p=a.stylize("[Setter]","special"));Object.prototype.hasOwnProperty.call(e,f)||(m="["+f+"]");p||(0>a.seen.indexOf(b.value)?(p=null===d?c(a,b.value,null):c(a,b.value,d-1),-1<p.indexOf("\n")&&(p=g?p.split("\n").map(function(a){return"  "+a}).join("\n").substr(2):"\n"+p.split("\n").map(function(a){return"   "+a}).join("\n"))):p=a.stylize("[Circular]","special"));if(t(m)){if(g&&f.match(/^\d+$/))return p;m=JSON.stringify(""+f);m.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?
(m=m.substr(1,m.length-2),m=a.stylize(m,"name")):(m=m.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),m=a.stylize(m,"string"))}return m+": "+p}function l(a,b,c){var d=0;return 60<a.reduce(function(a,b){d++;0<=b.indexOf("\n")&&d++;return a+b.replace(/\u001b\[\d\d?m/g,"").length+1},0)?c[0]+(""===b?"":b+"\n ")+" "+a.join(",\n  ")+" "+c[1]:c[0]+b+" "+a.join(", ")+" "+c[1]}function A(a){return Array.isArray(a)}function v(a){return"boolean"===typeof a}function C(a){return"number"===typeof a}
function q(a){return"string"===typeof a}function t(a){return void 0===a}function r(a){return u(a)&&"[object RegExp]"===Object.prototype.toString.call(a)}function u(a){return"object"===typeof a&&null!==a}function F(a){return u(a)&&"[object Date]"===Object.prototype.toString.call(a)}function E(a){return u(a)&&("[object Error]"===Object.prototype.toString.call(a)||a instanceof Error)}function H(a){return"function"===typeof a}function y(a){return 10>a?"0"+a.toString(10):a.toString(10)}function x(){var a=
new Date,b=[y(a.getHours()),y(a.getMinutes()),y(a.getSeconds())].join(":");return[a.getDate(),J[a.getMonth()],b].join(" ")}var I=/%[sdj%]/g;n.format=function(a){if(!q(a)){for(var b=[],c=0;c<arguments.length;c++)b.push(f(arguments[c]));return b.join(" ")}for(var c=1,d=arguments,e=d.length,b=String(a).replace(I,function(a){if("%%"===a)return"%";if(c>=e)return a;switch(a){case "%s":return String(d[c++]);case "%d":return Number(d[c++]);case "%j":try{return JSON.stringify(d[c++])}catch(b){return"[Circular]"}default:return a}}),
g=d[c];c<e;g=d[++c])b=null!==g&&u(g)?b+(" "+f(g)):b+(" "+g);return b};n.deprecate=function(a,c){if(t(h.process))return function(){return n.deprecate(a,c).apply(this,arguments)};if(!0===b.noDeprecation)return a;var d=!1;return function(){if(!d){if(b.throwDeprecation)throw Error(c);b.traceDeprecation?console.trace(c):console.error(c);d=!0}return a.apply(this,arguments)}};var D={},G;n.debuglog=function(a){t(G)&&(G=b.env.NODE_DEBUG||"");a=a.toUpperCase();if(!D[a])if((new RegExp("\\b"+a+"\\b","i")).test(G)){var c=
b.pid;D[a]=function(){var b=n.format.apply(n,arguments);console.error("%s %d: %s",a,c,b)}}else D[a]=function(){};return D[a]};n.inspect=f;f.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]};f.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"};n.isArray=A;n.isBoolean=v;n.isNull=
function(a){return null===a};n.isNullOrUndefined=function(a){return null==a};n.isNumber=C;n.isString=q;n.isSymbol=function(a){return"symbol"===typeof a};n.isUndefined=t;n.isRegExp=r;n.isObject=u;n.isDate=F;n.isError=E;n.isFunction=H;n.isPrimitive=function(a){return null===a||"boolean"===typeof a||"number"===typeof a||"string"===typeof a||"symbol"===typeof a||"undefined"===typeof a};n.isBuffer=k("./support/isBuffer");var J="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ");n.log=function(){console.log("%s - %s",
x(),n.format.apply(n,arguments))};n.inherits=k("inherits");n._extend=function(a,b){if(!b||!u(b))return a;for(var c=Object.keys(b),d=c.length;d--;)a[c[d]]=b[c[d]];return a}}).call(this,k("_process"),"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./support/isBuffer":33,_process:32,inherits:31}],35:[function(k,l,n){(function(b){(function(b){if("function"===typeof bootstrap)bootstrap("promise",b);else if("object"===typeof n&&"object"===typeof l)l.exports=
b();else if("function"===typeof define&&define.amd)define(b);else if("undefined"!==typeof ses)ses.ok()&&(ses.makeQ=b);else if("undefined"!==typeof self)self.Q=b();else throw Error("This environment was not anticipated by Q. Please file a bug.");})(function(){function h(a){return function(){return W.apply(a,arguments)}}function f(a,b){if(D&&b.stack&&"object"===typeof a&&null!==a&&a.stack&&-1===a.stack.indexOf("From previous event:")){for(var c=[],d=b;d;d=d.source)d.stack&&c.unshift(d.stack);c.unshift(a.stack);
for(var c=c.join("\nFrom previous event:\n").split("\n"),d=[],f=0;f<c.length;++f){var g=c[f],m;if(m=e(g)){var p=m[1];m=m[0]===U&&p>=J&&p<=X}else m=!1;m||(m=g,m=-1!==m.indexOf("(module.js:")||-1!==m.indexOf("(node.js:"));m||!g||d.push(g)}c=d.join("\n");a.stack=c}}function e(a){var b=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(a);if(b||(b=/at ([^ ]+):(\d+):(?:\d+)$/.exec(a)))return[b[1],Number(b[2])];if(a=/.*@(.+):(\d+)$/.exec(a))return[a[1],Number(a[2])]}function g(){if(D)try{throw Error();}catch(a){var b=
a.stack.split("\n"),b=0<b[0].indexOf("@")?b[1]:b[2];if(b=e(b))return U=b[0],b[1]}}function a(a){return a instanceof p?a:v(a)?F(a):u(a)}function c(){function b(c){f=c;m.source=c;L(d,function(b,d){a.nextTick(function(){c.promiseDispatch.apply(c,d)})},void 0);e=d=void 0}var d=[],e=[],f,g=P(c.prototype),m=P(p.prototype);m.promiseDispatch=function(b,c,g){var m=B(arguments);d?(d.push(m),"when"===c&&g[1]&&e.push(g[1])):a.nextTick(function(){f.promiseDispatch.apply(f,m)})};m.valueOf=function(){if(d)return m;
var a=l(f);n(a)&&(f=a);return a};m.inspect=function(){return f?f.inspect():{state:"pending"}};if(a.longStackSupport&&D)try{throw Error();}catch(h){m.stack=h.stack.substring(h.stack.indexOf("\n")+1)}g.promise=m;g.resolve=function(c){f||b(a(c))};g.fulfill=function(a){f||b(u(a))};g.reject=function(a){f||b(r(a))};g.notify=function(b){f||L(e,function(c,d){a.nextTick(function(){d(b)})},void 0)};return g}function d(a){if("function"!==typeof a)throw new TypeError("resolver must be a function.");var b=c();
try{a(b.resolve,b.reject,b.notify)}catch(d){b.reject(d)}return b.promise}function m(b){return d(function(c,d){for(var e=0,f=b.length;e<f;e++)a(b[e]).then(c,d)})}function p(a,b,c){void 0===b&&(b=function(a){return r(Error("Promise does not support operation: "+a))});void 0===c&&(c=function(){return{state:"unknown"}});var d=P(p.prototype);d.promiseDispatch=function(c,e,f){var g;try{g=a[e]?a[e].apply(d,f):b.call(d,e,f)}catch(m){g=r(m)}c&&c(g)};if(d.inspect=c){var e=c();"rejected"===e.state&&(d.exception=
e.reason);d.valueOf=function(){var a=c();return"pending"===a.state||"rejected"===a.state?d:a.value}}return d}function k(b,c,d,e){return a(b).then(c,d,e)}function l(a){if(n(a)){var b=a.inspect();if("fulfilled"===b.state)return b.value}return a}function n(a){return a instanceof p}function v(a){return a===Object(a)&&"function"===typeof a.then}function C(){K.length=0;M.length=0;N||(N=!0)}function q(c,d){N&&("object"===typeof b&&"function"===typeof b.emit&&a.nextTick.runAfter(function(){-1!==Q(M,c)&&(b.emit("unhandledRejection",
d,c),S.push(c))}),M.push(c),d&&"undefined"!==typeof d.stack?K.push(d.stack):K.push("(no stack) "+d))}function t(c){if(N){var d=Q(M,c);-1!==d&&("object"===typeof b&&"function"===typeof b.emit&&a.nextTick.runAfter(function(){var a=Q(S,c);-1!==a&&(b.emit("rejectionHandled",K[d],c),S.splice(a,1))}),M.splice(d,1),K.splice(d,1))}}function r(a){var b=p({when:function(b){b&&t(this);return b?b(a):this}},function(){return this},function(){return{state:"rejected",reason:a}});q(b,a);return b}function u(a){return p({when:function(){return a},
get:function(b){return a[b]},set:function(b,c){a[b]=c},"delete":function(b){delete a[b]},post:function(b,c){return null===b||void 0===b?a.apply(void 0,c):a[b].apply(a,c)},apply:function(b,c){return a.apply(b,c)},keys:function(){return Y(a)}},void 0,function(){return{state:"fulfilled",value:a}})}function F(b){var d=c();a.nextTick(function(){try{b.then(d.resolve,d.reject,d.notify)}catch(a){d.reject(a)}});return d.promise}function E(b,c,d){return a(b).spread(c,d)}function H(b,c,d){return a(b).dispatch(c,
d)}function y(a){return k(a,function(a){var b=0,d=c();L(a,function(c,e,f){var g;n(e)&&"fulfilled"===(g=e.inspect()).state?a[f]=g.value:(++b,k(e,function(c){a[f]=c;0===--b&&d.resolve(a)},d.reject,function(a){d.notify({index:f,value:a})}))},void 0);0===b&&d.resolve(a);return d.promise})}function x(b){if(0===b.length)return a.resolve();var c=a.defer(),d=0;L(b,function(a,e,f){a=b[f];d++;k(a,function(a){c.resolve(a)},function(){d--;0===d&&c.reject(Error("Can't get fulfillment value from any promise, all promises were rejected."))},
function(a){c.notify({index:f,value:a})})},void 0);return c.promise}function I(b){return k(b,function(b){b=R(b,a);return k(y(R(b,function(a){return k(a,V,V)})),function(){return b})})}var D=!1;try{throw Error();}catch(G){D=!!G.stack}var J=g(),U,V=function(){},O=function(){function a(){for(var b,e;d.next;){d=d.next;b=d.task;d.task=void 0;if(e=d.domain)d.domain=void 0,e.enter();c(b,e)}for(;p.length;)b=p.pop(),c(b);f=!1}function c(b,d){try{b()}catch(e){if(m)throw d&&d.exit(),setTimeout(a,0),d&&d.enter(),
e;setTimeout(function(){throw e;},0)}d&&d.exit()}var d={task:void 0,next:null},e=d,f=!1,g=void 0,m=!1,p=[];O=function(a){e=e.next={task:a,domain:m&&b.domain,next:null};f||(f=!0,g())};if("object"===typeof b&&"[object process]"===b.toString()&&b.nextTick)m=!0,g=function(){b.nextTick(a)};else if("function"===typeof setImmediate)g="undefined"!==typeof window?setImmediate.bind(window,a):function(){setImmediate(a)};else if("undefined"!==typeof MessageChannel){var h=new MessageChannel;h.port1.onmessage=
function(){g=k;h.port1.onmessage=a;a()};var k=function(){h.port2.postMessage(0)},g=function(){setTimeout(a,0);k()}}else g=function(){setTimeout(a,0)};O.runAfter=function(a){p.push(a);f||(f=!0,g())};return O}(),W=Function.call,B=h(Array.prototype.slice),L=h(Array.prototype.reduce||function(a,b){var c=0,d=this.length;if(1===arguments.length){do{if(c in this){b=this[c++];break}if(++c>=d)throw new TypeError;}while(1)}for(;c<d;c++)c in this&&(b=a(b,this[c],c));return b}),Q=h(Array.prototype.indexOf||function(a){for(var b=
0;b<this.length;b++)if(this[b]===a)return b;return-1}),R=h(Array.prototype.map||function(a,b){var c=this,d=[];L(c,function(e,f,g){d.push(a.call(b,f,g,c))},void 0);return d}),P=Object.create||function(a){function b(){}b.prototype=a;return new b},Z=h(Object.prototype.hasOwnProperty),Y=Object.keys||function(a){var b=[],c;for(c in a)Z(a,c)&&b.push(c);return b},aa=h(Object.prototype.toString),T;T="undefined"!==typeof ReturnValue?ReturnValue:function(a){this.value=a};a.resolve=a;a.nextTick=O;a.longStackSupport=
!1;"object"===typeof b&&b&&b.env&&b.env.Q_DEBUG&&(a.longStackSupport=!0);a.defer=c;c.prototype.makeNodeResolver=function(){var a=this;return function(b,c){b?a.reject(b):2<arguments.length?a.resolve(B(arguments,1)):a.resolve(c)}};a.Promise=d;a.promise=d;d.race=m;d.all=y;d.reject=r;d.resolve=a;a.passByCopy=function(a){return a};p.prototype.passByCopy=function(){return this};a.join=function(b,c){return a(b).join(c)};p.prototype.join=function(b){return a([this,b]).spread(function(a,b){if(a===b)return a;
throw Error("Can't join: not the same: "+a+" "+b);})};a.race=m;p.prototype.race=function(){return this.then(a.race)};a.makePromise=p;p.prototype.toString=function(){return"[object Promise]"};p.prototype.then=function(b,d,e){function g(a){try{return"function"===typeof b?b(a):a}catch(c){return r(c)}}function m(a){if("function"===typeof d){f(a,p);try{return d(a)}catch(b){return r(b)}}return r(a)}var p=this,h=c(),k=!1;a.nextTick(function(){p.promiseDispatch(function(a){k||(k=!0,h.resolve(g(a)))},"when",
[function(a){k||(k=!0,h.resolve(m(a)))}])});p.promiseDispatch(void 0,"when",[void 0,function(b){var c,d=!1;try{c="function"===typeof e?e(b):b}catch(f){if(d=!0,a.onerror)a.onerror(f);else throw f;}d||h.notify(c)}]);return h.promise};a.tap=function(b,c){return a(b).tap(c)};p.prototype.tap=function(b){b=a(b);return this.then(function(a){return b.fcall(a).thenResolve(a)})};a.when=k;p.prototype.thenResolve=function(a){return this.then(function(){return a})};a.thenResolve=function(b,c){return a(b).thenResolve(c)};
p.prototype.thenReject=function(a){return this.then(function(){throw a;})};a.thenReject=function(b,c){return a(b).thenReject(c)};a.nearer=l;a.isPromise=n;a.isPromiseAlike=v;a.isPending=function(a){return n(a)&&"pending"===a.inspect().state};p.prototype.isPending=function(){return"pending"===this.inspect().state};a.isFulfilled=function(a){return!n(a)||"fulfilled"===a.inspect().state};p.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state};a.isRejected=function(a){return n(a)&&
"rejected"===a.inspect().state};p.prototype.isRejected=function(){return"rejected"===this.inspect().state};var K=[],M=[],S=[],N=!0;a.resetUnhandledRejections=C;a.getUnhandledReasons=function(){return K.slice()};a.stopUnhandledRejectionTracking=function(){C();N=!1};C();a.reject=r;a.fulfill=u;a.master=function(b){return p({isDef:function(){}},function(a,c){return H(b,a,c)},function(){return a(b).inspect()})};a.spread=E;p.prototype.spread=function(a,b){return this.all().then(function(b){return a.apply(void 0,
b)},b)};a.async=function(b){return function(){function c(b,g){var m;if("undefined"===typeof StopIteration){try{m=d[b](g)}catch(p){return r(p)}return m.done?a(m.value):k(m.value,e,f)}try{m=d[b](g)}catch(h){return"[object StopIteration]"===aa(h)||h instanceof T?a(h.value):r(h)}return k(m,e,f)}var d=b.apply(this,arguments),e=c.bind(c,"next"),f=c.bind(c,"throw");return e()}};a.spawn=function(b){a.done(a.async(b)())};a["return"]=function(a){throw new T(a);};a.promised=function(a){return function(){return E([this,
y(arguments)],function(b,c){return a.apply(b,c)})}};a.dispatch=H;p.prototype.dispatch=function(b,d){var e=this,f=c();a.nextTick(function(){e.promiseDispatch(f.resolve,b,d)});return f.promise};a.get=function(b,c){return a(b).dispatch("get",[c])};p.prototype.get=function(a){return this.dispatch("get",[a])};a.set=function(b,c,d){return a(b).dispatch("set",[c,d])};p.prototype.set=function(a,b){return this.dispatch("set",[a,b])};a.del=a["delete"]=function(b,c){return a(b).dispatch("delete",[c])};p.prototype.del=
p.prototype["delete"]=function(a){return this.dispatch("delete",[a])};a.mapply=a.post=function(b,c,d){return a(b).dispatch("post",[c,d])};p.prototype.mapply=p.prototype.post=function(a,b){return this.dispatch("post",[a,b])};a.send=a.mcall=a.invoke=function(b,c){return a(b).dispatch("post",[c,B(arguments,2)])};p.prototype.send=p.prototype.mcall=p.prototype.invoke=function(a){return this.dispatch("post",[a,B(arguments,1)])};a.fapply=function(b,c){return a(b).dispatch("apply",[void 0,c])};p.prototype.fapply=
function(a){return this.dispatch("apply",[void 0,a])};a["try"]=a.fcall=function(b){return a(b).dispatch("apply",[void 0,B(arguments,1)])};p.prototype.fcall=function(){return this.dispatch("apply",[void 0,B(arguments)])};a.fbind=function(b){var c=a(b),d=B(arguments,1);return function(){return c.dispatch("apply",[this,d.concat(B(arguments))])}};p.prototype.fbind=function(){var a=this,b=B(arguments);return function(){return a.dispatch("apply",[this,b.concat(B(arguments))])}};a.keys=function(b){return a(b).dispatch("keys",
[])};p.prototype.keys=function(){return this.dispatch("keys",[])};a.all=y;p.prototype.all=function(){return y(this)};a.any=x;p.prototype.any=function(){return x(this)};a.allResolved=function(a,b,c){return function(){"undefined"!==typeof console&&"function"===typeof console.warn&&console.warn(b+" is deprecated, use "+c+" instead.",Error("").stack);return a.apply(a,arguments)}}(I,"allResolved","allSettled");p.prototype.allResolved=function(){return I(this)};a.allSettled=function(b){return a(b).allSettled()};
p.prototype.allSettled=function(){return this.then(function(b){return y(R(b,function(b){function c(){return b.inspect()}b=a(b);return b.then(c,c)}))})};a.fail=a["catch"]=function(b,c){return a(b).then(void 0,c)};p.prototype.fail=p.prototype["catch"]=function(a){return this.then(void 0,a)};a.progress=function(b,c){return a(b).then(void 0,void 0,c)};p.prototype.progress=function(a){return this.then(void 0,void 0,a)};a.fin=a["finally"]=function(b,c){return a(b)["finally"](c)};p.prototype.fin=p.prototype["finally"]=
function(b){b=a(b);return this.then(function(a){return b.fcall().then(function(){return a})},function(a){return b.fcall().then(function(){throw a;})})};a.done=function(b,c,d,e){return a(b).done(c,d,e)};p.prototype.done=function(c,d,e){var g=function(b){a.nextTick(function(){f(b,m);if(a.onerror)a.onerror(b);else throw b;})},m=c||d||e?this.then(c,d,e):this;"object"===typeof b&&b&&b.domain&&(g=b.domain.bind(g));m.then(void 0,g)};a.timeout=function(b,c,d){return a(b).timeout(c,d)};p.prototype.timeout=
function(a,b){var d=c(),e=setTimeout(function(){b&&"string"!==typeof b||(b=Error(b||"Timed out after "+a+" ms"),b.code="ETIMEDOUT");d.reject(b)},a);this.then(function(a){clearTimeout(e);d.resolve(a)},function(a){clearTimeout(e);d.reject(a)},d.notify);return d.promise};a.delay=function(b,c){void 0===c&&(c=b,b=void 0);return a(b).delay(c)};p.prototype.delay=function(a){return this.then(function(b){var d=c();setTimeout(function(){d.resolve(b)},a);return d.promise})};a.nfapply=function(b,c){return a(b).nfapply(c)};
p.prototype.nfapply=function(a){var b=c();a=B(a);a.push(b.makeNodeResolver());this.fapply(a).fail(b.reject);return b.promise};a.nfcall=function(b){var c=B(arguments,1);return a(b).nfapply(c)};p.prototype.nfcall=function(){var a=B(arguments),b=c();a.push(b.makeNodeResolver());this.fapply(a).fail(b.reject);return b.promise};a.nfbind=a.denodeify=function(b){var d=B(arguments,1);return function(){var e=d.concat(B(arguments)),f=c();e.push(f.makeNodeResolver());a(b).fapply(e).fail(f.reject);return f.promise}};
p.prototype.nfbind=p.prototype.denodeify=function(){var b=B(arguments);b.unshift(this);return a.denodeify.apply(void 0,b)};a.nbind=function(b,d){var e=B(arguments,2);return function(){var f=e.concat(B(arguments)),g=c();f.push(g.makeNodeResolver());a(function(){return b.apply(d,arguments)}).fapply(f).fail(g.reject);return g.promise}};p.prototype.nbind=function(){var b=B(arguments,0);b.unshift(this);return a.nbind.apply(void 0,b)};a.nmapply=a.npost=function(b,c,d){return a(b).npost(c,d)};p.prototype.nmapply=
p.prototype.npost=function(a,b){var d=B(b||[]),e=c();d.push(e.makeNodeResolver());this.dispatch("post",[a,d]).fail(e.reject);return e.promise};a.nsend=a.nmcall=a.ninvoke=function(b,d){var e=B(arguments,2),f=c();e.push(f.makeNodeResolver());a(b).dispatch("post",[d,e]).fail(f.reject);return f.promise};p.prototype.nsend=p.prototype.nmcall=p.prototype.ninvoke=function(a){var b=B(arguments,1),d=c();b.push(d.makeNodeResolver());this.dispatch("post",[a,b]).fail(d.reject);return d.promise};a.nodeify=function(b,
c){return a(b).nodeify(c)};p.prototype.nodeify=function(b){if(b)this.then(function(c){a.nextTick(function(){b(null,c)})},function(c){a.nextTick(function(){b(c)})});else return this};var X=g();return a})}).call(this,k("_process"))},{_process:32}],36:[function(k,l,n){l.exports={name:"sip.js",title:"SIP.js",description:"A simple, intuitive, and powerful JavaScript signaling library",version:"0.7.0",main:"src/index.js",browser:{"./src/environment.js":"./src/environment_browser.js"},homepage:"http://sipjs.com",
author:{name:"Will Mitchell",email:"will@onsip.com"},contributors:[{url:"http://sipjs.com/authors/"}],repository:{type:"git",url:"https://github.com/onsip/SIP.js.git"},keywords:["sip","websocket","webrtc","library","javascript"],devDependencies:{browserify:"^4.1.8",grunt:"~0.4.0","grunt-browserify":"^2.1.0","grunt-cli":"~0.1.6","grunt-contrib-copy":"^0.5.0","grunt-contrib-jasmine":"~0.8.0","grunt-contrib-jshint":">0.5.0","grunt-contrib-uglify":"~0.2.0","grunt-peg":"~1.3.1","grunt-trimtrailingspaces":"^0.4.0",
pegjs:"^0.8.0"},engines:{node:">=0.8"},license:"MIT",scripts:{prepublish:"cd src/Grammar && mkdir -p dist && pegjs --extra-options-file peg.json src/Grammar.pegjs dist/Grammar.js",test:"grunt travis --verbose"},dependencies:{ws:"^0.6.4",promiscuous:"^0.6.0"},optionalDependencies:{promiscuous:"^0.6.0"},gitHead:"dae797012e65e0fbeec3bad83a2cfc3cfaa51424",bugs:{url:"https://github.com/onsip/SIP.js/issues"},_id:"sip.js@0.7.0",_shasum:"ddfc27b7547858e2781a04eff7778a3f81b8c0f5",_from:"sip.js@>=0.7.0 <0.8.0",
_npmVersion:"2.4.1",_nodeVersion:"1.6.2",_npmUser:{name:"joseph-onsip",email:"joseph@onsip.com"},maintainers:[{name:"joseph-onsip",email:"joseph@onsip.com"},{name:"egreen_onsip",email:"eric.green@onsip.com"}],dist:{shasum:"ddfc27b7547858e2781a04eff7778a3f81b8c0f5",tarball:"http://registry.npmjs.org/sip.js/-/sip.js-0.7.0.tgz"},directories:{},_resolved:"https://registry.npmjs.org/sip.js/-/sip.js-0.7.0.tgz"}},{}],37:[function(k,l,n){l.exports=function(b){var h;h=function(f,e,g,a){var c=g;if(void 0===
g)throw new TypeError("Not enough arguments");this.ua=f;this.logger=f.getLogger("sip.clientcontext");this.method=e;g=f.normalizeTarget(g);if(!g)throw new TypeError("Invalid target: "+c);a=Object.create(a||Object.prototype);a.extraHeaders=(a.extraHeaders||[]).slice();a.contentType&&(this.contentType=a.contentType,a.extraHeaders.push("Content-Type: "+this.contentType));this.request=new b.OutgoingRequest(this.method,g,this.ua,a.params,a.extraHeaders);a.body&&(this.body=a.body,this.request.body=this.body);
this.localIdentity=this.request.from;this.remoteIdentity=this.request.to;this.data={}};h.prototype=Object.create(b.EventEmitter.prototype);h.prototype.send=function(){(new b.RequestSender(this,this.ua)).send();return this};h.prototype.cancel=function(f){f=f||{};f=b.Utils.getCancelReason(f.status_code,f.reason_phrase);this.request.cancel(f);this.emit("cancel")};h.prototype.receiveResponse=function(f){var e=b.Utils.getReasonPhrase(f.status_code);switch(!0){case /^1[0-9]{2}$/.test(f.status_code):this.emit("progress",
f,e);break;case /^2[0-9]{2}$/.test(f.status_code):this.ua.applicants[this]&&delete this.ua.applicants[this];this.emit("accepted",f,e);break;default:this.ua.applicants[this]&&delete this.ua.applicants[this],this.emit("rejected",f,e),this.emit("failed",f,e)}};h.prototype.onRequestTimeout=function(){this.emit("failed",null,b.C.causes.REQUEST_TIMEOUT)};h.prototype.onTransportError=function(){this.emit("failed",null,b.C.causes.CONNECTION_ERROR)};b.ClientContext=h}},{}],38:[function(k,l,n){l.exports=function(b,
h){return{USER_AGENT:b+"/"+h,SIP:"sip",SIPS:"sips",causes:{CONNECTION_ERROR:"Connection Error",REQUEST_TIMEOUT:"Request Timeout",SIP_FAILURE_CODE:"SIP Failure Code",INTERNAL_ERROR:"Internal Error",BUSY:"Busy",REJECTED:"Rejected",REDIRECTED:"Redirected",UNAVAILABLE:"Unavailable",NOT_FOUND:"Not Found",ADDRESS_INCOMPLETE:"Address Incomplete",INCOMPATIBLE_SDP:"Incompatible SDP",AUTHENTICATION_ERROR:"Authentication Error",DIALOG_ERROR:"Dialog Error",WEBRTC_NOT_SUPPORTED:"WebRTC Not Supported",WEBRTC_ERROR:"WebRTC Error",
CANCELED:"Canceled",NO_ANSWER:"No Answer",EXPIRES:"Expires",NO_ACK:"No ACK",NO_PRACK:"No PRACK",USER_DENIED_MEDIA_ACCESS:"User Denied Media Access",BAD_MEDIA_DESCRIPTION:"Bad Media Description",RTP_TIMEOUT:"RTP Timeout"},supported:{UNSUPPORTED:"none",SUPPORTED:"supported",REQUIRED:"required"},SIP_ERROR_CAUSES:{REDIRECTED:[300,301,302,305,380],BUSY:[486,600],REJECTED:[403,603],NOT_FOUND:[404,604],UNAVAILABLE:[480,410,408,430],ADDRESS_INCOMPLETE:[484],INCOMPATIBLE_SDP:[488,606],AUTHENTICATION_ERROR:[401,
407]},ACK:"ACK",BYE:"BYE",CANCEL:"CANCEL",INFO:"INFO",INVITE:"INVITE",MESSAGE:"MESSAGE",NOTIFY:"NOTIFY",OPTIONS:"OPTIONS",REGISTER:"REGISTER",UPDATE:"UPDATE",SUBSCRIBE:"SUBSCRIBE",REFER:"REFER",PRACK:"PRACK",REASON_PHRASE:{100:"Trying",180:"Ringing",181:"Call Is Being Forwarded",182:"Queued",183:"Session Progress",199:"Early Dialog Terminated",200:"OK",202:"Accepted",204:"No Notification",300:"Multiple Choices",301:"Moved Permanently",302:"Moved Temporarily",305:"Use Proxy",380:"Alternative Service",
400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",410:"Gone",412:"Conditional Request Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Unsupported URI Scheme",417:"Unknown Resource-Priority",420:"Bad Extension",421:"Extension Required",422:"Session Interval Too Small",423:"Interval Too Brief",428:"Use Identity Header",
429:"Provide Referrer Identity",430:"Flow Failed",433:"Anonymity Disallowed",436:"Bad Identity-Info",437:"Unsupported Certificate",438:"Invalid Identity Header",439:"First Hop Lacks Outbound Support",440:"Max-Breadth Exceeded",469:"Bad Info Package",470:"Consent Needed",478:"Unresolvable Destination",480:"Temporarily Unavailable",481:"Call/Transaction Does Not Exist",482:"Loop Detected",483:"Too Many Hops",484:"Address Incomplete",485:"Ambiguous",486:"Busy Here",487:"Request Terminated",488:"Not Acceptable Here",
489:"Bad Event",491:"Request Pending",493:"Undecipherable",494:"Security Agreement Required",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Server Time-out",505:"Version Not Supported",513:"Message Too Large",580:"Precondition Failure",600:"Busy Everywhere",603:"Decline",604:"Does Not Exist Anywhere",606:"Not Acceptable"}}}},{}],39:[function(k,l,n){l.exports=function(b){var h;h=function(b,e,g){this.dialog=b;this.applicant=e;this.request=g;this.reattempt=
!1;this.reattemptTimer=null};h.prototype={send:function(){var f=this,e=new b.RequestSender(this,this.dialog.owner.ua);e.send();this.request.method===b.C.INVITE&&e.clientTransaction.state!==b.Transactions.C.STATUS_TERMINATED&&(this.dialog.uac_pending_reply=!0,e.clientTransaction.on("stateChanged",function a(){if(this.state===b.Transactions.C.STATUS_ACCEPTED||this.state===b.Transactions.C.STATUS_COMPLETED||this.state===b.Transactions.C.STATUS_TERMINATED)if(this.removeListener("stateChanged",a),f.dialog.uac_pending_reply=
!1,!1===f.dialog.uas_pending_reply)f.dialog.owner.onReadyToReinvite()}))},onRequestTimeout:function(){this.applicant.onRequestTimeout()},onTransportError:function(){this.applicant.onTransportError()},receiveResponse:function(f){var e=this;if(408===f.status_code||481===f.status_code)this.applicant.onDialogError(f);else f.method===b.C.INVITE&&491===f.status_code?this.reattempt?this.applicant.receiveResponse(f):(this.request.cseq.value=this.dialog.local_seqnum+=1,this.reattemptTimer=b.Timers.setTimeout(function(){e.applicant.owner.status!==
b.Session.C.STATUS_TERMINATED&&(e.reattempt=!0,e.request_sender.send())},this.getReattemptTimeout())):this.applicant.receiveResponse(f)}};return h}},{}],40:[function(k,l,n){l.exports=function(b){var h=k("./Dialog/RequestSender")(b),f,e={STATUS_EARLY:1,STATUS_CONFIRMED:2};f=function(f,a,c,d){var m;this.uas_pending_reply=this.uac_pending_reply=!1;if(!a.hasHeader("contact"))return{error:"unable to create a Dialog without Contact header field"};d=a instanceof b.IncomingResponse?200>a.status_code?e.STATUS_EARLY:
e.STATUS_CONFIRMED:d||e.STATUS_CONFIRMED;m=a.parseHeader("contact");"UAS"===c?(this.id={call_id:a.call_id,local_tag:a.to_tag,remote_tag:a.from_tag,toString:function(){return this.call_id+this.local_tag+this.remote_tag}},this.state=d,this.remote_seqnum=a.cseq,this.local_uri=a.parseHeader("to").uri,this.remote_uri=a.parseHeader("from").uri,this.remote_target=m.uri,this.route_set=a.getHeaders("record-route"),this.local_seqnum=this.invite_seqnum=a.cseq):"UAC"===c&&(this.id={call_id:a.call_id,local_tag:a.from_tag,
remote_tag:a.to_tag,toString:function(){return this.call_id+this.local_tag+this.remote_tag}},this.state=d,this.local_seqnum=this.invite_seqnum=a.cseq,this.local_uri=a.parseHeader("from").uri,this.pracked=[],this.remote_uri=a.parseHeader("to").uri,this.remote_target=m.uri,this.route_set=a.getHeaders("record-route").reverse(),this.state!==e.STATUS_EARLY||f.hasOffer||(this.mediaHandler=f.mediaHandlerFactory(f)));this.logger=f.ua.getLogger("sip.dialog",this.id.toString());this.owner=f;f.ua.dialogs[this.id.toString()]=
this;this.logger.log("new "+c+" dialog created with status "+(this.state===e.STATUS_EARLY?"EARLY":"CONFIRMED"));f.emit("dialog",this)};f.prototype={update:function(b,a){this.state=e.STATUS_CONFIRMED;this.logger.log("dialog "+this.id.toString()+"  changed to CONFIRMED state");"UAC"===a&&(this.route_set=b.getHeaders("record-route").reverse())},terminate:function(){this.logger.log("dialog "+this.id.toString()+" deleted");this.mediaHandler&&this.state!==e.STATUS_CONFIRMED&&this.mediaHandler.peerConnection.close();
delete this.owner.ua.dialogs[this.id.toString()]},createRequest:function(e,a,c){var d;a=(a||[]).slice();this.local_seqnum||(this.local_seqnum=Math.floor(1E4*Math.random()));d=e===b.C.CANCEL||e===b.C.ACK?this.invite_seqnum:this.local_seqnum+=1;e=new b.OutgoingRequest(e,this.remote_target,this.owner.ua,{cseq:d,call_id:this.id.call_id,from_uri:this.local_uri,from_tag:this.id.local_tag,to_uri:this.remote_uri,to_tag:this.id.remote_tag,route_set:this.route_set},a,c);e.dialog=this;return e},checkInDialogRequest:function(e){var a=
this;if(this.remote_seqnum){if(e.cseq<this.remote_seqnum)return e.method!==b.C.ACK&&e.reply(500),e.cseq===this.invite_seqnum?!0:!1;e.cseq>this.remote_seqnum&&(this.remote_seqnum=e.cseq)}else this.remote_seqnum=e.cseq;switch(e.method){case b.C.INVITE:if(!0===this.uac_pending_reply)e.reply(491);else{if(!0===this.uas_pending_reply){var c=(10*Math.random()|0)+1;e.reply(500,null,["Retry-After:"+c]);return!1}this.uas_pending_reply=!0;e.server_transaction.on("stateChanged",function m(){if(this.state===b.Transactions.C.STATUS_ACCEPTED||
this.state===b.Transactions.C.STATUS_COMPLETED||this.state===b.Transactions.C.STATUS_TERMINATED)if(this.removeListener("stateChanged",m),a.uas_pending_reply=!1,!1===a.uac_pending_reply)a.owner.onReadyToReinvite()})}if(e.hasHeader("contact"))e.server_transaction.on("stateChanged",function(){this.state===b.Transactions.C.STATUS_ACCEPTED&&(a.remote_target=e.parseHeader("contact").uri)});break;case b.C.NOTIFY:if(e.hasHeader("contact"))e.server_transaction.on("stateChanged",function(){this.state===b.Transactions.C.STATUS_COMPLETED&&
(a.remote_target=e.parseHeader("contact").uri)})}return!0},sendRequest:function(b,a,c){c=c||{};var d=(c.extraHeaders||[]).slice();a=this.createRequest(a,d,c.body||null);(new h(this,b,a)).send();return a},receiveRequest:function(b){this.checkInDialogRequest(b)&&this.owner.receiveRequest(b)}};f.C=e;b.Dialog=f}},{"./Dialog/RequestSender":39}],41:[function(k,l,n){l.exports=function(b){var h;h=function(b){this.logger=b.getLogger("sipjs.digestauthentication");this.username=b.configuration.authorizationUser;
this.password=b.configuration.password;this.cnonce=null;this.nc=0;this.ncHex="00000000";this.response=null};h.prototype.authenticate=function(f,e){this.algorithm=e.algorithm;this.realm=e.realm;this.nonce=e.nonce;this.opaque=e.opaque;this.stale=e.stale;if(this.algorithm){if("MD5"!==this.algorithm)return this.logger.warn('challenge with Digest algorithm different than "MD5", authentication aborted'),!1}else this.algorithm="MD5";if(!this.realm)return this.logger.warn("challenge without Digest realm, authentication aborted"),
!1;if(!this.nonce)return this.logger.warn("challenge without Digest nonce, authentication aborted"),!1;if(e.qop)if(-1<e.qop.indexOf("auth"))this.qop="auth";else if(-1<e.qop.indexOf("auth-int"))this.qop="auth-int";else return this.logger.warn('challenge without Digest qop different than "auth" or "auth-int", authentication aborted'),!1;else this.qop=null;this.method=f.method;this.uri=f.ruri;this.cnonce=b.createRandomToken(12);this.nc+=1;this.updateNcHex();4294967296===this.nc&&(this.nc=1,this.ncHex=
"00000001");this.calculateResponse();return!0};h.prototype.calculateResponse=function(){var f,e;f=b.calculateMD5(this.username+":"+this.realm+":"+this.password);"auth"===this.qop?(e=b.calculateMD5(this.method+":"+this.uri),this.response=b.calculateMD5(f+":"+this.nonce+":"+this.ncHex+":"+this.cnonce+":auth:"+e)):"auth-int"===this.qop?(e=b.calculateMD5(this.method+":"+this.uri+":"+b.calculateMD5(this.body?this.body:"")),this.response=b.calculateMD5(f+":"+this.nonce+":"+this.ncHex+":"+this.cnonce+":auth-int:"+
e)):null===this.qop&&(e=b.calculateMD5(this.method+":"+this.uri),this.response=b.calculateMD5(f+":"+this.nonce+":"+e))};h.prototype.toString=function(){var b=[];if(!this.response)throw Error("response field does not exist, cannot generate Authorization header");b.push("algorithm="+this.algorithm);b.push('username="'+this.username+'"');b.push('realm="'+this.realm+'"');b.push('nonce="'+this.nonce+'"');b.push('uri="'+this.uri+'"');b.push('response="'+this.response+'"');this.opaque&&b.push('opaque="'+
this.opaque+'"');this.qop&&(b.push("qop="+this.qop),b.push('cnonce="'+this.cnonce+'"'),b.push("nc="+this.ncHex));return"Digest "+b.join(", ")};h.prototype.updateNcHex=function(){var b=Number(this.nc).toString(16);this.ncHex="00000000".substr(0,8-b.length)+b};return h}},{}],42:[function(k,l,n){var b=k("events").EventEmitter;l.exports=function(h){function f(){b.call(this)}f.prototype=Object.create(b.prototype,{constructor:{value:f,enumerable:!1,writable:!0,configurable:!0}});f.prototype.off=function(b,
f){var a;a="SIP.EventEmitter#off is deprecated and may be removed in future SIP.js versions.\nPlease use removeListener or removeAllListeners instead.\n";a+="See here for more details:\n";a+="http://nodejs.org/api/events.html#events_emitter_removelistener_event_listener";h.warn(a);return 2>arguments.length?this.removeAllListeners.apply(this,arguments):this.removeListener(b,f)};return f}},{events:30}],43:[function(k,l,n){l.exports={ConfigurationError:function(){var b=function(b,f){this.code=1;this.name=
"CONFIGURATION_ERROR";this.parameter=b;this.message=(this.value=f)?"Invalid value "+JSON.stringify(this.value)+' for parameter "'+this.parameter+'"':"Missing parameter: "+this.parameter};b.prototype=Error();return b}(),InvalidStateError:function(){var b=function(b){this.code=2;this.name="INVALID_STATE_ERROR";this.status=b;this.message="Invalid status: "+b};b.prototype=Error();return b}(),NotSupportedError:function(){var b=function(b){this.code=3;this.name="NOT_SUPPORTED_ERROR";this.message=b};b.prototype=
Error();return b}(),GetDescriptionError:function(){var b=function(b){this.code=4;this.name="GET_DESCRIPTION_ERROR";this.message=b};b.prototype=Error();return b}()}},{}],44:[function(k,l,n){var b=k("./Grammar/dist/Grammar");l.exports=function(h){return{parse:function(f,e){var g={startRule:e,SIP:h};try{b.parse(f,g)}catch(a){g.data=-1}return g.data}}}},{"./Grammar/dist/Grammar":45}],45:[function(k,l,n){l.exports=function(){function b(b,f,e,g,a,c){this.message=b;this.expected=f;this.found=e;this.offset=
g;this.line=a;this.column=c;this.name="SyntaxError"}(function(b,f){function e(){this.constructor=b}e.prototype=f.prototype;b.prototype=new e})(b,Error);return{SyntaxError:b,parse:function(h){function f(){return h.substring(C,v)}function e(a){if(q!==a){q>a&&(q=0,t={line:1,column:1,seenCR:!1});var b=t,c,d;for(c=q;c<a;c++)d=h.charAt(c),"\n"===d?(b.seenCR||b.line++,b.column=1,b.seenCR=!1):"\r"===d||"\u2028"===d||"\u2029"===d?(b.line++,b.column=1,b.seenCR=!0):(b.column++,b.seenCR=!1);q=a}return t}function g(a){v<
r||(v>r&&(r=v,u=[]),u.push(a))}function a(a){var b=Array(a.length),c;for(c=0;c<a.length;c++)b[c]=a.charCodeAt(c)-32;return b}function c(a){function b(a){return"[object Array]"===Object.prototype.toString.apply(a)?[]:a}a=n[a];for(var d=0,e=[],f=a.length,p=[],k=[],w,q;;){for(;d<f;)switch(a[d]){case 0:k.push(b(l[a[d+1]]));d+=2;break;case 1:k.push(v);d++;break;case 2:k.pop();d++;break;case 3:v=k.pop();d++;break;case 4:k.length-=a[d+1];d+=2;break;case 5:k.splice(-2,1);d++;break;case 6:k[k.length-2].push(k.pop());
d++;break;case 7:k.push(k.splice(k.length-a[d+1],a[d+1]));d+=2;break;case 8:k.pop();k.push(h.substring(k[k.length-1],v));d++;break;case 9:p.push(f);e.push(d+3+a[d+1]+a[d+2]);k[k.length-1]?(f=d+3+a[d+1],d+=3):(f=d+3+a[d+1]+a[d+2],d+=3+a[d+1]);break;case 10:p.push(f);e.push(d+3+a[d+1]+a[d+2]);k[k.length-1]===m?(f=d+3+a[d+1],d+=3):(f=d+3+a[d+1]+a[d+2],d+=3+a[d+1]);break;case 11:p.push(f);e.push(d+3+a[d+1]+a[d+2]);k[k.length-1]!==m?(f=d+3+a[d+1],d+=3):(f=d+3+a[d+1]+a[d+2],d+=3+a[d+1]);break;case 12:k[k.length-
1]!==m?(p.push(f),e.push(d),f=d+2+a[d+1],d+=2):d+=2+a[d+1];break;case 13:p.push(f);e.push(d+3+a[d+1]+a[d+2]);h.length>v?(f=d+3+a[d+1],d+=3):(f=d+3+a[d+1]+a[d+2],d+=3+a[d+1]);break;case 14:p.push(f);e.push(d+4+a[d+2]+a[d+3]);h.substr(v,l[a[d+1]].length)===l[a[d+1]]?(f=d+4+a[d+2],d+=4):(f=d+4+a[d+2]+a[d+3],d+=4+a[d+2]);break;case 15:p.push(f);e.push(d+4+a[d+2]+a[d+3]);h.substr(v,l[a[d+1]].length).toLowerCase()===l[a[d+1]]?(f=d+4+a[d+2],d+=4):(f=d+4+a[d+2]+a[d+3],d+=4+a[d+2]);break;case 16:p.push(f);
e.push(d+4+a[d+2]+a[d+3]);l[a[d+1]].test(h.charAt(v))?(f=d+4+a[d+2],d+=4):(f=d+4+a[d+2]+a[d+3],d+=4+a[d+2]);break;case 17:k.push(h.substr(v,a[d+1]));v+=a[d+1];d+=2;break;case 18:k.push(l[a[d+1]]);v+=l[a[d+1]].length;d+=2;break;case 19:k.push(m);0===F&&g(l[a[d+1]]);d+=2;break;case 20:C=k[k.length-1-a[d+1]];d+=2;break;case 21:C=v;d++;break;case 22:w=a.slice(d+4,d+4+a[d+3]);for(q=0;q<a[d+3];q++)w[q]=k[k.length-1-w[q]];k.splice(k.length-a[d+2],a[d+2],l[a[d+1]].apply(null,w));d+=4+a[d+3];break;case 23:k.push(c(a[d+
1]));d+=2;break;case 24:F++;d++;break;case 25:F--;d++;break;default:throw Error("Invalid opcode: "+a[d]+".");}if(0<p.length)f=p.pop(),d=e.pop();else break}return k[0]}var d=1<arguments.length?arguments[1]:{},m={},p={Contact:118,Name_Addr_Header:155,Record_Route:175,Request_Response:81,SIP_URI:45,Subscription_State:185,Via:193,absoluteURI:84,Call_ID:117,Content_Disposition:129,Content_Length:134,Content_Type:135,CSeq:145,displayName:121,Event:148,From:150,host:52,Max_Forwards:153,Proxy_Authenticate:156,
quoted_string:40,Refer_To:177,Replaces:178,stun_URI:212,To:191,turn_URI:219,uuid:222,WWW_Authenticate:208,challenge:157},k=118,l=["\r\n",{type:"literal",value:"\r\n",description:'"\\r\\n"'},/^[0-9]/,{type:"class",value:"[0-9]",description:"[0-9]"},/^[a-zA-Z]/,{type:"class",value:"[a-zA-Z]",description:"[a-zA-Z]"},/^[0-9a-fA-F]/,{type:"class",value:"[0-9a-fA-F]",description:"[0-9a-fA-F]"},/^[\0-\xFF]/,{type:"class",value:"[\\0-\\xFF]",description:"[\\0-\\xFF]"},/^["]/,{type:"class",value:'["]',description:'["]'},
" ",{type:"literal",value:" ",description:'" "'},"\t",{type:"literal",value:"\t",description:'"\\t"'},/^[a-zA-Z0-9]/,{type:"class",value:"[a-zA-Z0-9]",description:"[a-zA-Z0-9]"},";",{type:"literal",value:";",description:'";"'},"/",{type:"literal",value:"/",description:'"/"'},"?",{type:"literal",value:"?",description:'"?"'},":",{type:"literal",value:":",description:'":"'},"@",{type:"literal",value:"@",description:'"@"'},"&",{type:"literal",value:"&",description:'"&"'},"=",{type:"literal",value:"=",
description:'"="'},"+",{type:"literal",value:"+",description:'"+"'},"$",{type:"literal",value:"$",description:'"$"'},",",{type:"literal",value:",",description:'","'},"-",{type:"literal",value:"-",description:'"-"'},"_",{type:"literal",value:"_",description:'"_"'},".",{type:"literal",value:".",description:'"."'},"!",{type:"literal",value:"!",description:'"!"'},"~",{type:"literal",value:"~",description:'"~"'},"*",{type:"literal",value:"*",description:'"*"'},"'",{type:"literal",value:"'",description:'"\'"'},
"(",{type:"literal",value:"(",description:'"("'},")",{type:"literal",value:")",description:'")"'},m,"%",{type:"literal",value:"%",description:'"%"'},function(a){return a.join("")},null,[],function(){return" "},function(){return":"},function(){return f()},/^[!-~]/,{type:"class",value:"[!-~]",description:"[!-~]"},/^[\x80-\uFFFF]/,{type:"class",value:"[\\x80-\\uFFFF]",description:"[\\x80-\\uFFFF]"},/^[\x80-\xBF]/,{type:"class",value:"[\\x80-\\xBF]",description:"[\\x80-\\xBF]"},/^[a-f]/,{type:"class",
value:"[a-f]",description:"[a-f]"},"`",{type:"literal",value:"`",description:'"`"'},function(){return f()},"<",{type:"literal",value:"<",description:'"<"'},">",{type:"literal",value:">",description:'">"'},"\\",{type:"literal",value:"\\",description:'"\\\\"'},"[",{type:"literal",value:"[",description:'"["'},"]",{type:"literal",value:"]",description:'"]"'},"{",{type:"literal",value:"{",description:'"{"'},"}",{type:"literal",value:"}",description:'"}"'},function(){return"*"},function(){return"/"},function(){return"="},
function(){return"("},function(){return")"},function(){return">"},function(){return"<"},function(){return","},function(){return";"},function(){return":"},function(){return'"'},/^[!-']/,{type:"class",value:"[!-']",description:"[!-']"},/^[*-[]/,{type:"class",value:"[*-[]",description:"[*-[]"},/^[\]-~]/,{type:"class",value:"[\\]-~]",description:"[\\]-~]"},function(a){return a},/^[#-[]/,{type:"class",value:"[#-[]",description:"[#-[]"},/^[\0-\t]/,{type:"class",value:"[\\0-\\t]",description:"[\\0-\\t]"},
/^[\x0B-\f]/,{type:"class",value:"[\\x0B-\\f]",description:"[\\x0B-\\f]"},/^[\x0E-\u007f]/,{type:"class",value:"[\\x0E-\u007f]",description:"[\\x0E-\u007f]"},function(){d.data.uri=new d.SIP.URI(d.data.scheme,d.data.user,d.data.host,d.data.port);delete d.data.scheme;delete d.data.user;delete d.data.host;delete d.data.host_type;delete d.data.port},function(){d.data.uri=new d.SIP.URI(d.data.scheme,d.data.user,d.data.host,d.data.port,d.data.uri_params,d.data.uri_headers);delete d.data.scheme;delete d.data.user;
delete d.data.host;delete d.data.host_type;delete d.data.port;delete d.data.uri_params;"SIP_URI"===d.startRule&&(d.data=d.data.uri)},"sips",{type:"literal",value:"sips",description:'"sips"'},"sip",{type:"literal",value:"sip",description:'"sip"'},function(a){d.data.scheme=a.toLowerCase()},function(){d.data.user=decodeURIComponent(f().slice(0,-1))},function(){d.data.password=f()},function(){d.data.host=f();return d.data.host},function(){d.data.host_type="domain";return f()},/^[a-zA-Z0-9_\-]/,{type:"class",
value:"[a-zA-Z0-9_\\-]",description:"[a-zA-Z0-9_\\-]"},/^[a-zA-Z0-9\-]/,{type:"class",value:"[a-zA-Z0-9\\-]",description:"[a-zA-Z0-9\\-]"},function(){d.data.host_type="IPv6";return f()},"::",{type:"literal",value:"::",description:'"::"'},function(){d.data.host_type="IPv6";return f()},function(){d.data.host_type="IPv4";return f()},"25",{type:"literal",value:"25",description:'"25"'},/^[0-5]/,{type:"class",value:"[0-5]",description:"[0-5]"},"2",{type:"literal",value:"2",description:'"2"'},/^[0-4]/,{type:"class",
value:"[0-4]",description:"[0-4]"},"1",{type:"literal",value:"1",description:'"1"'},/^[1-9]/,{type:"class",value:"[1-9]",description:"[1-9]"},function(a){a=parseInt(a.join(""));return d.data.port=a},"transport=",{type:"literal",value:"transport=",description:'"transport="'},"udp",{type:"literal",value:"udp",description:'"udp"'},"tcp",{type:"literal",value:"tcp",description:'"tcp"'},"sctp",{type:"literal",value:"sctp",description:'"sctp"'},"tls",{type:"literal",value:"tls",description:'"tls"'},function(a){d.data.uri_params||
(d.data.uri_params={});d.data.uri_params.transport=a.toLowerCase()},"user=",{type:"literal",value:"user=",description:'"user="'},"phone",{type:"literal",value:"phone",description:'"phone"'},"ip",{type:"literal",value:"ip",description:'"ip"'},function(a){d.data.uri_params||(d.data.uri_params={});d.data.uri_params.user=a.toLowerCase()},"method=",{type:"literal",value:"method=",description:'"method="'},function(a){d.data.uri_params||(d.data.uri_params={});d.data.uri_params.method=a},"ttl=",{type:"literal",
value:"ttl=",description:'"ttl="'},function(a){d.data.params||(d.data.params={});d.data.params.ttl=a},"maddr=",{type:"literal",value:"maddr=",description:'"maddr="'},function(a){d.data.uri_params||(d.data.uri_params={});d.data.uri_params.maddr=a},"lr",{type:"literal",value:"lr",description:'"lr"'},function(){d.data.uri_params||(d.data.uri_params={});d.data.uri_params.lr=void 0},function(a,b){d.data.uri_params||(d.data.uri_params={});b=null===b?void 0:b[1];d.data.uri_params[a.toLowerCase()]=b&&b.toLowerCase()},
function(a){return a.join("")},function(a){return a.join("")},function(a,b){a=a.join("").toLowerCase();b=b.join("");d.data.uri_headers||(d.data.uri_headers={});d.data.uri_headers[a]?d.data.uri_headers[a].push(b):d.data.uri_headers[a]=[b]},function(){"Refer_To"===d.startRule&&(d.data.uri=new d.SIP.URI(d.data.scheme,d.data.user,d.data.host,d.data.port,d.data.uri_params,d.data.uri_headers),delete d.data.scheme,delete d.data.user,delete d.data.host,delete d.data.host_type,delete d.data.port,delete d.data.uri_params)},
"//",{type:"literal",value:"//",description:'"//"'},function(){d.data.scheme=f()},{type:"literal",value:"SIP",description:'"SIP"'},function(){d.data.sip_version=f()},"INVITE",{type:"literal",value:"INVITE",description:'"INVITE"'},"ACK",{type:"literal",value:"ACK",description:'"ACK"'},"VXACH",{type:"literal",value:"VXACH",description:'"VXACH"'},"OPTIONS",{type:"literal",value:"OPTIONS",description:'"OPTIONS"'},"BYE",{type:"literal",value:"BYE",description:'"BYE"'},"CANCEL",{type:"literal",value:"CANCEL",
description:'"CANCEL"'},"REGISTER",{type:"literal",value:"REGISTER",description:'"REGISTER"'},"SUBSCRIBE",{type:"literal",value:"SUBSCRIBE",description:'"SUBSCRIBE"'},"NOTIFY",{type:"literal",value:"NOTIFY",description:'"NOTIFY"'},"REFER",{type:"literal",value:"REFER",description:'"REFER"'},function(){d.data.method=f();return d.data.method},function(a){d.data.status_code=parseInt(a.join(""))},function(){d.data.reason_phrase=f()},function(){d.data=f()},function(){var a,b;b=d.data.multi_header.length;
for(a=0;a<b;a++)if(null===d.data.multi_header[a].parsed){d.data=null;break}d.data=null!==d.data?d.data.multi_header:-1},function(){var a;d.data.multi_header||(d.data.multi_header=[]);try{a=new d.SIP.NameAddrHeader(d.data.uri,d.data.displayName,d.data.params),delete d.data.uri,delete d.data.displayName,delete d.data.params}catch(b){a=null}d.data.multi_header.push({position:v,offset:C,parsed:a})},function(a){a=f().trim();'"'===a[0]&&(a=a.substring(1,a.length-1));d.data.displayName=a},"q",{type:"literal",
value:"q",description:'"q"'},function(a){d.data.params||(d.data.params={});d.data.params.q=a},"expires",{type:"literal",value:"expires",description:'"expires"'},function(a){d.data.params||(d.data.params={});d.data.params.expires=a},function(a){return parseInt(a.join(""))},"0",{type:"literal",value:"0",description:'"0"'},function(){return parseFloat(f())},function(a,b){d.data.params||(d.data.params={});b=null===b?void 0:b[1];d.data.params[a.toLowerCase()]=b},"render",{type:"literal",value:"render",
description:'"render"'},"session",{type:"literal",value:"session",description:'"session"'},"icon",{type:"literal",value:"icon",description:'"icon"'},"alert",{type:"literal",value:"alert",description:'"alert"'},function(){"Content_Disposition"===d.startRule&&(d.data.type=f().toLowerCase())},"handling",{type:"literal",value:"handling",description:'"handling"'},"optional",{type:"literal",value:"optional",description:'"optional"'},"required",{type:"literal",value:"required",description:'"required"'},
function(a){d.data=parseInt(a.join(""))},function(){d.data=f()},"text",{type:"literal",value:"text",description:'"text"'},"image",{type:"literal",value:"image",description:'"image"'},"audio",{type:"literal",value:"audio",description:'"audio"'},"video",{type:"literal",value:"video",description:'"video"'},"application",{type:"literal",value:"application",description:'"application"'},"message",{type:"literal",value:"message",description:'"message"'},"multipart",{type:"literal",value:"multipart",description:'"multipart"'},
"x-",{type:"literal",value:"x-",description:'"x-"'},function(a){d.data.value=parseInt(a.join(""))},function(a){d.data=a},function(a){d.data.event=a.toLowerCase()},function(){var a=d.data.tag;d.data=new d.SIP.NameAddrHeader(d.data.uri,d.data.displayName,d.data.params);a&&d.data.setParam("tag",a)},"tag",{type:"literal",value:"tag",description:'"tag"'},function(a){d.data.tag=a},function(a){d.data=parseInt(a.join(""))},function(a){d.data=a},function(){d.data=new d.SIP.NameAddrHeader(d.data.uri,d.data.displayName,
d.data.params)},"digest",{type:"literal",value:"Digest",description:'"Digest"'},"realm",{type:"literal",value:"realm",description:'"realm"'},function(a){d.data.realm=a},"domain",{type:"literal",value:"domain",description:'"domain"'},"nonce",{type:"literal",value:"nonce",description:'"nonce"'},function(a){d.data.nonce=a},"opaque",{type:"literal",value:"opaque",description:'"opaque"'},function(a){d.data.opaque=a},"stale",{type:"literal",value:"stale",description:'"stale"'},"true",{type:"literal",value:"true",
description:'"true"'},function(){d.data.stale=!0},"false",{type:"literal",value:"false",description:'"false"'},function(){d.data.stale=!1},"algorithm",{type:"literal",value:"algorithm",description:'"algorithm"'},"md5",{type:"literal",value:"MD5",description:'"MD5"'},"md5-sess",{type:"literal",value:"MD5-sess",description:'"MD5-sess"'},function(a){d.data.algorithm=a.toUpperCase()},"qop",{type:"literal",value:"qop",description:'"qop"'},"auth-int",{type:"literal",value:"auth-int",description:'"auth-int"'},
"auth",{type:"literal",value:"auth",description:'"auth"'},function(a){d.data.qop||(d.data.qop=[]);d.data.qop.push(a.toLowerCase())},function(a){d.data.value=parseInt(a.join(""))},function(){var a,b;b=d.data.multi_header.length;for(a=0;a<b;a++)if(null===d.data.multi_header[a].parsed){d.data=null;break}d.data=null!==d.data?d.data.multi_header:-1},function(){var a;d.data.multi_header||(d.data.multi_header=[]);try{a=new d.SIP.NameAddrHeader(d.data.uri,d.data.displayName,d.data.params),delete d.data.uri,
delete d.data.displayName,delete d.data.params}catch(b){a=null}d.data.multi_header.push({position:v,offset:C,parsed:a})},function(){d.data=new d.SIP.NameAddrHeader(d.data.uri,d.data.displayName,d.data.params)},function(){d.data.replaces_from_tag&&d.data.replaces_to_tag||(d.data=-1)},function(){d.data={call_id:d.data}},"from-tag",{type:"literal",value:"from-tag",description:'"from-tag"'},function(a){d.data.replaces_from_tag=a},"to-tag",{type:"literal",value:"to-tag",description:'"to-tag"'},function(a){d.data.replaces_to_tag=
a},"early-only",{type:"literal",value:"early-only",description:'"early-only"'},function(){d.data.early_only=!0},function(a){d.data.value=parseInt(a.join(""))},"active",{type:"literal",value:"active",description:'"active"'},"pending",{type:"literal",value:"pending",description:'"pending"'},"terminated",{type:"literal",value:"terminated",description:'"terminated"'},function(){d.data.state=f()},"reason",{type:"literal",value:"reason",description:'"reason"'},function(a){"undefined"!==typeof a&&(d.data.reason=
a)},function(a){"undefined"!==typeof a&&(d.data.expires=a)},"retry_after",{type:"literal",value:"retry_after",description:'"retry_after"'},function(a){"undefined"!==typeof a&&(d.data.retry_after=a)},"deactivated",{type:"literal",value:"deactivated",description:'"deactivated"'},"probation",{type:"literal",value:"probation",description:'"probation"'},"rejected",{type:"literal",value:"rejected",description:'"rejected"'},"timeout",{type:"literal",value:"timeout",description:'"timeout"'},"giveup",{type:"literal",
value:"giveup",description:'"giveup"'},"noresource",{type:"literal",value:"noresource",description:'"noresource"'},"invariant",{type:"literal",value:"invariant",description:'"invariant"'},function(){var a=d.data.tag;d.data=new d.SIP.NameAddrHeader(d.data.uri,d.data.displayName,d.data.params);a&&d.data.setParam("tag",a)},"ttl",{type:"literal",value:"ttl",description:'"ttl"'},function(a){d.data.ttl=a},"maddr",{type:"literal",value:"maddr",description:'"maddr"'},function(a){d.data.maddr=a},"received",
{type:"literal",value:"received",description:'"received"'},function(a){d.data.received=a},"branch",{type:"literal",value:"branch",description:'"branch"'},function(a){d.data.branch=a},"rport",{type:"literal",value:"rport",description:'"rport"'},function(){"undefined"!==typeof response_port&&(d.data.rport=response_port.join(""))},function(a){d.data.protocol=a},{type:"literal",value:"UDP",description:'"UDP"'},{type:"literal",value:"TCP",description:'"TCP"'},{type:"literal",value:"TLS",description:'"TLS"'},
{type:"literal",value:"SCTP",description:'"SCTP"'},function(a){d.data.transport=a},function(){d.data.host=f()},function(a){d.data.port=parseInt(a.join(""))},function(a){return parseInt(a.join(""))},"stuns",{type:"literal",value:"stuns",description:'"stuns"'},"stun",{type:"literal",value:"stun",description:'"stun"'},function(a){d.data.scheme=a},function(a){d.data.host=a},function(){return f()},"?transport=",{type:"literal",value:"?transport=",description:'"?transport="'},"turns",{type:"literal",value:"turns",
description:'"turns"'},"turn",{type:"literal",value:"turn",description:'"turn"'},function(){d.data.transport=transport},function(){d.data=f()}],n=[a('. ""2 3!'),a('0"""1!3#'),a('0$""1!3%'),a('0&""1!3\''),a("7'*# \"7("),a('0(""1!3)'),a('0*""1!3+'),a('.,""2,3-'),a('..""2.3/'),a('00""1!31'),a('.2""2233*\u0089 ".4""2435*} ".6""2637*q ".8""2839*e ".:""2:3;*Y ".<""2<3=*M ".>""2>3?*A ".@""2@3A*5 ".B""2B3C*) ".D""2D3E'),a('7)*# "7,'),a('.F""2F3G*} ".H""2H3I*q ".J""2J3K*e ".L""2L3M*Y ".N""2N3O*M ".P""2P3Q*A ".R""2R3S*5 ".T""2T3U*) ".V""2V3W'),
a('!!.Y""2Y3Z+7$7#+-%7#+#%\'#%$## X$"# X"# X+\' 4!6[!! %'),a('!! ]7$,#&7$"+-$7 +#%\'"%$"# X"# X*# " \\+@$ ]7$+&$,#&7$""" X+\'%4"6^" %$"# X"# X'),a('7.*# " \\'),a('! ]7\'*# "7(,)&7\'*# "7("+A$.8""2839+1%7/+\'%4#6_# %$## X$"# X"# X'),a('! ]72+&$,#&72""" X+s$ ]! ]7.,#&7."+-$72+#%\'"%$"# X"# X,@&! ]7.,#&7."+-$72+#%\'"%$"# X"# X"+\'%4"6`" %$"# X"# X'),a('0a""1!3b*# "73'),a('0c""1!3d'),a('0e""1!3f'),a('7!*) "0g""1!3h'),a('! ]7)*\u0095 ".F""2F3G*\u0089 ".J""2J3K*} ".L""2L3M*q ".Y""2Y3Z*e ".P""2P3Q*Y ".H""2H3I*M ".@""2@3A*A ".i""2i3j*5 ".R""2R3S*) ".N""2N3O+\u009e$,\u009b&7)*\u0095 ".F""2F3G*\u0089 ".J""2J3K*} ".L""2L3M*q ".Y""2Y3Z*e ".P""2P3Q*Y ".H""2H3I*M ".@""2@3A*A ".i""2i3j*5 ".R""2R3S*) ".N""2N3O""" X+& 4!6k! %'),
a('! ]7)*\u0089 ".F""2F3G*} ".L""2L3M*q ".Y""2Y3Z*e ".P""2P3Q*Y ".H""2H3I*M ".@""2@3A*A ".i""2i3j*5 ".R""2R3S*) ".N""2N3O+\u0092$,\u008f&7)*\u0089 ".F""2F3G*} ".L""2L3M*q ".Y""2Y3Z*e ".P""2P3Q*Y ".H""2H3I*M ".@""2@3A*A ".i""2i3j*5 ".R""2R3S*) ".N""2N3O""" X+& 4!6k! %'),a('.T""2T3U*\u00e3 ".V""2V3W*\u00d7 ".l""2l3m*\u00cb ".n""2n3o*\u00bf ".:""2:3;*\u00b3 ".D""2D3E*\u00a7 ".2""2233*\u009b ".8""2839*\u008f ".p""2p3q*\u0083 "7&*} ".4""2435*q ".r""2r3s*e ".t""2t3u*Y ".6""2637*M ".>""2>3?*A ".v""2v3w*5 ".x""2x3y*) "7\'*# "7('),
a('! ]7)*\u012b ".F""2F3G*\u011f ".J""2J3K*\u0113 ".L""2L3M*\u0107 ".Y""2Y3Z*\u00fb ".P""2P3Q*\u00ef ".H""2H3I*\u00e3 ".@""2@3A*\u00d7 ".i""2i3j*\u00cb ".R""2R3S*\u00bf ".N""2N3O*\u00b3 ".T""2T3U*\u00a7 ".V""2V3W*\u009b ".l""2l3m*\u008f ".n""2n3o*\u0083 ".8""2839*w ".p""2p3q*k "7&*e ".4""2435*Y ".r""2r3s*M ".t""2t3u*A ".6""2637*5 ".v""2v3w*) ".x""2x3y+\u0134$,\u0131&7)*\u012b ".F""2F3G*\u011f ".J""2J3K*\u0113 ".L""2L3M*\u0107 ".Y""2Y3Z*\u00fb ".P""2P3Q*\u00ef ".H""2H3I*\u00e3 ".@""2@3A*\u00d7 ".i""2i3j*\u00cb ".R""2R3S*\u00bf ".N""2N3O*\u00b3 ".T""2T3U*\u00a7 ".V""2V3W*\u009b ".l""2l3m*\u008f ".n""2n3o*\u0083 ".8""2839*w ".p""2p3q*k "7&*e ".4""2435*Y ".r""2r3s*M ".t""2t3u*A ".6""2637*5 ".v""2v3w*) ".x""2x3y""" X+& 4!6k! %'),
a('!7/+A$.P""2P3Q+1%7/+\'%4#6z# %$## X$"# X"# X'),a('!7/+A$.4""2435+1%7/+\'%4#6{# %$## X$"# X"# X'),a('!7/+A$.>""2>3?+1%7/+\'%4#6|# %$## X$"# X"# X'),a('!7/+A$.T""2T3U+1%7/+\'%4#6}# %$## X$"# X"# X'),a('!7/+A$.V""2V3W+1%7/+\'%4#6~# %$## X$"# X"# X'),a('!.n""2n3o+1$7/+\'%4"6\u007f" %$"# X"# X'),a('!7/+7$.l""2l3m+\'%4"6\u0080" %$"# X"# X'),a('!7/+A$.D""2D3E+1%7/+\'%4#6\u0081# %$## X$"# X"# X'),a('!7/+A$.2""2233+1%7/+\'%4#6\u0082# %$## X$"# X"# X'),a('!7/+A$.8""2839+1%7/+\'%4#6\u0083# %$## X$"# X"# X'),
a('!7/+1$7&+\'%4"6\u0084" %$"# X"# X'),a('!7&+1$7/+\'%4"6\u0084" %$"# X"# X'),a('!7=+W$ ]7G*) "7K*# "7F,/&7G*) "7K*# "7F"+-%7>+#%\'#%$## X$"# X"# X'),a('0\u0085""1!3\u0086*A "0\u0087""1!3\u0088*5 "0\u0089""1!3\u008a*) "73*# "7.'),a('!7/+Y$7&+O% ]7J*# "7K,)&7J*# "7K"+1%7&+\'%4$6k$ %$$# X$## X$"# X"# X'),a('!7/+`$7&+V%! ]7J*# "7K,)&7J*# "7K"+! (%+2%7&+(%4$6\u008b$!!%$$# X$## X$"# X"# X'),a('7.*G ".L""2L3M*; "0\u008c""1!3\u008d*/ "0\u0089""1!3\u008a*# "73'),a('!.p""2p3q+K$0\u008e""1!3\u008f*5 "0\u0090""1!3\u0091*) "0\u0092""1!3\u0093+#%\'"%$"# X"# X'),
a('!7N+Q$.8""2839+A%7O*# " \\+1%7S+\'%4$6\u0094$ %$$# X$## X$"# X"# X'),a('!7N+k$.8""2839+[%7O*# " \\+K%7S+A%7_+7%7l*# " \\+\'%4&6\u0095& %$&# X$%# X$$# X$## X$"# X"# X'),a('!/\u0096""1$3\u0097*) "/\u0098""1#3\u0099+\' 4!6\u009a!! %'),a('!7P+b$!.8""2839+-$7R+#%\'"%$"# X"# X*# " \\+7%.:""2:3;+\'%4#6\u009b# %$## X$"# X"# X'),a(' ]7+*) "7-*# "7Q+2$,/&7+*) "7-*# "7Q""" X'),a('.<""2<3=*q ".>""2>3?*e ".@""2@3A*Y ".B""2B3C*M ".D""2D3E*A ".2""2233*5 ".6""2637*) ".4""2435'),a('! ]7+*_ "7-*Y ".<""2<3=*M ".>""2>3?*A ".@""2@3A*5 ".B""2B3C*) ".D""2D3E,e&7+*_ "7-*Y ".<""2<3=*M ".>""2>3?*A ".@""2@3A*5 ".B""2B3C*) ".D""2D3E"+& 4!6\u009c! %'),
a('!7T+N$!.8""2839+-$7^+#%\'"%$"# X"# X*# " \\+#%\'"%$"# X"# X'),a('!7U*) "7\\*# "7X+& 4!6\u009d! %'),a('! ]!7V+3$.J""2J3K+#%\'"%$"# X"# X,>&!7V+3$.J""2J3K+#%\'"%$"# X"# X"+G$7W+=%.J""2J3K*# " \\+\'%4#6\u009e# %$## X$"# X"# X'),a(' ]0\u009f""1!3\u00a0+,$,)&0\u009f""1!3\u00a0""" X'),a('!0$""1!3%+A$ ]0\u00a1""1!3\u00a2,)&0\u00a1""1!3\u00a2"+#%\'"%$"# X"# X'),a('!.r""2r3s+A$7Y+7%.t""2t3u+\'%4#6\u00a3# %$## X$"# X"# X'),a('!!7Z+\u00bf$.8""2839+\u00af%7Z+\u00a5%.8""2839+\u0095%7Z+\u008b%.8""2839+{%7Z+q%.8""2839+a%7Z+W%.8""2839+G%7Z+=%.8""2839+-%7[+#%\'-%$-# X$,# X$+# X$*# X$)# X$(# X$\'# X$&# X$%# X$$# X$## X$"# X"# X*\u0838 "!.\u00a4""2\u00a43\u00a5+\u00af$7Z+\u00a5%.8""2839+\u0095%7Z+\u008b%.8""2839+{%7Z+q%.8""2839+a%7Z+W%.8""2839+G%7Z+=%.8""2839+-%7[+#%\',%$,# X$+# X$*# X$)# X$(# X$\'# X$&# X$%# X$$# X$## X$"# X"# X*\u0795 "!.\u00a4""2\u00a43\u00a5+\u0095$7Z+\u008b%.8""2839+{%7Z+q%.8""2839+a%7Z+W%.8""2839+G%7Z+=%.8""2839+-%7[+#%\'*%$*# X$)# X$(# X$\'# X$&# X$%# X$$# X$## X$"# X"# X*\u070c "!.\u00a4""2\u00a43\u00a5+{$7Z+q%.8""2839+a%7Z+W%.8""2839+G%7Z+=%.8""2839+-%7[+#%\'(%$(# X$\'# X$&# X$%# X$$# X$## X$"# X"# X*\u069d "!.\u00a4""2\u00a43\u00a5+a$7Z+W%.8""2839+G%7Z+=%.8""2839+-%7[+#%\'&%$&# X$%# X$$# X$## X$"# X"# X*\u0648 "!.\u00a4""2\u00a43\u00a5+G$7Z+=%.8""2839+-%7[+#%\'$%$$# X$## X$"# X"# X*\u060d "!.\u00a4""2\u00a43\u00a5+-$7[+#%\'"%$"# X"# X*\u05ec "!.\u00a4""2\u00a43\u00a5+-$7Z+#%\'"%$"# X"# X*\u05cb "!7Z+\u00a5$.\u00a4""2\u00a43\u00a5+\u0095%7Z+\u008b%.8""2839+{%7Z+q%.8""2839+a%7Z+W%.8""2839+G%7Z+=%.8""2839+-%7[+#%\'+%$+# X$*# X$)# X$(# X$\'# X$&# X$%# X$$# X$## X$"# X"# X*\u0538 "!7Z+\u00b6$!.8""2839+-$7Z+#%\'"%$"# X"# X*# " \\+\u008b%.\u00a4""2\u00a43\u00a5+{%7Z+q%.8""2839+a%7Z+W%.8""2839+G%7Z+=%.8""2839+-%7[+#%\'*%$*# X$)# X$(# X$\'# X$&# X$%# X$$# X$## X$"# X"# X*\u0494 "!7Z+\u00c7$!.8""2839+-$7Z+#%\'"%$"# X"# X*# " \\+\u009c%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " \\+q%.\u00a4""2\u00a43\u00a5+a%7Z+W%.8""2839+G%7Z+=%.8""2839+-%7[+#%\')%$)# X$(# X$\'# X$&# X$%# X$$# X$## X$"# X"# X*\u03df "!7Z+\u00d8$!.8""2839+-$7Z+#%\'"%$"# X"# X*# " \\+\u00ad%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " \\+\u0082%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " \\+W%.\u00a4""2\u00a43\u00a5+G%7Z+=%.8""2839+-%7[+#%\'(%$(# X$\'# X$&# X$%# X$$# X$## X$"# X"# X*\u0319 "!7Z+\u00e9$!.8""2839+-$7Z+#%\'"%$"# X"# X*# " \\+\u00be%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " \\+\u0093%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " \\+h%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " \\+=%.\u00a4""2\u00a43\u00a5+-%7[+#%\'\'%$\'# X$&# X$%# X$$# X$## X$"# X"# X*\u0242 "!7Z+\u0114$!.8""2839+-$7Z+#%\'"%$"# X"# X*# " \\+\u00e9%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " \\+\u00be%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " \\+\u0093%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " \\+h%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " \\+=%.\u00a4""2\u00a43\u00a5+-%7Z+#%\'(%$(# X$\'# X$&# X$%# X$$# X$## X$"# X"# X*\u0140 "!7Z+\u0135$!.8""2839+-$7Z+#%\'"%$"# X"# X*# " \\+\u010a%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " \\+\u00df%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " \\+\u00b4%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " \\+\u0089%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " \\+^%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " \\+3%.\u00a4""2\u00a43\u00a5+#%\'(%$(# X$\'# X$&# X$%# X$$# X$## X$"# X"# X+& 4!6\u00a6! %'),
a('!7#+S$7#*# " \\+C%7#*# " \\+3%7#*# " \\+#%\'$%$$# X$## X$"# X"# X'),a('!7Z+=$.8""2839+-%7Z+#%\'#%$## X$"# X"# X*# "7\\'),a('!7]+u$.J""2J3K+e%7]+[%.J""2J3K+K%7]+A%.J""2J3K+1%7]+\'%4\'6\u00a7\' %$\'# X$&# X$%# X$$# X$## X$"# X"# X'),a('!.\u00a8""2\u00a83\u00a9+3$0\u00aa""1!3\u00ab+#%\'"%$"# X"# X*\u00a0 "!.\u00ac""2\u00ac3\u00ad+=$0\u00ae""1!3\u00af+-%7!+#%\'#%$## X$"# X"# X*o "!.\u00b0""2\u00b03\u00b1+7$7!+-%7!+#%\'#%$## X$"# X"# X*D "!0\u00b2""1!3\u00b3+-$7!+#%\'"%$"# X"# X*# "7!'),a('!!7!*# " \\+c$7!*# " \\+S%7!*# " \\+C%7!*# " \\+3%7!*# " \\+#%\'%%$%# X$$# X$## X$"# X"# X+\' 4!6\u00b4!! %'),
a(' ]!.2""2233+-$7`+#%\'"%$"# X"# X,>&!.2""2233+-$7`+#%\'"%$"# X"# X"'),a('7a*A "7b*; "7c*5 "7d*/ "7e*) "7f*# "7g'),a('!/\u00b5""1*3\u00b6+b$/\u00b7""1#3\u00b8*G "/\u00b9""1#3\u00ba*; "/\u00bb""1$3\u00bc*/ "/\u00bd""1#3\u00be*# "76+(%4"6\u00bf"! %$"# X"# X'),a('!/\u00c0""1%3\u00c1+J$/\u00c2""1%3\u00c3*/ "/\u00c4""1"3\u00c5*# "76+(%4"6\u00c6"! %$"# X"# X'),a('!/\u00c7""1\'3\u00c8+2$7\u008f+(%4"6\u00c9"! %$"# X"# X'),a('!/\u00ca""1$3\u00cb+2$7\u00ef+(%4"6\u00cc"! %$"# X"# X'),a('!/\u00cd""1&3\u00ce+2$7T+(%4"6\u00cf"! %$"# X"# X'),
a('!/\u00d0""1"3\u00d1+R$!.>""2>3?+-$76+#%\'"%$"# X"# X*# " \\+\'%4"6\u00d2" %$"# X"# X'),a('!7h+T$!.>""2>3?+-$7i+#%\'"%$"# X"# X*# " \\+)%4"6\u00d3""! %$"# X"# X'),a('! ]7j+&$,#&7j""" X+\' 4!6\u00d4!! %'),a('! ]7j+&$,#&7j""" X+\' 4!6\u00d5!! %'),a('7k*) "7+*# "7-'),a('.r""2r3s*e ".t""2t3u*Y ".4""2435*M ".8""2839*A ".<""2<3=*5 ".@""2@3A*) ".B""2B3C'),a('!.6""2637+u$7m+k% ]!.<""2<3=+-$7m+#%\'"%$"# X"# X,>&!.<""2<3=+-$7m+#%\'"%$"# X"# X"+#%\'#%$## X$"# X"# X'),a('!7n+C$.>""2>3?+3%7o+)%4#6\u00d6#"" %$## X$"# X"# X'),
a(' ]7p*) "7+*# "7-+2$,/&7p*) "7+*# "7-""" X'),a(' ]7p*) "7+*# "7-,/&7p*) "7+*# "7-"'),a('.r""2r3s*e ".t""2t3u*Y ".4""2435*M ".6""2637*A ".8""2839*5 ".@""2@3A*) ".B""2B3C'),a('7\u0090*# "7r'),a("!7\u008f+K$7'+A%7s+7%7'+-%7\u0084+#%'%%$%# X$$# X$## X$\"# X\"# X"),a('7M*# "7t'),a('!7\u007f+G$.8""2839+7%7u*# "7x+\'%4#6\u00d7# %$## X$"# X"# X'),a('!7v*# "7w+N$!.6""2637+-$7\u0083+#%\'"%$"# X"# X*# " \\+#%\'"%$"# X"# X'),a('!.\u00d8""2\u00d83\u00d9+=$7\u0080+3%7w*# " \\+#%\'#%$## X$"# X"# X'),a('!.4""2435+-$7{+#%\'"%$"# X"# X'),
a('!7z+5$ ]7y,#&7y"+#%\'"%$"# X"# X'),a('7**) "7+*# "7-'),a('7+*\u008f "7-*\u0089 ".2""2233*} ".6""2637*q ".8""2839*e ".:""2:3;*Y ".<""2<3=*M ".>""2>3?*A ".@""2@3A*5 ".B""2B3C*) ".D""2D3E'),a('!7|+k$ ]!.4""2435+-$7|+#%\'"%$"# X"# X,>&!.4""2435+-$7|+#%\'"%$"# X"# X"+#%\'"%$"# X"# X'),a('! ]7~,#&7~"+k$ ]!.2""2233+-$7}+#%\'"%$"# X"# X,>&!.2""2233+-$7}+#%\'"%$"# X"# X"+#%\'"%$"# X"# X'),a(' ]7~,#&7~"'),a('7+*w "7-*q ".8""2839*e ".:""2:3;*Y ".<""2<3=*M ".>""2>3?*A ".@""2@3A*5 ".B""2B3C*) ".D""2D3E'),a('!7"+\u008d$ ]7"*G "7!*A ".@""2@3A*5 ".F""2F3G*) ".J""2J3K,M&7"*G "7!*A ".@""2@3A*5 ".F""2F3G*) ".J""2J3K"+\'%4"6\u00da" %$"# X"# X'),
a('7\u0081*# "7\u0082'),a('!!7O+3$.:""2:3;+#%\'"%$"# X"# X*# " \\+-$7S+#%\'"%$"# X"# X*# " \\'),a(' ]7+*\u0083 "7-*} ".B""2B3C*q ".D""2D3E*e ".2""2233*Y ".8""2839*M ".:""2:3;*A ".<""2<3=*5 ".>""2>3?*) ".@""2@3A+\u008c$,\u0089&7+*\u0083 "7-*} ".B""2B3C*q ".D""2D3E*e ".2""2233*Y ".8""2839*M ".:""2:3;*A ".<""2<3=*5 ".>""2>3?*) ".@""2@3A""" X'),a(' ]7y,#&7y"'),a('!/\u0098""1#3\u00db+y$.4""2435+i% ]7!+&$,#&7!""" X+P%.J""2J3K+@% ]7!+&$,#&7!""" X+\'%4%6\u00dc% %$%# X$$# X$## X$"# X"# X'),a('.\u00dd""2\u00dd3\u00de'),
a('.\u00df""2\u00df3\u00e0'),a('.\u00e1""2\u00e13\u00e2'),a('.\u00e3""2\u00e33\u00e4'),a('.\u00e5""2\u00e53\u00e6'),a('.\u00e7""2\u00e73\u00e8'),a('.\u00e9""2\u00e93\u00ea'),a('.\u00eb""2\u00eb3\u00ec'),a('.\u00ed""2\u00ed3\u00ee'),a('.\u00ef""2\u00ef3\u00f0'),a('!7\u0085*S "7\u0086*M "7\u0088*G "7\u0089*A "7\u008a*; "7\u008b*5 "7\u008c*/ "7\u008d*) "7\u008e*# "76+& 4!6\u00f1! %'),a("!7\u0084+K$7'+A%7\u0091+7%7'+-%7\u0093+#%'%%$%# X$$# X$## X$\"# X\"# X"),a("!7\u0092+' 4!6\u00f2!! %"),a('!7!+7$7!+-%7!+#%\'#%$## X$"# X"# X'),
a('! ]7**A "7+*; "7-*5 "73*/ "74*) "7\'*# "7(,G&7**A "7+*; "7-*5 "73*/ "74*) "7\'*# "7("+& 4!6\u00f3! %'),a('!7\u00b5+_$ ]!7A+-$7\u00b5+#%\'"%$"# X"# X,8&!7A+-$7\u00b5+#%\'"%$"# X"# X"+#%\'"%$"# X"# X'),a('!79+R$!.:""2:3;+-$79+#%\'"%$"# X"# X*# " \\+\'%4"6\u00f4" %$"# X"# X'),a('!7:*j "!7\u0097+_$ ]!7A+-$7\u0097+#%\'"%$"# X"# X,8&!7A+-$7\u0097+#%\'"%$"# X"# X"+#%\'"%$"# X"# X+& 4!6\u00f5! %'),a('!7L*# "7\u0098+c$ ]!7B+-$7\u009a+#%\'"%$"# X"# X,8&!7B+-$7\u009a+#%\'"%$"# X"# X"+\'%4"6\u00f6" %$"# X"# X'),
a('!7\u0099*# " \\+A$7@+7%7M+-%7?+#%\'$%$$# X$## X$"# X"# X'),a('!!76+_$ ]!7.+-$76+#%\'"%$"# X"# X,8&!7.+-$76+#%\'"%$"# X"# X"+#%\'"%$"# X"# X*# "7H+\' 4!6\u00f7!! %'),a('7\u009b*) "7\u009c*# "7\u009f'),a('!/\u00f8""1!3\u00f9+<$7<+2%7\u009e+(%4#6\u00fa#! %$## X$"# X"# X'),a('!/\u00fb""1\'3\u00fc+<$7<+2%7\u009d+(%4#6\u00fd#! %$## X$"# X"# X'),a('! ]7!+&$,#&7!""" X+\' 4!6\u00fe!! %'),a('!.\u00ff""2\u00ff3\u0100+x$!.J""2J3K+S$7!*# " \\+C%7!*# " \\+3%7!*# " \\+#%\'$%$$# X$## X$"# X"# X*# " \\+\'%4"6\u0101" %$"# X"# X'),
a('!76+N$!7<+-$7\u00a0+#%\'"%$"# X"# X*# " \\+)%4"6\u0102""! %$"# X"# X'),a('76*) "7T*# "7H'),a('!7\u00a2+_$ ]!7B+-$7\u00a3+#%\'"%$"# X"# X,8&!7B+-$7\u00a3+#%\'"%$"# X"# X"+#%\'"%$"# X"# X'),a('!/\u0103""1&3\u0104*G "/\u0105""1\'3\u0106*; "/\u0107""1$3\u0108*/ "/\u0109""1%3\u010a*# "76+& 4!6\u010b! %'),a('7\u00a4*# "7\u009f'),a('!/\u010c""1(3\u010d+O$7<+E%/\u010e""1(3\u010f*/ "/\u0110""1(3\u0111*# "76+#%\'#%$## X$"# X"# X'),a('!76+_$ ]!7A+-$76+#%\'"%$"# X"# X,8&!7A+-$76+#%\'"%$"# X"# X"+#%\'"%$"# X"# X'),
a('! ]7!+&$,#&7!""" X+\' 4!6\u0112!! %'),a("!7\u00a8+& 4!6\u0113! %"),a('!7\u00a9+s$7;+i%7\u00ae+_% ]!7B+-$7\u00af+#%\'"%$"# X"# X,8&!7B+-$7\u00af+#%\'"%$"# X"# X"+#%\'$%$$# X$## X$"# X"# X'),a('7\u00aa*# "7\u00ab'),a('/\u0114""1$3\u0115*S "/\u0116""1%3\u0117*G "/\u0118""1%3\u0119*; "/\u011a""1%3\u011b*/ "/\u011c""1+3\u011d*# "7\u00ac'),a('/\u011e""1\'3\u011f*/ "/\u0120""1)3\u0121*# "7\u00ac'),a('76*# "7\u00ad'),a('!/\u0122""1"3\u0123+-$76+#%\'"%$"# X"# X'),a('7\u00ac*# "76'),a('!76+7$7<+-%7\u00b0+#%\'#%$## X$"# X"# X'),
a('76*# "7H'),a('!7\u00b2+7$7.+-%7\u008f+#%\'#%$## X$"# X"# X'),a('! ]7!+&$,#&7!""" X+\' 4!6\u0124!! %'),a("!7\u009d+' 4!6\u0125!! %"),a('!7\u00b5+d$ ]!7B+-$7\u009f+#%\'"%$"# X"# X,8&!7B+-$7\u009f+#%\'"%$"# X"# X"+(%4"6\u0126"!!%$"# X"# X'),a('!!77+k$ ]!.J""2J3K+-$77+#%\'"%$"# X"# X,>&!.J""2J3K+-$77+#%\'"%$"# X"# X"+#%\'"%$"# X"# X+! (%'),a('!7L*# "7\u0098+c$ ]!7B+-$7\u00b7+#%\'"%$"# X"# X,8&!7B+-$7\u00b7+#%\'"%$"# X"# X"+\'%4"6\u0127" %$"# X"# X'),a('7\u00b8*# "7\u009f'),a('!/\u0128""1#3\u0129+<$7<+2%76+(%4#6\u012a#! %$## X$"# X"# X'),
a('! ]7!+&$,#&7!""" X+\' 4!6\u012b!! %'),a("!7\u009d+' 4!6\u012c!! %"),a('! ]7\u0099,#&7\u0099"+\u0081$7@+w%7M+m%7?+c% ]!7B+-$7\u009f+#%\'"%$"# X"# X,8&!7B+-$7\u009f+#%\'"%$"# X"# X"+\'%4%6\u012d% %$%# X$$# X$## X$"# X"# X'),a("7\u00bd"),a('!/\u012e""1&3\u012f+s$7.+i%7\u00c0+_% ]!7A+-$7\u00c0+#%\'"%$"# X"# X,8&!7A+-$7\u00c0+#%\'"%$"# X"# X"+#%\'$%$$# X$## X$"# X"# X*# "7\u00be'),a('!76+s$7.+i%7\u00bf+_% ]!7A+-$7\u00bf+#%\'"%$"# X"# X,8&!7A+-$7\u00bf+#%\'"%$"# X"# X"+#%\'$%$$# X$## X$"# X"# X'),a('!76+=$7<+3%76*# "7H+#%\'#%$## X$"# X"# X'),
a('7\u00c1*G "7\u00c3*A "7\u00c5*; "7\u00c7*5 "7\u00c8*/ "7\u00c9*) "7\u00ca*# "7\u00bf'),a('!/\u0130""1%3\u0131+7$7<+-%7\u00c2+#%\'#%$## X$"# X"# X'),a("!7I+' 4!6\u0132!! %"),a('!/\u0133""1&3\u0134+\u00a5$7<+\u009b%7D+\u0091%7\u00c4+\u0087% ]! ]7\'+&$,#&7\'""" X+-$7\u00c4+#%\'"%$"# X"# X,G&! ]7\'+&$,#&7\'""" X+-$7\u00c4+#%\'"%$"# X"# X"+-%7E+#%\'&%$&# X$%# X$$# X$## X$"# X"# X'),a('7t*# "7w'),a('!/\u0135""1%3\u0136+7$7<+-%7\u00c6+#%\'#%$## X$"# X"# X'),a("!7I+' 4!6\u0137!! %"),a('!/\u0138""1&3\u0139+<$7<+2%7I+(%4#6\u013a#! %$## X$"# X"# X'),
a('!/\u013b""1%3\u013c+_$7<+U%!/\u013d""1$3\u013e+& 4!6\u013f! %*4 "!/\u0140""1%3\u0141+& 4!6\u0142! %+#%\'#%$## X$"# X"# X'),a('!/\u0143""1)3\u0144+T$7<+J%/\u0145""1#3\u0146*/ "/\u0147""1(3\u0148*# "76+(%4#6\u0149#! %$## X$"# X"# X'),a('!/\u014a""1#3\u014b+\u009e$7<+\u0094%7D+\u008a%!7\u00cb+k$ ]!.D""2D3E+-$7\u00cb+#%\'"%$"# X"# X,>&!.D""2D3E+-$7\u00cb+#%\'"%$"# X"# X"+#%\'"%$"# X"# X+-%7E+#%\'%%$%# X$$# X$## X$"# X"# X'),a('!/\u014c""1(3\u014d*/ "/\u014e""1$3\u014f*# "76+\' 4!6\u0150!! %'),a('!76+_$ ]!7A+-$76+#%\'"%$"# X"# X,8&!7A+-$76+#%\'"%$"# X"# X"+#%\'"%$"# X"# X'),
a('!7\u00ce+K$7.+A%7\u00ce+7%7.+-%7\u008f+#%\'%%$%# X$$# X$## X$"# X"# X'),a('! ]7!+&$,#&7!""" X+\' 4!6\u0151!! %'),a('!7\u00d0+c$ ]!7A+-$7\u00d0+#%\'"%$"# X"# X,8&!7A+-$7\u00d0+#%\'"%$"# X"# X"+\'%4"6\u0152" %$"# X"# X'),a('!7\u0098+c$ ]!7B+-$7\u009f+#%\'"%$"# X"# X,8&!7B+-$7\u009f+#%\'"%$"# X"# X"+\'%4"6\u0153" %$"# X"# X'),a('!7L*T "7\u0098*N "!7@*# " \\+=$7t+3%7?*# " \\+#%\'#%$## X$"# X"# X+c$ ]!7B+-$7\u009f+#%\'"%$"# X"# X,8&!7B+-$7\u009f+#%\'"%$"# X"# X"+\'%4"6\u0154" %$"# X"# X'),a('!7\u00d3+c$ ]!7B+-$7\u00d4+#%\'"%$"# X"# X,8&!7B+-$7\u00d4+#%\'"%$"# X"# X"+\'%4"6\u0155" %$"# X"# X'),
a("!7\u0095+& 4!6\u0156! %"),a('!/\u0157""1(3\u0158+<$7<+2%76+(%4#6\u0159#! %$## X$"# X"# X*j "!/\u015a""1&3\u015b+<$7<+2%76+(%4#6\u015c#! %$## X$"# X"# X*: "!/\u015d""1*3\u015e+& 4!6\u015f! %*# "7\u009f'),a('!76+_$ ]!7A+-$76+#%\'"%$"# X"# X,8&!7A+-$76+#%\'"%$"# X"# X"+#%\'"%$"# X"# X'),a('!7\u00d7+_$ ]!7A+-$7\u00d7+#%\'"%$"# X"# X,8&!7A+-$7\u00d7+#%\'"%$"# X"# X"+#%\'"%$"# X"# X'),a('!7\u0098+_$ ]!7B+-$7\u009f+#%\'"%$"# X"# X,8&!7B+-$7\u009f+#%\'"%$"# X"# X"+#%\'"%$"# X"# X'),a('! ]7!+&$,#&7!""" X+\' 4!6\u0160!! %'),
a('!7\u00da+_$ ]!7B+-$7\u00db+#%\'"%$"# X"# X,8&!7B+-$7\u00db+#%\'"%$"# X"# X"+#%\'"%$"# X"# X'),a('!/\u0161""1&3\u0162*; "/\u0163""1\'3\u0164*/ "/\u0165""1*3\u0166*# "76+& 4!6\u0167! %'),a('!/\u0168""1&3\u0169+<$7<+2%7\u00dc+(%4#6\u016a#! %$## X$"# X"# X*\u0083 "!/\u00fb""1\'3\u00fc+<$7<+2%7\u009d+(%4#6\u016b#! %$## X$"# X"# X*S "!/\u016c""1+3\u016d+<$7<+2%7\u009d+(%4#6\u016e#! %$## X$"# X"# X*# "7\u009f'),a('/\u016f""1+3\u0170*k "/\u0171""1)3\u0172*_ "/\u0173""1(3\u0174*S "/\u0175""1\'3\u0176*G "/\u0177""1&3\u0178*; "/\u0179""1*3\u017a*/ "/\u017b""1)3\u017c*# "76'),
a('71*# " \\'),a('!76+_$ ]!7A+-$76+#%\'"%$"# X"# X,8&!7A+-$76+#%\'"%$"# X"# X"+#%\'"%$"# X"# X*# " \\'),a('!7L*# "7\u0098+c$ ]!7B+-$7\u00e0+#%\'"%$"# X"# X,8&!7B+-$7\u00e0+#%\'"%$"# X"# X"+\'%4"6\u017d" %$"# X"# X'),a('7\u00b8*# "7\u009f'),a('!7\u00e2+_$ ]!7A+-$7\u00e2+#%\'"%$"# X"# X,8&!7A+-$7\u00e2+#%\'"%$"# X"# X"+#%\'"%$"# X"# X'),a('!7\u00e9+s$7.+i%7\u00ec+_% ]!7B+-$7\u00e3+#%\'"%$"# X"# X,8&!7B+-$7\u00e3+#%\'"%$"# X"# X"+#%\'$%$$# X$## X$"# X"# X'),a('7\u00e4*; "7\u00e5*5 "7\u00e6*/ "7\u00e7*) "7\u00e8*# "7\u009f'),
a('!/\u017e""1#3\u017f+<$7<+2%7\u00ef+(%4#6\u0180#! %$## X$"# X"# X'),a('!/\u0181""1%3\u0182+<$7<+2%7T+(%4#6\u0183#! %$## X$"# X"# X'),a('!/\u0184""1(3\u0185+B$7<+8%7\\*# "7Y+(%4#6\u0186#! %$## X$"# X"# X'),a('!/\u0187""1&3\u0188+<$7<+2%76+(%4#6\u0189#! %$## X$"# X"# X'),a('!/\u018a""1%3\u018b+T$!7<+5$ ]7!,#&7!"+#%\'"%$"# X"# X*# " \\+\'%4"6\u018c" %$"# X"# X'),a('!7\u00ea+K$7;+A%76+7%7;+-%7\u00eb+#%\'%%$%# X$$# X$## X$"# X"# X'),a('!/\u0098""1#3\u00db*# "76+\' 4!6\u018d!! %'),a('!/\u00b7""1#3\u018e*G "/\u00b9""1#3\u018f*; "/\u00bd""1#3\u0190*/ "/\u00bb""1$3\u0191*# "76+\' 4!6\u0192!! %'),
a('!7\u00ed+H$!7C+-$7\u00ee+#%\'"%$"# X"# X*# " \\+#%\'"%$"# X"# X'),a('!7U*) "7\\*# "7X+& 4!6\u0193! %'),a('!!7!*# " \\+c$7!*# " \\+S%7!*# " \\+C%7!*# " \\+3%7!*# " \\+#%\'%%$%# X$$# X$## X$"# X"# X+\' 4!6\u0194!! %'),a('!!7!+C$7!*# " \\+3%7!*# " \\+#%\'#%$## X$"# X"# X+\' 4!6\u0195!! %'),a("7\u00bd"),a('!76+7$70+-%7\u00f2+#%\'#%$## X$"# X"# X'),a(' ]72*) "74*# "7.,/&72*) "74*# "7."'),a(' ]7%,#&7%"'),a('!7\u00f5+=$.8""2839+-%7\u00f6+#%\'#%$## X$"# X"# X'),a('!/\u0196""1%3\u0197*) "/\u0198""1$3\u0199+\' 4!6\u019a!! %'),
a('!7\u00f7+N$!.8""2839+-$7^+#%\'"%$"# X"# X*# " \\+#%\'"%$"# X"# X'),a('!7\\*) "7X*# "7\u0082+\' 4!6\u019b!! %'),a('! ]7\u00f9*) "7-*# "7\u00fa,/&7\u00f9*) "7-*# "7\u00fa"+& 4!6\u019c! %'),a('7"*S "7!*M ".F""2F3G*A ".J""2J3K*5 ".H""2H3I*) ".N""2N3O'),a('.L""2L3M*\u0095 ".B""2B3C*\u0089 ".<""2<3=*} ".R""2R3S*q ".T""2T3U*e ".V""2V3W*Y ".P""2P3Q*M ".@""2@3A*A ".D""2D3E*5 ".2""2233*) ".>""2>3?'),a('!7\u00fc+h$.8""2839+X%7\u00f6+N%!.\u019d""2\u019d3\u019e+-$7\u00eb+#%\'"%$"# X"# X*# " \\+#%\'$%$$# X$## X$"# X"# X'),
a('!/\u019f""1%3\u01a0*) "/\u01a1""1$3\u01a2+\' 4!6\u019a!! %'),a('!7\u00eb+Q$/\u00b7""1#3\u00b8*7 "/\u00b9""1#3\u00ba*+ " ]7+,#&7+"+\'%4"6\u01a3" %$"# X"# X'),a('!7\u0100+\u008f$.F""2F3G+\u007f%7\u00ff+u%.F""2F3G+e%7\u00ff+[%.F""2F3G+K%7\u00ff+A%.F""2F3G+1%7\u0101+\'%4)6\u01a4) %$)# X$(# X$\'# X$&# X$%# X$$# X$## X$"# X"# X'),a('!7#+A$7#+7%7#+-%7#+#%\'$%$$# X$## X$"# X"# X'),a('!7\u00ff+-$7\u00ff+#%\'"%$"# X"# X'),a('!7\u00ff+7$7\u00ff+-%7\u00ff+#%\'#%$## X$"# X"# X')],v=0,C=0,q=0,t={line:1,column:1,
seenCR:!1},r=0,u=[],F=0;if("startRule"in d){if(!(d.startRule in p))throw Error("Can't start parsing from rule \""+d.startRule+'".');k=p[d.startRule]}d.data={};p=c(k);if(p!==m&&v===h.length)return p;p!==m&&v<h.length&&g({type:"end",description:"end of input"});throw function(a,c,d){function f(a){var b=1;for(a.sort(function(a,b){return a.description<b.description?-1:a.description>b.description?1:0});b<a.length;)a[b-1]===a[b]?a.splice(b,1):b++}function m(a,b){function c(a){function b(a){return a.charCodeAt(0).toString(16).toUpperCase()}
return a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(a){return"\\x0"+b(a)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(a){return"\\x"+b(a)}).replace(/[\u0180-\u0FFF]/g,function(a){return"\\u0"+b(a)}).replace(/[\u1080-\uFFFF]/g,function(a){return"\\u"+b(a)})}var d=Array(a.length),e;for(e=0;e<a.length;e++)d[e]=a[e].description;d=1<a.length?d.slice(0,-1).join(", ")+
" or "+d[a.length-1]:d[0];e=b?'"'+c(b)+'"':"end of input";return"Expected "+d+" but "+e+" found."}var g=e(d),p=d<h.length?h.charAt(d):null;null!==c&&f(c);return new b(null!==a?a:m(c,p),c,p,d,g.line,g.column)}(null,u,r);}}}()},{}],46:[function(k,l,n){l.exports=function(b){var h={AllBrowsers:{maskDtls:function(b){},unmaskDtls:function(b){return b}},Firefox:{isFirefox:function(){return"undefined"!==typeof mozRTCPeerConnection},cannotHandleExtraWhitespace:function(b){this.isFirefox()&&b.body&&(b.body=
b.body.replace(/ \r\n/g,"\r\n"))},hasMissingCLineInSDP:function(b){var e,g;if(b.indexOf("c=")>b.indexOf("m=")){g=b.match(/m=.*\r\n.*/g);for(var a=0;a<g.length;a++)0<=g[a].toString().search(/i=.*/)?(e=b.indexOf(g[a].toString())+g[a].toString().length,"c="!==b.substr(e,2)&&(b=b.substr(0,e)+"\r\nc=IN IP4 0.0.0.0"+b.substr(e))):0>g[a].toString().search(/c=.*/)&&(e=b.indexOf(g[a].toString().match(/.*/))+g[a].toString().match(/.*/).toString().length,b=b.substr(0,e)+"\r\nc=IN IP4 0.0.0.0"+b.substr(e))}return b},
hasIncompatibleCLineWithSomeSIPEndpoints:function(f){return f.replace(/(0\.0\.0\.0)/gmi,b.Utils.getRandomTestNetIP())}},Chrome:{needsExplicitlyInactiveSDP:function(b){var e,g;return h.Firefox.isFirefox()&&(g=b.indexOf("m=video 0"),-1!==g)?(e=b.substr(g),e=e.replace(/\r\nc=IN IP4.*\r\n$/,"\r\nc=IN IP4 0.0.0.0\r\na=inactive\r\n"),b.substr(0,g)+e):b},getsConfusedAboutGUM:function(b){b.mediaHandler&&b.mediaHandler.close()}}};return h}},{}],47:[function(k,l,n){var b={error:0,warn:1,log:2,debug:3};l.exports=
function(h){function f(b,a,c){this.logger=b;this.category=a;this.label=c}var e=function(){var e,a=2,c=!0,d=null;this.loggers={};e=this.getLogger("sip.loggerfactory");Object.defineProperties(this,{builtinEnabled:{get:function(){return c},set:function(a){"boolean"===typeof a?c=a:e.error('invalid "builtinEnabled" parameter value: '+JSON.stringify(a))}},level:{get:function(){return a},set:function(c){0<=c&&3>=c?a=c:3<c?a=3:b.hasOwnProperty(c)?a=b[c]:e.error('invalid "level" parameter value: '+JSON.stringify(c))}},
connector:{get:function(){return d},set:function(a){null===a||""===a||void 0===a?d=null:"function"===typeof a?d=a:e.error('invalid "connector" parameter value: '+JSON.stringify(a))}}})};e.prototype.print=function(b,a,c,d){"string"===typeof d&&(a=[new Date,a],c&&a.push(c),d=a.concat(d).join(" | "));b.call(h,d)};Object.keys(b).forEach(function(g){f.prototype[g]=function(a){this.logger[g](this.category,this.label,a)};e.prototype[g]=function(a,c,d){this.level>=b[g]&&(this.builtinEnabled&&this.print(h[g],
a,c,d),this.connector&&this.connector(g,a,c,d))}});e.prototype.getLogger=function(b,a){var c;if(a&&3===this.level)return new f(this,b,a);if(this.loggers[b])return this.loggers[b];c=new f(this,b);return this.loggers[b]=c};return e}},{}],48:[function(k,l,n){l.exports=function(b){var h=function(b,e){};h.prototype=Object.create(b.prototype,{isReady:{value:function(){}},close:{value:function(){}},getDescription:{value:function(b){}},setDescription:{value:function(b){}}});return h}},{}],49:[function(k,
l,n){l.exports=function(b){var h;h=function(f,e,g){var a;if(!(f&&f instanceof b.URI))throw new TypeError('missing or invalid "uri" parameter');this.uri=f;this.parameters={};for(a in g)this.setParam(a,g[a]);Object.defineProperties(this,{friendlyName:{get:function(){return this.displayName||f.aor}},displayName:{get:function(){return e},set:function(a){e=0===a?"0":a}}})};h.prototype={setParam:function(b,e){b&&(this.parameters[b.toLowerCase()]="undefined"===typeof e||null===e?null:e.toString())},getParam:b.URI.prototype.getParam,
hasParam:b.URI.prototype.hasParam,deleteParam:b.URI.prototype.deleteParam,clearParams:b.URI.prototype.clearParams,clone:function(){return new h(this.uri.clone(),this.displayName,JSON.parse(JSON.stringify(this.parameters)))},toString:function(){var b,e;b=this.displayName||0===this.displayName?'"'+this.displayName+'" ':"";b+="<"+this.uri.toString()+">";for(e in this.parameters)b+=";"+e,null!==this.parameters[e]&&(b+="="+this.parameters[e]);return b}};h.parse=function(f){f=b.Grammar.parse(f,"Name_Addr_Header");
if(-1!==f)return f};b.NameAddrHeader=h}},{}],50:[function(k,l,n){l.exports=function(b){b.Parser={parseMessage:function(h,f){var e,g,a,c,d=0;a=h.indexOf("\r\n");g=f.getLogger("sip.parser");if(-1===a)g.warn("no CRLF found, not a SIP message, discarded");else if(e=h.substring(0,a),c=b.Grammar.parse(e,"Request_Response"),-1===c)g.warn('error parsing first line of SIP message: "'+e+'"');else{c.status_code?(e=new b.IncomingResponse(f),e.status_code=c.status_code,e.reason_phrase=c.reason_phrase):(e=new b.IncomingRequest(f),
e.method=c.method,e.ruri=c.uri);e.data=h;for(d=a+2;;){a:{a=h;c=d;var m=0,p=0;if(a.substring(c,c+2).match(/(^\r\n)/))a=-2;else{for(;0===m;){p=a.indexOf("\r\n",c);if(-1===p){a=p;break a}!a.substring(p+2,p+4).match(/(^\r\n)/)&&a.charAt(p+2).match(/(^\s+)/)?c=p+2:m=p}a=m}}if(-2===a){a=d+2;break}else if(-1===a){g.error("malformed message");return}c=e;var m=h,k=d,d=a,l=p=void 0,n=void 0,v=void 0,p=m.indexOf(":",k),k=m.substring(k,p).trim(),m=m.substring(p+1,d).trim();switch(k.toLowerCase()){case "via":case "v":c.addHeader("via",
m);if(1===c.getHeaders("via").length){if(v=c.parseHeader("Via"))c.via=v,c.via_branch=v.branch}else v=0;break;case "from":case "f":c.setHeader("from",m);if(v=c.parseHeader("from"))c.from=v,c.from_tag=v.getParam("tag");break;case "to":case "t":c.setHeader("to",m);if(v=c.parseHeader("to"))c.to=v,c.to_tag=v.getParam("tag");break;case "record-route":v=b.Grammar.parse(m,"Record_Route");if(-1===v){v=void 0;break}n=v.length;for(l=0;l<n;l++)p=v[l],c.addHeader("record-route",m.substring(p.position,p.offset)),
c.headers["Record-Route"][c.getHeaders("record-route").length-1].parsed=p.parsed;break;case "call-id":case "i":c.setHeader("call-id",m);if(v=c.parseHeader("call-id"))c.call_id=m;break;case "contact":case "m":v=b.Grammar.parse(m,"Contact");if(-1===v){v=void 0;break}n=v.length;for(l=0;l<n;l++)p=v[l],c.addHeader("contact",m.substring(p.position,p.offset)),c.headers.Contact[c.getHeaders("contact").length-1].parsed=p.parsed;break;case "content-length":case "l":c.setHeader("content-length",m);v=c.parseHeader("content-length");
break;case "content-type":case "c":c.setHeader("content-type",m);v=c.parseHeader("content-type");break;case "cseq":c.setHeader("cseq",m);if(v=c.parseHeader("cseq"))c.cseq=v.value;c instanceof b.IncomingResponse&&(c.method=v.method);break;case "max-forwards":c.setHeader("max-forwards",m);v=c.parseHeader("max-forwards");break;case "www-authenticate":c.setHeader("www-authenticate",m);v=c.parseHeader("www-authenticate");break;case "proxy-authenticate":c.setHeader("proxy-authenticate",m);v=c.parseHeader("proxy-authenticate");
break;case "refer-to":case "r":c.setHeader("refer-to",m);if(v=c.parseHeader("refer-to"))c.refer_to=v;break;default:c.setHeader(k,m),v=0}c=void 0===v?{error:'error parsing header "'+k+'"'}:!0;if(!0!==c){g.error(c.error);return}d=a+2}e.hasHeader("content-length")?(g=e.getHeader("content-length"),e.body=h.substr(a,g)):e.body=h.substring(a);return e}}}}},{}],51:[function(k,l,n){l.exports=function(b){var h;h=function(f){var e={};this.registrar=f.configuration.registrarServer;this.expires=f.configuration.registerExpires;
this.contact=f.contact.toString();this.contact+=";reg-id=1";this.contact+=';+sip.instance="<urn:uuid:'+f.configuration.instanceId+'>"';this.call_id=b.Utils.createRandomToken(22);this.cseq=80;this.to_uri=f.configuration.uri;e.to_uri=this.to_uri;e.call_id=this.call_id;e.cseq=this.cseq;b.Utils.augment(this,b.ClientContext,[f,"REGISTER",this.registrar,{params:e}]);this.registrationExpiredTimer=this.registrationTimer=null;this.registered=!1;this.logger=f.getLogger("sip.registercontext")};h.prototype={register:function(f){var e=
this;this.options=f||{};f=(this.options.extraHeaders||[]).slice();f.push("Contact: "+this.contact+";expires="+this.expires);f.push("Allow: "+b.Utils.getAllowedMethods(this.ua));this.receiveResponse=function(f){var a,c,d=f.getHeaders("contact").length;if(f.cseq===this.cseq)switch(null!==this.registrationTimer&&(b.Timers.clearTimeout(this.registrationTimer),this.registrationTimer=null),!0){case /^1[0-9]{2}$/.test(f.status_code):this.emit("progress",f);break;case /^2[0-9]{2}$/.test(f.status_code):this.emit("accepted",
f);f.hasHeader("expires")&&(c=f.getHeader("expires"));null!==this.registrationExpiredTimer&&(b.Timers.clearTimeout(this.registrationExpiredTimer),this.registrationExpiredTimer=null);if(!d){this.logger.warn("no Contact header in response to REGISTER, response ignored");break}for(;d--;)if(a=f.parseHeader("contact",d),a.uri.user===this.ua.contact.uri.user){c=a.getParam("expires");break}else a=null;if(!a){this.logger.warn("no Contact header pointing to us, response ignored");break}c||(c=this.expires);
this.registrationTimer=b.Timers.setTimeout(function(){e.registrationTimer=null;e.register(this.options)},1E3*c-3E3);this.registrationExpiredTimer=b.Timers.setTimeout(function(){e.logger.warn("registration expired");e.registered&&e.unregistered(null,b.C.causes.EXPIRES)},1E3*c);a.hasParam("temp-gruu")&&(this.ua.contact.temp_gruu=b.URI.parse(a.getParam("temp-gruu").replace(/"/g,"")));a.hasParam("pub-gruu")&&(this.ua.contact.pub_gruu=b.URI.parse(a.getParam("pub-gruu").replace(/"/g,"")));this.registered=
!0;this.emit("registered",f||null);break;case /^423$/.test(f.status_code):f.hasHeader("min-expires")?(this.expires=f.getHeader("min-expires"),this.register(this.options)):(this.logger.warn("423 response received for REGISTER without Min-Expires"),this.registrationFailure(f,b.C.causes.SIP_FAILURE_CODE));break;default:a=b.Utils.sipErrorCause(f.status_code),this.registrationFailure(f,a)}};this.onRequestTimeout=function(){this.registrationFailure(null,b.C.causes.REQUEST_TIMEOUT)};this.onTransportError=
function(){this.registrationFailure(null,b.C.causes.CONNECTION_ERROR)};this.cseq++;this.request.cseq=this.cseq;this.request.setHeader("cseq",this.cseq+" REGISTER");this.request.extraHeaders=f;this.send()},registrationFailure:function(b,e){this.emit("failed",b||null,e||null)},onTransportClosed:function(){this.registered_before=this.registered;null!==this.registrationTimer&&(b.Timers.clearTimeout(this.registrationTimer),this.registrationTimer=null);null!==this.registrationExpiredTimer&&(b.Timers.clearTimeout(this.registrationExpiredTimer),
this.registrationExpiredTimer=null);this.registered&&this.unregistered(null,b.C.causes.CONNECTION_ERROR)},onTransportConnected:function(){this.register(this.options)},close:function(){this.registered_before=this.registered;this.unregister(this.options)},unregister:function(f){var e;this.registered?(f=f||{},e=(f.extraHeaders||[]).slice(),this.registered=!1,null!==this.registrationTimer&&(b.Timers.clearTimeout(this.registrationTimer),this.registrationTimer=null),f.all?(e.push("Contact: *"),e.push("Expires: 0")):
e.push("Contact: "+this.contact+";expires=0"),this.receiveResponse=function(e){var a;switch(!0){case /^1[0-9]{2}$/.test(e.status_code):this.emit("progress",e);break;case /^2[0-9]{2}$/.test(e.status_code):this.emit("accepted",e);null!==this.registrationExpiredTimer&&(b.Timers.clearTimeout(this.registrationExpiredTimer),this.registrationExpiredTimer=null);this.unregistered(e);break;default:a=b.Utils.sipErrorCause(e.status_code),this.unregistered(e,a)}},this.onRequestTimeout=function(){},this.onTransportError=
function(){},this.cseq++,this.request.cseq=this.cseq,this.request.setHeader("cseq",this.cseq+" REGISTER"),this.request.extraHeaders=e,this.send()):this.logger.warn("already unregistered")},unregistered:function(b,e){this.registered=!1;this.emit("unregistered",b||null,e||null)}};b.RegisterContext=h}},{}],52:[function(k,l,n){l.exports=function(b){var h;h=function(f,e){this.logger=e.getLogger("sip.requestsender");this.ua=e;this.applicant=f;this.method=f.request.method;this.request=f.request;this.credentials=
null;this.staled=this.challenged=!1;if(e.status===b.UA.C.STATUS_USER_CLOSED&&(this.method!==b.C.BYE||this.method!==b.C.ACK))this.onTransportError()};h.prototype={send:function(){switch(this.method){case "INVITE":this.clientTransaction=new b.Transactions.InviteClientTransaction(this,this.request,this.ua.transport);break;case "ACK":this.clientTransaction=new b.Transactions.AckClientTransaction(this,this.request,this.ua.transport);break;default:this.clientTransaction=new b.Transactions.NonInviteClientTransaction(this,
this.request,this.ua.transport)}this.clientTransaction.send();return this.clientTransaction},onRequestTimeout:function(){this.applicant.onRequestTimeout()},onTransportError:function(){this.applicant.onTransportError()},receiveResponse:function(f){var e,g;g=f.status_code;401===g||407===g?(401===f.status_code?(e=f.parseHeader("www-authenticate"),g="authorization"):(e=f.parseHeader("proxy-authenticate"),g="proxy-authorization"),e?!this.challenged||!this.staled&&!0===e.stale?(this.credentials||(this.credentials=
this.ua.configuration.authenticationFactory(this.ua)),this.credentials.authenticate(this.request,e)?(this.challenged=!0,e.stale&&(this.staled=!0),f.method===b.C.REGISTER?f=this.applicant.cseq+=1:this.request.dialog?f=this.request.dialog.local_seqnum+=1:(f=this.request.cseq+1,this.request.cseq=f),this.request.setHeader("cseq",f+" "+this.method),this.request.setHeader(g,this.credentials.toString()),this.send()):this.applicant.receiveResponse(f)):this.applicant.receiveResponse(f):(this.logger.warn(f.status_code+
" with wrong or missing challenge, cannot authenticate"),this.applicant.receiveResponse(f))):this.applicant.receiveResponse(f)}};b.RequestSender=h}},{}],53:[function(k,l,n){var b={};l.exports=function(h){var f=k("../package.json");Object.defineProperties(b,{version:{get:function(){return f.version}},name:{get:function(){return f.title}}});k("./Utils")(b,h);b.LoggerFactory=k("./LoggerFactory")(h.console);b.EventEmitter=k("./EventEmitter")(h.console);b.C=k("./Constants")(b.name,b.version);b.Exceptions=
k("./Exceptions");b.Timers=k("./Timers")(h.timers);b.Transport=h.Transport(b,h.WebSocket);k("./Parser")(b);k("./SIPMessage")(b);k("./URI")(b);k("./NameAddrHeader")(b);k("./Transactions")(b);k("./Dialogs")(b);k("./RequestSender")(b);k("./RegisterContext")(b);b.MediaHandler=k("./MediaHandler")(b.EventEmitter);k("./ClientContext")(b);k("./ServerContext")(b);k("./Session")(b,h);k("./Subscription")(b);b.WebRTC=k("./WebRTC")(b,h);k("./UA")(b,h);b.Hacks=k("./Hacks")(b);k("./SanityCheck")(b);b.DigestAuthentication=
k("./DigestAuthentication")(b.Utils);b.Grammar=k("./Grammar")(b);return b}},{"../package.json":36,"./ClientContext":37,"./Constants":38,"./Dialogs":40,"./DigestAuthentication":41,"./EventEmitter":42,"./Exceptions":43,"./Grammar":44,"./Hacks":46,"./LoggerFactory":47,"./MediaHandler":48,"./NameAddrHeader":49,"./Parser":50,"./RegisterContext":51,"./RequestSender":52,"./SIPMessage":54,"./SanityCheck":55,"./ServerContext":56,"./Session":57,"./Subscription":59,"./Timers":60,"./Transactions":61,"./UA":63,
"./URI":64,"./Utils":65,"./WebRTC":66}],54:[function(k,l,n){l.exports=function(b){var h,f,e,g;h=function(a,c,d,e,f,g){e=e||{};if(!a||!c||!d)return null;this.logger=d.getLogger("sip.sipmessage");this.ua=d;this.headers={};this.method=a;this.ruri=c;this.body=g;this.extraHeaders=(f||[]).slice();this.statusCode=e.status_code;this.reasonPhrase=e.reason_phrase;e.route_set?this.setHeader("route",e.route_set):d.configuration.usePreloadedRoute&&this.setHeader("route",d.transport.server.sip_uri);this.setHeader("via",
"");this.setHeader("max-forwards",b.UA.C.MAX_FORWARDS);f=e.to_displayName||0===e.to_displayName?'"'+e.to_displayName+'" ':"";f+="<"+(e.to_uri||c)+">";f+=e.to_tag?";tag="+e.to_tag:"";this.to=new b.NameAddrHeader.parse(f);this.setHeader("to",f);c=e.from_displayName||0===e.from_displayName?'"'+e.from_displayName+'" ':d.configuration.displayName?'"'+d.configuration.displayName+'" ':"";c+="<"+(e.from_uri||d.configuration.uri)+">;tag=";c+=e.from_tag||b.Utils.newTag();this.from=new b.NameAddrHeader.parse(c);
this.setHeader("from",c);this.call_id=d=e.call_id||d.configuration.sipjsId+b.Utils.createRandomToken(15);this.setHeader("call-id",d);this.cseq=e=e.cseq||Math.floor(1E4*Math.random());this.setHeader("cseq",e+" "+a)};h.prototype={setHeader:function(a,c){this.headers[b.Utils.headerize(a)]=c instanceof Array?c:[c]},getHeader:function(a){var c,d=this.extraHeaders.length,e=this.headers[b.Utils.headerize(a)];if(e){if(e[0])return e[0]}else for(a=new RegExp("^\\s*"+a+"\\s*:","i"),c=0;c<d;c++)if(e=this.extraHeaders[c],
a.test(e))return e.substring(e.indexOf(":")+1).trim()},getHeaders:function(a){var c,d,e=this.headers[b.Utils.headerize(a)],f=[];if(e)for(c=e.length,a=0;a<c;a++)f.push(e[a]);else for(c=this.extraHeaders.length,d=new RegExp("^\\s*"+a+"\\s*:","i"),a=0;a<c;a++)e=this.extraHeaders[a],d.test(e)&&f.push(e.substring(e.indexOf(":")+1).trim());return f},hasHeader:function(a){var c,d=this.extraHeaders.length;if(this.headers[b.Utils.headerize(a)])return!0;a=new RegExp("^\\s*"+a+"\\s*:","i");for(c=0;c<d;c++)if(a.test(this.extraHeaders[c]))return!0;
return!1},toString:function(){var a,c,d,e,f=[];a=""+(this.method+" "+this.ruri+" SIP/2.0\r\n");for(c in this.headers)for(d=this.headers[c].length,e=0;e<d;e++)a+=c+": "+this.headers[c][e]+"\r\n";d=this.extraHeaders.length;for(e=0;e<d;e++)a+=this.extraHeaders[e].trim()+"\r\n";this.method===b.C.REGISTER?f.push("path","gruu"):this.method===b.C.INVITE&&(this.ua.contact.pub_gruu||this.ua.contact.temp_gruu)&&f.push("gruu");this.ua.configuration.rel100===b.C.supported.SUPPORTED&&f.push("100rel");this.ua.configuration.replaces===
b.C.supported.SUPPORTED&&f.push("replaces");f.push("outbound");a=a+("Supported: "+f+"\r\n")+("User-Agent: "+this.ua.configuration.userAgentString+"\r\n");this.body?(d=b.Utils.str_utf8_length(this.body),a+="Content-Length: "+d+"\r\n\r\n",a+=this.body):a+="Content-Length: 0\r\n\r\n";return a}};f=function(){this.body=this.to_tag=this.to=this.from_tag=this.from=this.cseq=this.call_id=this.via_branch=this.via=this.method=this.headers=this.data=null};f.prototype={addHeader:function(a,c){var d={raw:c};a=
b.Utils.headerize(a);this.headers[a]?this.headers[a].push(d):this.headers[a]=[d]},getHeader:function(a){if((a=this.headers[b.Utils.headerize(a)])&&a[0])return a[0].raw},getHeaders:function(a){var c,d=this.headers[b.Utils.headerize(a)],e=[];if(!d)return[];c=d.length;for(a=0;a<c;a++)e.push(d[a].raw);return e},hasHeader:function(a){return this.headers[b.Utils.headerize(a)]?!0:!1},parseHeader:function(a,c){var d,e,f;a=b.Utils.headerize(a);c=c||0;if(this.headers[a])if(c>=this.headers[a].length)this.logger.log('not so many "'+
a+'" headers present');else{d=this.headers[a][c];e=d.raw;if(d.parsed)return d.parsed;f=b.Grammar.parse(e,a.replace(/-/g,"_"));if(-1===f)this.headers[a].splice(c,1),this.logger.warn('error parsing "'+a+'" header field with value "'+e+'"');else return d.parsed=f}else this.logger.log('header "'+a+'" not present')},s:function(a,b){return this.parseHeader(a,b)},setHeader:function(a,c){var d={raw:c};this.headers[b.Utils.headerize(a)]=[d]},toString:function(){return this.data}};e=function(a){this.logger=
a.getLogger("sip.sipmessage");this.ua=a;this.headers={};this.server_transaction=this.transport=this.ruri=null};e.prototype=new f;e.prototype.reply=function(a,c,d,e,f,g){var h,k,l,n,q=[];l=this.getHeader("To");var t=k=0;n=b.Utils.buildStatusLine(a,c);d=(d||[]).slice();if(this.method===b.C.INVITE&&100<a&&200>=a)for(h=this.getHeaders("record-route"),c=h.length,k;k<c;k++)n+="Record-Route: "+h[k]+"\r\n";k=this.getHeaders("via");c=k.length;for(t;t<c;t++)n+="Via: "+k[t]+"\r\n";!this.to_tag&&100<a?l+=";tag="+
b.Utils.newTag():this.to_tag&&!this.s("to").hasParam("tag")&&(l+=";tag="+this.to_tag);n=n+("To: "+l+"\r\n")+("From: "+this.getHeader("From")+"\r\n");n+="Call-ID: "+this.call_id+"\r\n";n+="CSeq: "+this.cseq+" "+this.method+"\r\n";c=d.length;for(l=0;l<c;l++)n+=d[l].trim()+"\r\n";this.method===b.C.INVITE&&(this.ua.contact.pub_gruu||this.ua.contact.temp_gruu)&&q.push("gruu");this.ua.configuration.rel100===b.C.supported.SUPPORTED&&q.push("100rel");this.ua.configuration.replaces===b.C.supported.SUPPORTED&&
q.push("replaces");q.push("outbound");n+="Supported: "+q+"\r\n";n+="User-Agent: "+this.ua.configuration.userAgentString+"\r\n";e?(c=b.Utils.str_utf8_length(e),n+="Content-Type: application/sdp\r\n",n+="Content-Length: "+c+"\r\n\r\n",n+=e):n+="Content-Length: 0\r\n\r\n";this.server_transaction.receiveResponse(a,n).then(f,g);return n};e.prototype.reply_sl=function(a,c){var d,e;d=0;var f=this.getHeaders("via"),g=f.length;e=b.Utils.buildStatusLine(a,c);for(d;d<g;d++)e+="Via: "+f[d]+"\r\n";d=this.getHeader("To");
!this.to_tag&&100<a?d+=";tag="+b.Utils.newTag():this.to_tag&&!this.s("to").hasParam("tag")&&(d+=";tag="+this.to_tag);e=e+("To: "+d+"\r\n")+("From: "+this.getHeader("From")+"\r\n");e+="Call-ID: "+this.call_id+"\r\n";e+="CSeq: "+this.cseq+" "+this.method+"\r\n";e+="User-Agent: "+this.ua.configuration.userAgentString+"\r\n";e+="Content-Length: 0\r\n\r\n";this.transport.send(e)};g=function(a){this.logger=a.getLogger("sip.sipmessage");this.headers={};this.reason_phrase=this.status_code=null};g.prototype=
new f;b.OutgoingRequest=h;b.IncomingRequest=e;b.IncomingResponse=g}},{}],55:[function(k,l,n){l.exports=function(b){function h(c){var d;c=b.Utils.buildStatusLine(c);d=e.getHeaders("via");var f=d.length,g=0;for(g;g<f;g++)c+="Via: "+d[g]+"\r\n";d=e.getHeader("To");e.to_tag||(d+=";tag="+b.Utils.newTag());c=c+("To: "+d+"\r\n")+("From: "+e.getHeader("From")+"\r\n");c+="Call-ID: "+e.call_id+"\r\n";c+="CSeq: "+e.cseq+" "+e.method+"\r\n";c+="\r\n";a.send(c)}var f,e,g,a,c=[],d=[],m=[];c.push(function(){if(!e.ruri||
"sip"!==e.ruri.scheme)return h(416),!1});c.push(function(){if(!e.to_tag&&e.call_id.substr(0,5)===g.configuration.sipjsId)return h(482),!1});c.push(function(){var a=b.Utils.str_utf8_length(e.body),c=e.getHeader("content-length");if(a<c)return h(400),!1});c.push(function(){var a,c,d=e.from_tag,f=e.call_id,m=e.cseq;if(!e.to_tag)if(e.method===b.C.INVITE){if(a=g.transactions.ist[e.via_branch],!a)for(c in g.transactions.ist)if(a=g.transactions.ist[c],a.request.from_tag===d&&a.request.call_id===f&&a.request.cseq===
m)return h(482),!1}else if(a=g.transactions.nist[e.via_branch],!a)for(c in g.transactions.nist)if(a=g.transactions.nist[c],a.request.from_tag===d&&a.request.call_id===f&&a.request.cseq===m)return h(482),!1});d.push(function(){if(1<e.getHeaders("via").length)return f.warn("More than one Via header field present in the response. Dropping the response"),!1});d.push(function(){var a=b.Utils.str_utf8_length(e.body),c=e.getHeader("content-length");if(a<c)return f.warn("Message body length is lower than the value in Content-Length header field. Dropping the response"),
!1});m.push(function(){for(var a=["from","to","call_id","cseq","via"],b=a.length;b--;)if(!e.hasHeader(a[b]))return f.warn("Missing mandatory header field : "+a[b]+". Dropping the response"),!1});b.sanityCheck=function(h,k,l){e=h;g=k;a=l;f=g.getLogger("sip.sanitycheck");for(h=m.length;h--;)if(k=m[h](e),!1===k)return!1;if(e instanceof b.IncomingRequest)for(h=c.length;h--;){if(k=c[h](e),!1===k)return!1}else if(e instanceof b.IncomingResponse)for(h=d.length;h--;)if(k=d[h](e),!1===k)return!1;return!0}}},
{}],56:[function(k,l,n){l.exports=function(b){var h;h=function(f,e){this.ua=f;this.logger=f.getLogger("sip.servercontext");this.request=e;this.transaction=e.method===b.C.INVITE?new b.Transactions.InviteServerTransaction(e,f):new b.Transactions.NonInviteServerTransaction(e,f);e.body&&(this.body=e.body);e.hasHeader("Content-Type")&&(this.contentType=e.getHeader("Content-Type"));this.method=e.method;this.data={};this.localIdentity=e.to;this.remoteIdentity=e.from};h.prototype=Object.create(b.EventEmitter.prototype);
h.prototype.progress=function(b){b=Object.create(b||Object.prototype);b.statusCode||(b.statusCode=180);b.minCode=100;b.maxCode=199;b.events=["progress"];return this.reply(b)};h.prototype.accept=function(b){b=Object.create(b||Object.prototype);b.statusCode||(b.statusCode=200);b.minCode=200;b.maxCode=299;b.events=["accepted"];return this.reply(b)};h.prototype.reject=function(b){b=Object.create(b||Object.prototype);b.statusCode||(b.statusCode=480);b.minCode=300;b.maxCode=699;b.events=["rejected","failed"];
return this.reply(b)};h.prototype.reply=function(f){f=f||{};var e=f.statusCode||100,g=f.minCode||100,a=f.maxCode||699,c=b.Utils.getReasonPhrase(e,f.reasonPhrase),d=f.extraHeaders||[],m=f.body;f=f.events||[];var h;if(e<g||e>a)throw new TypeError("Invalid statusCode: "+e);h=this.request.reply(e,c,d,m);f.forEach(function(a){this.emit(a,h,c)},this);return this};h.prototype.onRequestTimeout=function(){this.emit("failed",null,b.C.causes.REQUEST_TIMEOUT)};h.prototype.onTransportError=function(){this.emit("failed",
null,b.C.causes.CONNECTION_ERROR)};b.ServerContext=h}},{}],57:[function(k,l,n){l.exports=function(b,h){var f=k("./Session/DTMF")(b),e,g,a={STATUS_NULL:0,STATUS_INVITE_SENT:1,STATUS_1XX_RECEIVED:2,STATUS_INVITE_RECEIVED:3,STATUS_WAITING_FOR_ANSWER:4,STATUS_ANSWERED:5,STATUS_WAITING_FOR_PRACK:6,STATUS_WAITING_FOR_ACK:7,STATUS_CANCELED:8,STATUS_TERMINATED:9,STATUS_ANSWERED_WAITING_FOR_PRACK:10,STATUS_EARLY_MEDIA:11,STATUS_CONFIRMED:12};e=function(c){this.status=a.STATUS_NULL;this.dialog=null;this.earlyDialogs=
{};this.mediaHandlerFactory=c||b.WebRTC.MediaHandler.defaultFactory;this.hasAnswer=this.hasOffer=!1;this.timers={ackTimer:null,expiresTimer:null,invite2xxTimer:null,userNoAnswerTimer:null,rel1xxTimer:null,prackTimer:null};this.tones=this.endTime=this.startTime=null;this.remote_hold=this.local_hold=!1;this.pending_actions={actions:[],length:function(){return this.actions.length},isPending:function(a){var b=0,c=this.actions.length;for(b;b<c;b++)if(this.actions[b].name===a)return!0;return!1},shift:function(){return this.actions.shift()},
push:function(a){this.actions.push({name:a})},pop:function(a){var b=0,c=this.actions.length;for(b;b<c;b++)this.actions[b].name===a&&(this.actions.splice(b,1),c--,b--)}};this.early_sdp=null;this.rel100=b.C.supported.UNSUPPORTED};e.prototype={dtmf:function(c,d){var e=[],g=this;d=d||{};if(void 0===c)throw new TypeError("Not enough arguments");if(this.status!==a.STATUS_CONFIRMED&&this.status!==a.STATUS_WAITING_FOR_ACK)throw new b.Exceptions.InvalidStateError(this.status);if("string"!==typeof c&&"number"!==
typeof c||!c.toString().match(/^[0-9A-D#*,]+$/i))throw new TypeError("Invalid tones: "+c);for(c=c.toString().split("");0<c.length;)e.push(new f(this,c.shift(),d));if(this.tones)return this.tones=this.tones.concat(e),this;var h=function(){var c;if(g.status===a.STATUS_TERMINATED||!g.tones||0===g.tones.length)return g.tones=null,this;c=g.tones.shift();c.on("failed",function(){g.tones=null});c.send(d);b.Timers.setTimeout(h,c.duration+c.interToneGap)};this.tones=e;h();return this},bye:function(c){c=Object.create(c||
Object.prototype);var d=c.statusCode;if(this.status===a.STATUS_TERMINATED)return this.logger.error("Error: Attempted to send BYE in a terminated session."),this;this.logger.log("terminating Session");if(d&&(200>d||700<=d))throw new TypeError("Invalid statusCode: "+d);c.receiveResponse=function(){};return this.sendRequest(b.C.BYE,c).terminated()},refer:function(c,d){d=d||{};var e=(d.extraHeaders||[]).slice(),f=c instanceof b.InviteServerContext||c instanceof b.InviteClientContext,g=c;if(void 0===c)throw new TypeError("Not enough arguments");
if(this.status!==a.STATUS_CONFIRMED)throw new b.Exceptions.InvalidStateError(this.status);if(f)c='"'+c.remoteIdentity.friendlyName+'" <'+c.dialog.remote_target.toString()+"?Replaces="+c.dialog.id.call_id+"%3Bto-tag%3D"+c.dialog.id.remote_tag+"%3Bfrom-tag%3D"+c.dialog.id.local_tag+">";else{try{c=b.Grammar.parse(c,"Refer_To").uri||c}catch(h){this.logger.debug(".refer() cannot parse Refer_To from",c),this.logger.debug("...falling through to normalizeTarget()")}c=this.ua.normalizeTarget(c);if(!c)throw new TypeError("Invalid target: "+
g);}e.push("Contact: "+this.contact);e.push("Allow: "+b.Utils.getAllowedMethods(this.ua));e.push("Refer-To: "+c);e.push("Allow-Events: refer");e.push("Event: refer;id="+Math.floor(1E3*Math.random()+1));this.sendRequest(b.C.REFER,{extraHeaders:e,body:d.body,receiveResponse:function(a){/^2[0-9]{2}$/.test(a.status_code)}.bind(this)});return this},followRefer:function(a){return function(a,c){var e=c.parseHeader("refer-to"),f=e.uri;if(f.scheme.match("^sips?$")){var g=[],k=f.getHeader("Replaces");void 0!==
k&&g.push("Replaces: "+decodeURIComponent(k));f.clearHeaders();k=(k=this.mediaHandler.getReferMedia)?k.call(this.mediaHandler):this.mediaHint;b.Hacks.Chrome.getsConfusedAboutGUM(this);e=this.ua.invite(f,{media:k,params:{to_displayName:e.friendlyName},extraHeaders:g});a.call(this,c,e);this.terminate()}else e=f.toString(),"function"===typeof h.open?h.open(e):this.logger.warn("referred to non-SIP URI but `open` isn't in the environment: "+e)}.bind(this,a)},sendRequest:function(a,d){d=d||{};var e=this,
f=new b.OutgoingRequest(a,this.dialog.remote_target,this.ua,{cseq:d.cseq||(this.dialog.local_seqnum+=1),call_id:this.dialog.id.call_id,from_uri:this.dialog.local_uri,from_tag:this.dialog.id.local_tag,to_uri:this.dialog.remote_uri,to_tag:this.dialog.id.remote_tag,route_set:this.dialog.route_set,statusCode:d.statusCode,reasonPhrase:d.reasonPhrase},d.extraHeaders||[],d.body);(new b.RequestSender({request:f,onRequestTimeout:function(){e.onRequestTimeout()},onTransportError:function(){e.onTransportError()},
receiveResponse:d.receiveResponse||function(a){e.receiveNonInviteResponse(a)}},this.ua)).send();this.emit(a.toLowerCase(),f);return this},close:function(){var c;if(this.status===a.STATUS_TERMINATED)return this;this.logger.log("closing INVITE session "+this.id);this.mediaHandler&&this.mediaHandler.close();for(c in this.timers)b.Timers.clearTimeout(this.timers[c]);this.dialog&&(this.dialog.terminate(),delete this.dialog);for(c in this.earlyDialogs)this.earlyDialogs[c].terminate(),delete this.earlyDialogs[c];
this.status=a.STATUS_TERMINATED;delete this.ua.sessions[this.id];return this},createDialog:function(a,d,e){var f,g=a.call_id+a["UAS"===d?"to_tag":"from_tag"]+a["UAS"===d?"from_tag":"to_tag"];f=this.earlyDialogs[g];if(e){if(f)return!0;f=new b.Dialog(this,a,d,b.Dialog.C.STATUS_EARLY);if(f.error)return this.logger.error(f.error),this.failed(a,b.C.causes.INTERNAL_ERROR),!1;this.earlyDialogs[g]=f;return!0}if(f){f.update(a,d);this.dialog=f;delete this.earlyDialogs[g];for(var h in this.earlyDialogs)this.earlyDialogs[h].terminate(),
delete this.earlyDialogs[h];return!0}d=new b.Dialog(this,a,d);if(d.error)return this.logger.error(d.error),this.failed(a,b.C.causes.INTERNAL_ERROR),!1;this.to_tag=a.to_tag;this.dialog=d;return!0},isReadyToReinvite:function(){return this.mediaHandler.isReady()&&!this.dialog.uac_pending_reply&&!this.dialog.uas_pending_reply},mute:function(a){if(a=this.mediaHandler.mute(a))this.onmute(a)},unmute:function(a){if(a=this.mediaHandler.unmute(a))this.onunmute(a)},hold:function(){if(this.status!==a.STATUS_WAITING_FOR_ACK&&
this.status!==a.STATUS_CONFIRMED)throw new b.Exceptions.InvalidStateError(this.status);this.mediaHandler.hold();this.isReadyToReinvite()?!0!==this.local_hold&&(this.onhold("local"),this.sendReinvite({mangle:function(a){/a=(sendrecv|sendonly|recvonly|inactive)/.test(a)?(a=a.replace(/a=sendrecv\r\n/g,"a=sendonly\r\n"),a=a.replace(/a=recvonly\r\n/g,"a=inactive\r\n")):a=a.replace(/(m=[^\r]*\r\n)/g,"$1a=sendonly\r\n");return a}})):this.pending_actions.isPending("unhold")?this.pending_actions.pop("unhold"):
this.pending_actions.isPending("hold")||this.pending_actions.push("hold")},unhold:function(){if(this.status!==a.STATUS_WAITING_FOR_ACK&&this.status!==a.STATUS_CONFIRMED)throw new b.Exceptions.InvalidStateError(this.status);this.mediaHandler.unhold();this.isReadyToReinvite()?!1!==this.local_hold&&(this.onunhold("local"),this.sendReinvite()):this.pending_actions.isPending("hold")?this.pending_actions.pop("hold"):this.pending_actions.isPending("unhold")||this.pending_actions.push("unhold")},isOnHold:function(){return{local:this.local_hold,
remote:this.remote_hold}},receiveReinvite:function(c){var d=this;c.body&&("application/sdp"!==c.getHeader("Content-Type")?(this.logger.warn("invalid Content-Type"),c.reply(415)):this.mediaHandler.setDescription(c.body).then(this.mediaHandler.getDescription.bind(this.mediaHandler,this.mediaHint)).then(function(b){c.reply(200,null,["Contact: "+d.contact],b,function(){d.status=a.STATUS_WAITING_FOR_ACK;d.setInvite2xxTimer(c,b);d.setACKTimer();var e=/a=(sendonly|inactive)/.test(c.body);if(d.remote_hold&&
!e)d.onunhold("remote");else if(!d.remote_hold&&e)d.onhold("remote")})}).catch(function(a){a instanceof b.Exceptions.GetDescriptionError?a=500:(d.logger.error(a),a=488);c.reply(a)}))},sendReinvite:function(c){c=c||{};var d=this,e=(c.extraHeaders||[]).slice(),f=c.eventHandlers||{};c=c.mangle||null;this.reinviteSucceeded=f.succeeded?f.succeeded:function(){b.Timers.clearTimeout(d.timers.ackTimer);b.Timers.clearTimeout(d.timers.invite2xxTimer);d.status=a.STATUS_CONFIRMED};this.reinviteFailed=f.failed?
f.failed:function(){};e.push("Contact: "+this.contact);e.push("Allow: "+b.Utils.getAllowedMethods(this.ua));e.push("Content-Type: application/sdp");this.receiveResponse=this.receiveReinviteResponse;this.mediaHandler.getDescription(d.mediaHint).then(c).then(function(a){d.dialog.sendRequest(d,b.C.INVITE,{extraHeaders:e,body:a})},function(){if(d.isReadyToReinvite())d.onReadyToReinvite();d.reinviteFailed()})},receiveRequest:function(c){switch(c.method){case b.C.BYE:c.reply(200);this.status===a.STATUS_CONFIRMED&&
(this.emit("bye",c),this.terminated(c,b.C.causes.BYE));break;case b.C.INVITE:this.status===a.STATUS_CONFIRMED&&(this.logger.log("re-INVITE received"),this.receiveReinvite(c));break;case b.C.INFO:if(this.status===a.STATUS_CONFIRMED||this.status===a.STATUS_WAITING_FOR_ACK){var d,e,g;d=c.getHeader("content-type");var h=/^(Signal\s*?=\s*?)([0-9A-D#*]{1})(\s)?.*/,k=/^(Duration\s?=\s?)([0-9]{1,4})(\s)?.*/;d&&(d.match(/^application\/dtmf-relay/i)?(c.body&&(d=c.body.split("\r\n",2),2===d.length&&(h.test(d[0])&&
(e=d[0].replace(h,"$2")),k.test(d[1])&&(g=parseInt(d[1].replace(k,"$2"),10)))),(new f(this,e,{duration:g})).init_incoming(c)):c.reply(415,null,["Accept: application/dtmf-relay"]))}break;case b.C.REFER:this.status===a.STATUS_CONFIRMED&&(this.logger.log("REFER received"),c.reply(202,"Accepted"),e=this.listeners("refer").length,this.sendRequest(b.C.NOTIFY,{extraHeaders:["Event: refer","Subscription-State: terminated","Content-Type: message/sipfrag"],body:e?"SIP/2.0 100 Trying":"SIP/2.0 603 Declined",
receiveResponse:function(){}}),e&&this.emit("refer",c));break;case b.C.NOTIFY:c.reply(200,"OK")}},receiveReinviteResponse:function(c){var d=this,e=c.getHeader("Content-Type");if(this.status!==a.STATUS_TERMINATED)switch(!0){case /^1[0-9]{2}$/.test(c.status_code):break;case /^2[0-9]{2}$/.test(c.status_code):this.status=a.STATUS_CONFIRMED;this.sendRequest(b.C.ACK,{cseq:c.cseq});if(!c.body){this.reinviteFailed();break}else if("application/sdp"!==e){this.reinviteFailed();break}this.mediaHandler.setDescription(c.body).then(function(){d.reinviteSucceeded()},
function(){d.reinviteFailed()});break;default:this.reinviteFailed()}},acceptAndTerminate:function(a,d,e){var f=[];d&&f.push("Reason: "+b.Utils.getReasonHeaderValue(d,e));if(this.dialog||this.createDialog(a,"UAC"))this.sendRequest(b.C.ACK,{cseq:a.cseq}),this.sendRequest(b.C.BYE,{extraHeaders:f});return this},setInvite2xxTimer:function(c,d){var e=this,f=b.Timers.T1;this.timers.invite2xxTimer=b.Timers.setTimeout(function z(){e.status===a.STATUS_WAITING_FOR_ACK&&(e.logger.log("no ACK received, attempting to retransmit OK"),
c.reply(200,null,["Contact: "+e.contact],d),f=Math.min(2*f,b.Timers.T2),e.timers.invite2xxTimer=b.Timers.setTimeout(z,f))},f)},setACKTimer:function(){var c=this;this.timers.ackTimer=b.Timers.setTimeout(function(){c.status===a.STATUS_WAITING_FOR_ACK&&(c.logger.log("no ACK received for an extended period of time, terminating the call"),b.Timers.clearTimeout(c.timers.invite2xxTimer),c.sendRequest(b.C.BYE),c.terminated(null,b.C.causes.NO_ACK))},b.Timers.TIMER_H)},onReadyToReinvite:function(){var a=this.pending_actions.shift();
if(a&&this[a.name])this[a.name]()},onTransportError:function(){this.status!==a.STATUS_CONFIRMED&&this.status!==a.STATUS_TERMINATED&&this.failed(null,b.C.causes.CONNECTION_ERROR)},onRequestTimeout:function(){this.status===a.STATUS_CONFIRMED?this.terminated(null,b.C.causes.REQUEST_TIMEOUT):this.status!==a.STATUS_TERMINATED&&(this.failed(null,b.C.causes.REQUEST_TIMEOUT),this.terminated(null,b.C.causes.REQUEST_TIMEOUT))},onDialogError:function(c){this.status===a.STATUS_CONFIRMED?this.terminated(c,b.C.causes.DIALOG_ERROR):
this.status!==a.STATUS_TERMINATED&&(this.failed(c,b.C.causes.DIALOG_ERROR),this.terminated(c,b.C.causes.DIALOG_ERROR))},onhold:function(a){this["local"===a?"local_hold":"remote_hold"]=!0;this.emit("hold",{originator:a})},onunhold:function(a){this["local"===a?"local_hold":"remote_hold"]=!1;this.emit("unhold",{originator:a})},onmute:function(a){this.emit("muted",{audio:a.audio,video:a.video})},onunmute:function(a){this.emit("unmuted",{audio:a.audio,video:a.video})},failed:function(b,d){if(this.status===
a.STATUS_TERMINATED)return this;this.emit("failed",b||null,d||null);return this},rejected:function(a,b){this.emit("rejected",a||null,b||null);return this},canceled:function(){this.emit("cancel");return this},accepted:function(a,d){d=b.Utils.getReasonPhrase(a&&a.status_code,d);this.startTime=new Date;this.replacee&&(this.replacee.emit("replaced",this),this.replacee.terminate());this.emit("accepted",a,d);return this},terminated:function(b,d){if(this.status===a.STATUS_TERMINATED)return this;this.endTime=
new Date;this.close();this.emit("terminated",{message:b||null,cause:d||null});return this},connecting:function(a){this.emit("connecting",{request:a});return this}};e.desugar=function(a){h.HTMLMediaElement&&a instanceof h.HTMLMediaElement&&(a={media:{constraints:{audio:!0,video:"VIDEO"===a.tagName},render:{remote:a}}});return a||{}};e.C=a;b.Session=e;g=function(c,d){function e(a,b){d.hasHeader(a)&&0<=d.getHeader(a).toLowerCase().indexOf("100rel")&&(h.rel100=b)}function f(){var c={extraHeaders:["Contact: "+
h.contact]};h.rel100!==b.C.supported.REQUIRED&&h.progress(c);h.status=a.STATUS_WAITING_FOR_ANSWER;h.timers.userNoAnswerTimer=b.Timers.setTimeout(function(){d.reply(408);h.failed(d,b.C.causes.NO_ANSWER);h.terminated(d,b.C.causes.NO_ANSWER)},h.ua.configuration.noAnswerTimeout);g&&(h.timers.expiresTimer=b.Timers.setTimeout(function(){h.status===a.STATUS_WAITING_FOR_ANSWER&&(d.reply(487),h.failed(d,b.C.causes.EXPIRES),h.terminated(d,b.C.causes.EXPIRES))},g));h.emit("invite",d)}var g,h=this,k=d.getHeader("Content-Type"),
l=d.parseHeader("Content-Disposition");if(!l&&"application/sdp"!==k||l&&"render"===l.type)this.renderbody=d.body,this.rendertype=k;else if("application/sdp"!==k&&l&&"session"===l.type){d.reply(415);return}b.Hacks.Firefox.cannotHandleExtraWhitespace(d);b.Hacks.AllBrowsers.maskDtls(d);b.Utils.augment(this,b.ServerContext,[c,d]);b.Utils.augment(this,b.Session,[c.configuration.mediaHandlerFactory]);this.status=a.STATUS_INVITE_RECEIVED;this.from_tag=d.from_tag;this.id=d.call_id+this.from_tag;this.request=
d;this.contact=this.ua.contact.toString();this.receiveNonInviteResponse=function(){};this.logger=c.getLogger("sip.inviteservercontext",this.id);this.ua.sessions[this.id]=this;d.hasHeader("expires")&&(g=1E3*d.getHeader("expires"));e("require",b.C.supported.REQUIRED);e("supported",b.C.supported.SUPPORTED);d.to_tag=b.Utils.newTag();this.createDialog(d,"UAS",!0)?((this.mediaHandler=this.mediaHandlerFactory(this,{RTCConstraints:{optional:[{DtlsSrtpKeyAgreement:"true"}]}}))&&this.mediaHandler.getRemoteStreams&&
(this.getRemoteStreams=this.mediaHandler.getRemoteStreams.bind(this.mediaHandler),this.getLocalStreams=this.mediaHandler.getLocalStreams.bind(this.mediaHandler)),!d.body||this.renderbody?b.Timers.setTimeout(f,0):(this.hasOffer=!0,this.mediaHandler.setDescription(d.body).then(f,function(a){h.logger.warn("invalid SDP");h.logger.warn(a);d.reply(488)}))):d.reply(500,"Missing Contact header field")};g.prototype={reject:function(c){if(this.status===a.STATUS_TERMINATED)throw new b.Exceptions.InvalidStateError(this.status);
this.logger.log("rejecting RTCSession");b.ServerContext.prototype.reject.call(this,c);return this.terminated()},terminate:function(c){c=c||{};var d=(c.extraHeaders||[]).slice(),e=c.body,f,g=this;this.status===a.STATUS_WAITING_FOR_ACK&&this.request.server_transaction.state!==b.Transactions.C.STATUS_TERMINATED?(f=this.dialog,this.receiveRequest=function(a){a.method===b.C.ACK&&(this.request(b.C.BYE,{extraHeaders:d,body:e}),f.terminate())},this.request.server_transaction.on("stateChanged",function(){this.state===
b.Transactions.C.STATUS_TERMINATED&&(this.request=new b.OutgoingRequest(b.C.BYE,this.dialog.remote_target,this.ua,{cseq:this.dialog.local_seqnum+=1,call_id:this.dialog.id.call_id,from_uri:this.dialog.local_uri,from_tag:this.dialog.id.local_tag,to_uri:this.dialog.remote_uri,to_tag:this.dialog.id.remote_tag,route_set:this.dialog.route_set},d,e),(new b.RequestSender({request:this.request,onRequestTimeout:function(){g.onRequestTimeout()},onTransportError:function(){g.onTransportError()},receiveResponse:function(){}},
this.ua)).send(),f.terminate())}),this.emit("bye",this.request),this.terminated(),this.dialog=f,this.ua.dialogs[f.id.toString()]=f):this.status===a.STATUS_CONFIRMED?this.bye(c):this.reject(c);return this},progress:function(c){function d(){f=c.statusCode||183;this.status=a.STATUS_WAITING_FOR_PRACK;h.push("Contact: "+this.contact);h.push("Require: 100rel");h.push("RSeq: "+Math.floor(1E4*Math.random()));this.mediaHint=c.media;this.mediaHandler.getDescription(c.media).then(function(d){if(!this.isCanceled&&
this.status!==a.STATUS_TERMINATED){this.early_sdp=d;this[this.hasOffer?"hasAnswer":"hasOffer"]=!0;var c=b.Timers.T1;this.timers.rel1xxTimer=b.Timers.setTimeout(function r(){this.request.reply(f,null,h,d);c*=2;this.timers.rel1xxTimer=b.Timers.setTimeout(r.bind(this),c)}.bind(this),c);this.timers.prackTimer=b.Timers.setTimeout(function(){this.status===a.STATUS_WAITING_FOR_PRACK&&(this.logger.log("no PRACK received, rejecting the call"),b.Timers.clearTimeout(this.timers.rel1xxTimer),this.request.reply(504),
this.terminated(null,b.C.causes.NO_PRACK))}.bind(this),64*b.Timers.T1);l=this.request.reply(f,g,h,d);this.emit("progress",l,g)}}.bind(this),function(){this.request.reply(480);this.failed(null,b.C.causes.WEBRTC_ERROR);this.terminated(null,b.C.causes.WEBRTC_ERROR)}.bind(this))}function e(){l=this.request.reply(f,g,h,k);this.emit("progress",l,g)}c=c||{};var f=c.statusCode||180,g=c.reasonPhrase,h=(c.extraHeaders||[]).slice(),k=c.body,l;if(100>f||199<f)throw new TypeError("Invalid statusCode: "+f);if(this.isCanceled||
this.status===a.STATUS_TERMINATED)return this;100!==c.statusCode&&(this.rel100===b.C.supported.REQUIRED||this.rel100===b.C.supported.SUPPORTED&&c.rel100||this.rel100===b.C.supported.SUPPORTED&&this.ua.configuration.rel100===b.C.supported.REQUIRED)?d.apply(this):e.apply(this);return this},accept:function(c){c=Object.create(e.desugar(c));b.Utils.optionsOverride(c,"media","mediaConstraints",!0,this.logger,this.ua.configuration.media);this.mediaHint=c.media;var d=this,f=this.request,g=(c.extraHeaders||
[]).slice();c=function(c){var e;d.mediaHandler.render();g.push("Contact: "+d.contact);g.push("Allow: "+b.Utils.getAllowedMethods(d.ua));d.hasOffer?d.hasAnswer=!0:d.hasOffer=!0;e=f.reply(200,null,g,c,function(){d.status=a.STATUS_WAITING_FOR_ACK;d.setInvite2xxTimer(f,c);d.setACKTimer()},function(){d.failed(null,b.C.causes.CONNECTION_ERROR);d.terminated(null,b.C.causes.CONNECTION_ERROR)});d.status!==a.STATUS_TERMINATED&&d.accepted(e,b.Utils.getReasonPhrase(200))};var h=function(){d.status!==a.STATUS_TERMINATED&&
(d.request.reply(480),d.failed(null,b.C.causes.WEBRTC_ERROR),d.terminated(null,b.C.causes.WEBRTC_ERROR))};if(this.status===a.STATUS_WAITING_FOR_PRACK)return this.status=a.STATUS_ANSWERED_WAITING_FOR_PRACK,this;if(this.status===a.STATUS_WAITING_FOR_ANSWER)this.status=a.STATUS_ANSWERED;else if(this.status!==a.STATUS_EARLY_MEDIA)throw new b.Exceptions.InvalidStateError(this.status);if(!this.createDialog(f,"UAS"))return f.reply(500,"Missing Contact header field"),this;b.Timers.clearTimeout(this.timers.userNoAnswerTimer);
this.status===a.STATUS_EARLY_MEDIA?c():this.mediaHandler.getDescription(d.mediaHint).then(c,h);return this},receiveRequest:function(c){function d(){var d;b.Timers.clearTimeout(this.timers.ackTimer);b.Timers.clearTimeout(this.timers.invite2xxTimer);this.status=a.STATUS_CONFIRMED;this.unmute();d=c.getHeader("Content-Type");"application/sdp"!==d&&(this.renderbody=c.body,this.rendertype=d)}switch(c.method){case b.C.CANCEL:if(this.status===a.STATUS_WAITING_FOR_ANSWER||this.status===a.STATUS_WAITING_FOR_PRACK||
this.status===a.STATUS_ANSWERED_WAITING_FOR_PRACK||this.status===a.STATUS_EARLY_MEDIA||this.status===a.STATUS_ANSWERED)this.status=a.STATUS_CANCELED,this.request.reply(487),this.canceled(c),this.rejected(c,b.C.causes.CANCELED),this.failed(c,b.C.causes.CANCELED),this.terminated(c,b.C.causes.CANCELED);break;case b.C.ACK:this.status===a.STATUS_WAITING_FOR_ACK&&(this.hasAnswer?d.apply(this):c.body&&"application/sdp"===c.getHeader("content-type")?(b.Hacks.Firefox.cannotHandleExtraWhitespace(c),b.Hacks.AllBrowsers.maskDtls(c),
this.hasAnswer=!0,this.mediaHandler.setDescription(c.body).then(d.bind(this),function(a){this.logger.warn(a);this.terminate({statusCode:"488",reasonPhrase:"Bad Media Description"});this.failed(c,b.C.causes.BAD_MEDIA_DESCRIPTION);this.terminated(c,b.C.causes.BAD_MEDIA_DESCRIPTION)}.bind(this))):this.early_sdp?d.apply(this):(this.failed(c,b.C.causes.BAD_MEDIA_DESCRIPTION),this.terminated(c,b.C.causes.BAD_MEDIA_DESCRIPTION)));break;case b.C.PRACK:this.status===a.STATUS_WAITING_FOR_PRACK||this.status===
a.STATUS_ANSWERED_WAITING_FOR_PRACK?this.hasAnswer?(b.Timers.clearTimeout(this.timers.rel1xxTimer),b.Timers.clearTimeout(this.timers.prackTimer),c.reply(200),this.status===a.STATUS_ANSWERED_WAITING_FOR_PRACK&&(this.status=a.STATUS_EARLY_MEDIA,this.accept()),this.status=a.STATUS_EARLY_MEDIA,this.mute()):c.body&&"application/sdp"===c.getHeader("content-type")?(this.hasAnswer=!0,this.mediaHandler.setDescription(c.body).then(function(){b.Timers.clearTimeout(this.timers.rel1xxTimer);b.Timers.clearTimeout(this.timers.prackTimer);
c.reply(200);this.status===a.STATUS_ANSWERED_WAITING_FOR_PRACK&&(this.status=a.STATUS_EARLY_MEDIA,this.accept());this.status=a.STATUS_EARLY_MEDIA;this.mute()}.bind(this),function(a){this.logger.warn(a);this.terminate({statusCode:"488",reasonPhrase:"Bad Media Description"});this.failed(c,b.C.causes.BAD_MEDIA_DESCRIPTION);this.terminated(c,b.C.causes.BAD_MEDIA_DESCRIPTION)}.bind(this))):(this.terminate({statusCode:"488",reasonPhrase:"Bad Media Description"}),this.failed(c,b.C.causes.BAD_MEDIA_DESCRIPTION),
this.terminated(c,b.C.causes.BAD_MEDIA_DESCRIPTION)):this.status===a.STATUS_EARLY_MEDIA&&c.reply(200);break;default:e.prototype.receiveRequest.apply(this,[c])}},onTransportError:function(){this.status!==a.STATUS_CONFIRMED&&this.status!==a.STATUS_TERMINATED&&this.failed(null,b.C.causes.CONNECTION_ERROR)},onRequestTimeout:function(){this.status===a.STATUS_CONFIRMED?this.terminated(null,b.C.causes.REQUEST_TIMEOUT):this.status!==a.STATUS_TERMINATED&&(this.failed(null,b.C.causes.REQUEST_TIMEOUT),this.terminated(null,
b.C.causes.REQUEST_TIMEOUT))}};b.InviteServerContext=g;g=function(c,d,f){f=Object.create(e.desugar(f));f.params=Object.create(f.params||Object.prototype);var g=(f.extraHeaders||[]).slice(),h=f.stunServers||null,k=f.turnServers||null,l=c.configuration.mediaHandlerFactory.isSupported;if(l&&!l())throw new b.Exceptions.NotSupportedError("Media not supported");this.RTCConstraints=f.RTCConstraints||{};this.inviteWithoutSdp=f.inviteWithoutSdp||!1;this.anonymous=f.anonymous||!1;this.renderbody=f.renderbody||
null;this.rendertype=f.rendertype||"text/plain";f.params.from_tag=this.from_tag;this.contact=c.contact.toString({anonymous:this.anonymous,outbound:this.anonymous?!c.contact.temp_gruu:!c.contact.pub_gruu});this.anonymous&&(f.params.from_displayName="Anonymous",f.params.from_uri="sip:anonymous@anonymous.invalid",g.push("P-Preferred-Identity: "+c.configuration.uri.toString()),g.push("Privacy: id"));g.push("Contact: "+this.contact);g.push("Allow: "+b.Utils.getAllowedMethods(c));this.inviteWithoutSdp?
this.renderbody&&(g.push("Content-Type: "+this.rendertype),g.push("Content-Disposition: render;handling=optional")):g.push("Content-Type: application/sdp");c.configuration.rel100===b.C.supported.REQUIRED&&g.push("Require: 100rel");c.configuration.replaces===b.C.supported.REQUIRED&&g.push("Require: replaces");f.extraHeaders=g;b.Utils.augment(this,b.ClientContext,[c,b.C.INVITE,d,f]);b.Utils.augment(this,b.Session,[c.configuration.mediaHandlerFactory]);if(this.status!==a.STATUS_NULL)throw new b.Exceptions.InvalidStateError(this.status);
this.from_tag=b.Utils.newTag();this.received_100=this.isCanceled=!1;this.method=b.C.INVITE;this.receiveNonInviteResponse=this.receiveResponse;this.receiveResponse=this.receiveInviteResponse;this.logger=c.getLogger("sip.inviteclientcontext");if(h)if(d=b.UA.configuration_check.optional.stunServers(h))this.stunServers=d;else throw new TypeError("Invalid stunServers: "+h);if(k)if(d=b.UA.configuration_check.optional.turnServers(k))this.turnServers=d;else throw new TypeError("Invalid turnServers: "+k);
c.applicants[this]=this;this.id=this.request.call_id+this.from_tag;(this.mediaHandler=this.mediaHandlerFactory(this,{RTCConstraints:this.RTCConstraints,stunServers:this.stunServers,turnServers:this.turnServers}))&&this.mediaHandler.getRemoteStreams&&(this.getRemoteStreams=this.mediaHandler.getRemoteStreams.bind(this.mediaHandler),this.getLocalStreams=this.mediaHandler.getLocalStreams.bind(this.mediaHandler));b.Utils.optionsOverride(f,"media","mediaConstraints",!0,this.logger,this.ua.configuration.media);
this.mediaHint=f.media};g.prototype={invite:function(){var c=this;this.ua.sessions[this.id]=this;this.inviteWithoutSdp?(this.request.body=c.renderbody,this.status=a.STATUS_INVITE_SENT,this.send()):this.mediaHandler.getDescription(c.mediaHint).then(function(b){c.isCanceled||c.status===a.STATUS_TERMINATED||(c.hasOffer=!0,c.request.body=b,c.status=a.STATUS_INVITE_SENT,c.send())},function(){c.status!==a.STATUS_TERMINATED&&(c.failed(null,b.C.causes.WEBRTC_ERROR),c.terminated(null,b.C.causes.WEBRTC_ERROR))});
return this},receiveInviteResponse:function(c){var d,e=this;d=c.call_id+c.from_tag+c.to_tag;var f=[],g={};if(this.status!==a.STATUS_TERMINATED&&c.method===b.C.INVITE){if(this.dialog&&200<=c.status_code&&299>=c.status_code){if(d!==this.dialog.id.toString()){if(!this.createDialog(c,"UAC",!0))return;this.earlyDialogs[d].sendRequest(this,b.C.ACK,{body:b.Utils.generateFakeSDP(c.body)});this.earlyDialogs[d].sendRequest(this,b.C.BYE);this.status!==a.STATUS_CONFIRMED&&(this.failed(c,b.C.causes.WEBRTC_ERROR),
this.terminated(c,b.C.causes.WEBRTC_ERROR));return}if(this.status===a.STATUS_CONFIRMED){this.sendRequest(b.C.ACK,{cseq:c.cseq});return}if(!this.hasAnswer)return}if(this.dialog&&200>c.status_code)-1!==this.dialog.pracked.indexOf(c.getHeader("rseq"))||this.dialog.pracked[this.dialog.pracked.length-1]>=c.getHeader("rseq")&&0<this.dialog.pracked.length||!this.earlyDialogs[d]&&!this.createDialog(c,"UAC",!0)||-1!==this.earlyDialogs[d].pracked.indexOf(c.getHeader("rseq"))||this.earlyDialogs[d].pracked[this.earlyDialogs[d].pracked.length-
1]>=c.getHeader("rseq")&&0<this.earlyDialogs[d].pracked.length||(f.push("RAck: "+c.getHeader("rseq")+" "+c.getHeader("cseq")),this.earlyDialogs[d].pracked.push(c.getHeader("rseq")),this.earlyDialogs[d].sendRequest(this,b.C.PRACK,{extraHeaders:f,body:b.Utils.generateFakeSDP(c.body)}));else if(this.isCanceled)100<=c.status_code&&200>c.status_code?(this.request.cancel(this.cancelReason),this.canceled(null)):200<=c.status_code&&299>c.status_code?(this.acceptAndTerminate(c),this.emit("bye",this.request)):
300<=c.status_code&&(d=b.C.REASON_PHRASE[c.status_code]||b.C.causes.CANCELED,this.rejected(c,d),this.failed(c,d),this.terminated(c,d));else switch(!0){case /^100$/.test(c.status_code):this.received_100=!0;this.emit("progress",c);break;case /^1[0-9]{2}$/.test(c.status_code):if(!c.to_tag){this.logger.warn("1xx response received without to tag");break}if(c.hasHeader("contact")&&!this.createDialog(c,"UAC",!0))break;this.status=a.STATUS_1XX_RECEIVED;if(c.hasHeader("require")&&-1!==c.getHeader("require").indexOf("100rel")){if(this.dialog||
!this.earlyDialogs[d])break;if(-1!==this.earlyDialogs[d].pracked.indexOf(c.getHeader("rseq"))||this.earlyDialogs[d].pracked[this.earlyDialogs[d].pracked.length-1]>=c.getHeader("rseq")&&0<this.earlyDialogs[d].pracked.length)break;b.Hacks.Firefox.cannotHandleExtraWhitespace(c);b.Hacks.AllBrowsers.maskDtls(c);if(c.body)if(this.hasOffer){if(!this.createDialog(c,"UAC"))break;this.hasAnswer=!0;this.dialog.pracked.push(c.getHeader("rseq"));this.mediaHandler.setDescription(c.body).then(function(){f.push("RAck: "+
c.getHeader("rseq")+" "+c.getHeader("cseq"));e.sendRequest(b.C.PRACK,{extraHeaders:f,receiveResponse:function(){}});e.status=a.STATUS_EARLY_MEDIA;e.mute();e.emit("progress",c)},function(a){e.logger.warn(a);e.acceptAndTerminate(c,488,"Not Acceptable Here");e.failed(c,b.C.causes.BAD_MEDIA_DESCRIPTION)})}else{var h=this.earlyDialogs[d];d=h.mediaHandler;h.pracked.push(c.getHeader("rseq"));d.setDescription(c.body).then(d.getDescription.bind(d,e.mediaHint)).then(function(d){f.push("Content-Type: application/sdp");
f.push("RAck: "+c.getHeader("rseq")+" "+c.getHeader("cseq"));h.sendRequest(e,b.C.PRACK,{extraHeaders:f,body:d});e.status=a.STATUS_EARLY_MEDIA;e.emit("progress",c)}).catch(function(d){d instanceof b.Exceptions.GetDescriptionError?(h.pracked.push(c.getHeader("rseq")),e.status!==a.STATUS_TERMINATED&&(e.failed(null,b.C.causes.WEBRTC_ERROR),e.terminated(null,b.C.causes.WEBRTC_ERROR))):(h.pracked.splice(h.pracked.indexOf(c.getHeader("rseq")),1),e.logger.warn("invalid SDP"),e.logger.warn(d))})}else f.push("RAck: "+
c.getHeader("rseq")+" "+c.getHeader("cseq")),this.earlyDialogs[d].pracked.push(c.getHeader("rseq")),this.earlyDialogs[d].sendRequest(this,b.C.PRACK,{extraHeaders:f}),this.emit("progress",c)}else this.emit("progress",c);break;case /^2[0-9]{2}$/.test(c.status_code):if(this.request.cseq+" "+this.request.method!==c.getHeader("cseq"))break;if(this.status===a.STATUS_EARLY_MEDIA&&this.dialog){this.status=a.STATUS_CONFIRMED;this.unmute();g={};this.renderbody&&(f.push("Content-Type: "+this.rendertype),g.extraHeaders=
f,g.body=this.renderbody);g.cseq=c.cseq;this.sendRequest(b.C.ACK,g);this.accepted(c);break}if(this.dialog)break;b.Hacks.Firefox.cannotHandleExtraWhitespace(c);b.Hacks.AllBrowsers.maskDtls(c);if(this.hasOffer)if(this.hasAnswer)this.renderbody&&(f.push("Content-Type: "+e.rendertype),g.extraHeaders=f,g.body=this.renderbody),this.sendRequest(b.C.ACK,g);else{if(!c.body){this.acceptAndTerminate(c,400,"Missing session description");this.failed(c,b.C.causes.BAD_MEDIA_DESCRIPTION);break}if(!this.createDialog(c,
"UAC"))break;this.hasAnswer=!0;this.mediaHandler.setDescription(c.body).then(function(){var d={};e.status=a.STATUS_CONFIRMED;e.unmute();e.renderbody&&(f.push("Content-Type: "+e.rendertype),d.extraHeaders=f,d.body=e.renderbody);d.cseq=c.cseq;e.sendRequest(b.C.ACK,d);e.accepted(c)},function(a){e.logger.warn(a);e.acceptAndTerminate(c,488,"Not Acceptable Here");e.failed(c,b.C.causes.BAD_MEDIA_DESCRIPTION)})}else if(this.earlyDialogs[d]&&this.earlyDialogs[d].mediaHandler.localMedia){this.hasAnswer=this.hasOffer=
!0;this.mediaHandler=this.earlyDialogs[d].mediaHandler;if(!this.createDialog(c,"UAC"))break;this.status=a.STATUS_CONFIRMED;this.sendRequest(b.C.ACK,{cseq:c.cseq});this.unmute();this.accepted(c)}else{if(!c.body){this.acceptAndTerminate(c,400,"Missing session description");this.failed(c,b.C.causes.BAD_MEDIA_DESCRIPTION);break}if(!this.createDialog(c,"UAC"))break;this.hasOffer=!0;this.mediaHandler.setDescription(c.body).then(this.mediaHandler.getDescription.bind(this.mediaHandler,this.mediaHint)).then(function(d){e.isCanceled||
e.status===a.STATUS_TERMINATED||(d=b.Hacks.Firefox.hasMissingCLineInSDP(d),e.status=a.STATUS_CONFIRMED,e.hasAnswer=!0,e.unmute(),e.sendRequest(b.C.ACK,{body:d,extraHeaders:["Content-Type: application/sdp"],cseq:c.cseq}),e.accepted(c))}).catch(function(a){a instanceof b.Exceptions.GetDescriptionError?e.logger.warn("there was a problem"):(e.logger.warn("invalid SDP"),e.logger.warn(a),c.reply(488))})}break;default:d=b.Utils.sipErrorCause(c.status_code),this.rejected(c,d),this.failed(c,d),this.terminated(c,
d)}}},cancel:function(c){c=c||{};if(this.status===a.STATUS_TERMINATED||this.status===a.STATUS_CONFIRMED)throw new b.Exceptions.InvalidStateError(this.status);this.logger.log("canceling RTCSession");c=b.Utils.getCancelReason(c.status_code,c.reason_phrase);try{this.request.cancel(c)}catch(d){}return this.canceled()},terminate:function(b){if(this.status===a.STATUS_TERMINATED)return this;this.status===a.STATUS_WAITING_FOR_ACK||this.status===a.STATUS_CONFIRMED?this.bye(b):this.cancel(b);return this},receiveRequest:function(c){c.method===
b.C.ACK&&this.status===a.STATUS_WAITING_FOR_ACK&&(b.Timers.clearTimeout(this.timers.ackTimer),b.Timers.clearTimeout(this.timers.invite2xxTimer),this.status=a.STATUS_CONFIRMED,this.unmute(),this.accepted());return e.prototype.receiveRequest.apply(this,[c])},onTransportError:function(){this.status!==a.STATUS_CONFIRMED&&this.status!==a.STATUS_TERMINATED&&this.failed(null,b.C.causes.CONNECTION_ERROR)},onRequestTimeout:function(){this.status===a.STATUS_CONFIRMED?this.terminated(null,b.C.causes.REQUEST_TIMEOUT):
this.status!==a.STATUS_TERMINATED&&(this.failed(null,b.C.causes.REQUEST_TIMEOUT),this.terminated(null,b.C.causes.REQUEST_TIMEOUT))}};b.InviteClientContext=g}},{"./Session/DTMF":58}],58:[function(k,l,n){l.exports=function(b){var h;h=function(f,e,g){if(void 0===e)throw new TypeError("Not enough arguments");this.logger=f.ua.getLogger("sip.invitecontext.dtmf",f.id);this.owner=f;this.direction=null;g=g||{};f=g.duration||null;g=g.interToneGap||null;if("string"===typeof e)e=e.toUpperCase();else if("number"===
typeof e)e=e.toString();else throw new TypeError("Invalid tone: "+e);if(e.match(/^[0-9A-D#*]$/))this.tone=e;else throw new TypeError("Invalid tone: "+e);if(f&&!b.Utils.isDecimal(f))throw new TypeError("Invalid tone duration: "+f);f?f<h.C.MIN_DURATION?(this.logger.warn('"duration" value is lower than the minimum allowed, setting it to '+h.C.MIN_DURATION+" milliseconds"),f=h.C.MIN_DURATION):f>h.C.MAX_DURATION?(this.logger.warn('"duration" value is greater than the maximum allowed, setting it to '+h.C.MAX_DURATION+
" milliseconds"),f=h.C.MAX_DURATION):f=Math.abs(f):f=h.C.DEFAULT_DURATION;this.duration=f;if(g&&!b.Utils.isDecimal(g))throw new TypeError("Invalid interToneGap: "+g);g?g<h.C.MIN_INTER_TONE_GAP?(this.logger.warn('"interToneGap" value is lower than the minimum allowed, setting it to '+h.C.MIN_INTER_TONE_GAP+" milliseconds"),g=h.C.MIN_INTER_TONE_GAP):g=Math.abs(g):g=h.C.DEFAULT_INTER_TONE_GAP;this.interToneGap=g};h.prototype=Object.create(b.EventEmitter.prototype);h.prototype.send=function(f){var e;
this.direction="outgoing";if(this.owner.status!==b.Session.C.STATUS_CONFIRMED&&this.owner.status!==b.Session.C.STATUS_WAITING_FOR_ACK)throw new b.Exceptions.InvalidStateError(this.owner.status);f=f||{};f=f.extraHeaders?f.extraHeaders.slice():[];f.push("Content-Type: application/dtmf-relay");e="Signal= "+this.tone+"\r\n";e+="Duration= "+this.duration;this.request=this.owner.dialog.sendRequest(this,b.C.INFO,{extraHeaders:f,body:e});this.owner.emit("dtmf",this.request,this)};h.prototype.receiveResponse=
function(f){var e;switch(!0){case /^1[0-9]{2}$/.test(f.status_code):break;case /^2[0-9]{2}$/.test(f.status_code):this.emit("succeeded",{originator:"remote",response:f});break;default:e=b.Utils.sipErrorCause(f.status_code),this.emit("failed",f,e)}};h.prototype.onRequestTimeout=function(){this.emit("failed",null,b.C.causes.REQUEST_TIMEOUT);this.owner.onRequestTimeout()};h.prototype.onTransportError=function(){this.emit("failed",null,b.C.causes.CONNECTION_ERROR);this.owner.onTransportError()};h.prototype.onDialogError=
function(f){this.emit("failed",f,b.C.causes.DIALOG_ERROR);this.owner.onDialogError(f)};h.prototype.init_incoming=function(b){this.direction="incoming";this.request=b;b.reply(200);this.tone&&this.duration?this.owner.emit("dtmf",b,this):this.logger.warn("invalid INFO DTMF received, discarded")};h.C={MIN_DURATION:70,MAX_DURATION:6E3,DEFAULT_DURATION:100,MIN_INTER_TONE_GAP:50,DEFAULT_INTER_TONE_GAP:500};return h}},{}],59:[function(k,l,n){l.exports=function(b){b.Subscription=function(h,f,e,g){g=Object.create(g||
Object.prototype);this.extraHeaders=g.extraHeaders=(g.extraHeaders||[]).slice();this.id=null;this.state="init";if(e)this.event=e;else throw new TypeError("Event necessary to create a subscription.");"number"!==typeof g.expires?(h.logger.warn("expires must be a number. Using default of 3600."),this.expires=3600):this.expires=g.expires;g.extraHeaders.push("Event: "+this.event);g.extraHeaders.push("Expires: "+this.expires);g.body&&(this.body=g.body);this.contact=h.contact.toString();g.extraHeaders.push("Contact: "+
this.contact);g.extraHeaders.push("Allow: "+b.Utils.getAllowedMethods(h));b.Utils.augment(this,b.ClientContext,[h,b.C.SUBSCRIBE,f,g]);this.logger=h.getLogger("sip.subscription");this.dialog=null;this.timers={N:null,sub_duration:null};this.errorCodes=[404,405,410,416,480,481,482,483,484,485,489,501,604]};b.Subscription.prototype={subscribe:function(){b.Timers.clearTimeout(this.timers.sub_duration);b.Timers.clearTimeout(this.timers.N);this.timers.N=b.Timers.setTimeout(this.timer_fire.bind(this),b.Timers.TIMER_N);
this.send();this.state="notify_wait";return this},refresh:function(){"terminated"!==this.state&&"pending"!==this.state&&"notify_wait"!==this.state&&this.dialog.sendRequest(this,b.C.SUBSCRIBE,{extraHeaders:this.extraHeaders,body:this.body})},receiveResponse:function(h){var f,e=b.Utils.getReasonPhrase(h.status_code);-1!==this.errorCodes.indexOf(h.status_code)?this.failed(h,null):/^2[0-9]{2}$/.test(h.status_code)&&(f=h.getHeader("Expires"),b.Timers.clearTimeout(this.timers.N),this.createConfirmedDialog(h,
"UAC")&&(this.id=this.dialog.id.toString(),this.ua.subscriptions[this.id]=this,this.emit("accepted",h,e)),f&&f<=this.expires?this.timers.sub_duration=b.Timers.setTimeout(this.refresh.bind(this),900*f):f?(this.logger.warn("Expires header in a 200-class response to SUBSCRIBE with a higher value than the one in the request"),this.failed(h,b.C.INVALID_EXPIRES_HEADER)):(this.logger.warn("Expires header missing in a 200-class response to SUBSCRIBE"),this.failed(h,b.C.EXPIRES_HEADER_MISSING)))},unsubscribe:function(){var h=
[];this.state="terminated";h.push("Event: "+this.event);h.push("Expires: 0");h.push("Contact: "+this.contact);h.push("Allow: "+b.Utils.getAllowedMethods(this.ua));this.request=new b.OutgoingRequest(this.method,this.request.to.uri.toString(),this.ua,null,h);this.receiveResponse=function(){};b.Timers.clearTimeout(this.timers.sub_duration);b.Timers.clearTimeout(this.timers.N);this.timers.N=b.Timers.setTimeout(this.timer_fire.bind(this),b.Timers.TIMER_N);this.send()},timer_fire:function(){"terminated"===
this.state?this.close():"pending"===this.state||"notify_wait"===this.state?(this.state="terminated",this.close()):this.refresh()},close:function(){"terminated"!==this.state&&this.unsubscribe();this.terminateDialog();b.Timers.clearTimeout(this.timers.N);b.Timers.clearTimeout(this.timers.sub_duration);delete this.ua.subscriptions[this.id]},createConfirmedDialog:function(h,f){var e;this.terminateDialog();e=new b.Dialog(this,h,f);if(e.error)return!1;this.dialog=e;return!0},terminateDialog:function(){this.dialog&&
(delete this.ua.subscriptions[this.id],this.dialog.terminate(),delete this.dialog)},receiveRequest:function(h){function f(){e.expires&&(e.expires=Math.min(g.expires,Math.max(e.expires,0)),g.timers.sub_duration=b.Timers.setTimeout(g.refresh.bind(g),900*e.expires))}var e,g=this;if(this.matchEvent(h))switch(e=h.parseHeader("Subscription-State"),h.reply(200,b.C.REASON_200),b.Timers.clearTimeout(this.timers.N),b.Timers.clearTimeout(this.timers.sub_duration),this.emit("notify",{request:h}),e.state){case "active":this.state=
"active";f();break;case "pending":"notify_wait"===this.state&&f();this.state="pending";break;case "terminated":if(e.reason)switch(this.logger.log("terminating subscription with reason "+e.reason),e.reason){case "deactivated":case "timeout":this.subscribe();return;case "probation":case "giveup":e.params&&e.params["retry-after"]?this.timers.sub_duration=b.Timers.setTimeout(g.subscribe.bind(g),e.params["retry-after"]):this.subscribe();return}this.close()}else h.reply(489)},failed:function(b,f){this.close();
this.emit("failed",b,f);return this},matchEvent:function(b){var f;if(!b.hasHeader("Event"))return this.logger.warn("missing Event header"),!1;if(!b.hasHeader("Subscription-State"))return this.logger.warn("missing Subscription-State header"),!1;f=b.parseHeader("event").event;return this.event!==f?(this.logger.warn("event match failed"),b.reply(481,"Event Match Failed"),!1):!0}}}},{}],60:[function(k,l,n){l.exports=function(b){var h={T1:500,T2:4E3,T4:5E3,TIMER_B:32E3,TIMER_D:0,TIMER_F:32E3,TIMER_H:32E3,
TIMER_I:0,TIMER_J:0,TIMER_K:0,TIMER_L:32E3,TIMER_M:32E3,TIMER_N:32E3,PROVISIONAL_RESPONSE_INTERVAL:6E4};["setTimeout","clearTimeout","setInterval","clearInterval"].forEach(function(f){h[f]=function(){return b[f].apply(b,arguments)}});return h}},{}],61:[function(k,l,n){l.exports=function(b){var h={STATUS_TRYING:1,STATUS_PROCEEDING:2,STATUS_CALLING:3,STATUS_ACCEPTED:4,STATUS_COMPLETED:5,STATUS_TERMINATED:6,STATUS_CONFIRMED:7,NON_INVITE_CLIENT:"nict",NON_INVITE_SERVER:"nist",INVITE_CLIENT:"ict",INVITE_SERVER:"ist"},
f=function(a,b,c){this.type=h.NON_INVITE_CLIENT;this.transport=c;this.id="z9hG4bK"+Math.floor(1E7*Math.random());this.request_sender=a;this.request=b;this.logger=a.ua.getLogger("sip.transaction.nict",this.id);b="SIP/2.0/"+(a.ua.configuration.hackViaTcp?"TCP":c.server.scheme);b+=" "+a.ua.configuration.viaHost+";branch="+this.id;this.request.setHeader("via",b);this.request_sender.ua.newTransaction(this)};f.prototype=Object.create(b.EventEmitter.prototype);f.prototype.stateChanged=function(a){this.state=
a;this.emit("stateChanged")};f.prototype.send=function(){this.stateChanged(h.STATUS_TRYING);this.F=b.Timers.setTimeout(this.timer_F.bind(this),b.Timers.TIMER_F);if(!this.transport.send(this.request))this.onTransportError()};f.prototype.onTransportError=function(){this.logger.log("transport error occurred, deleting non-INVITE client transaction "+this.id);b.Timers.clearTimeout(this.F);b.Timers.clearTimeout(this.K);this.stateChanged(h.STATUS_TERMINATED);this.request_sender.ua.destroyTransaction(this);
this.request_sender.onTransportError()};f.prototype.timer_F=function(){this.logger.log("Timer F expired for non-INVITE client transaction "+this.id);this.stateChanged(h.STATUS_TERMINATED);this.request_sender.ua.destroyTransaction(this);this.request_sender.onRequestTimeout()};f.prototype.timer_K=function(){this.stateChanged(h.STATUS_TERMINATED);this.request_sender.ua.destroyTransaction(this)};f.prototype.receiveResponse=function(a){var c=a.status_code;if(200>c)switch(this.state){case h.STATUS_TRYING:case h.STATUS_PROCEEDING:this.stateChanged(h.STATUS_PROCEEDING),
this.request_sender.receiveResponse(a)}else switch(this.state){case h.STATUS_TRYING:case h.STATUS_PROCEEDING:this.stateChanged(h.STATUS_COMPLETED);b.Timers.clearTimeout(this.F);if(408===c)this.request_sender.onRequestTimeout();else this.request_sender.receiveResponse(a);this.K=b.Timers.setTimeout(this.timer_K.bind(this),b.Timers.TIMER_K)}};var e=function(a,b,c){var e=this;this.type=h.INVITE_CLIENT;this.transport=c;this.id="z9hG4bK"+Math.floor(1E7*Math.random());this.request_sender=a;this.request=
b;this.logger=a.ua.getLogger("sip.transaction.ict",this.id);b="SIP/2.0/"+(a.ua.configuration.hackViaTcp?"TCP":c.server.scheme);b+=" "+a.ua.configuration.viaHost+";branch="+this.id;this.request.setHeader("via",b);this.request_sender.ua.newTransaction(this);this.request.cancel=function(a){e.cancel_request(e,a)}};e.prototype=Object.create(b.EventEmitter.prototype);e.prototype.stateChanged=function(a){this.state=a;this.emit("stateChanged")};e.prototype.send=function(){this.stateChanged(h.STATUS_CALLING);
this.B=b.Timers.setTimeout(this.timer_B.bind(this),b.Timers.TIMER_B);if(!this.transport.send(this.request))this.onTransportError()};e.prototype.onTransportError=function(){this.logger.log("transport error occurred, deleting INVITE client transaction "+this.id);b.Timers.clearTimeout(this.B);b.Timers.clearTimeout(this.D);b.Timers.clearTimeout(this.M);this.stateChanged(h.STATUS_TERMINATED);this.request_sender.ua.destroyTransaction(this);if(this.state!==h.STATUS_ACCEPTED)this.request_sender.onTransportError()};
e.prototype.timer_M=function(){this.logger.log("Timer M expired for INVITE client transaction "+this.id);this.state===h.STATUS_ACCEPTED&&(b.Timers.clearTimeout(this.B),this.stateChanged(h.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this))};e.prototype.timer_B=function(){this.logger.log("Timer B expired for INVITE client transaction "+this.id);this.state===h.STATUS_CALLING&&(this.stateChanged(h.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this),this.request_sender.onRequestTimeout())};
e.prototype.timer_D=function(){this.logger.log("Timer D expired for INVITE client transaction "+this.id);b.Timers.clearTimeout(this.B);this.stateChanged(h.STATUS_TERMINATED);this.request_sender.ua.destroyTransaction(this)};e.prototype.sendACK=function(a){this.ack="ACK "+this.request.ruri+" SIP/2.0\r\n";this.ack+="Via: "+this.request.headers.Via.toString()+"\r\n";this.request.headers.Route&&(this.ack+="Route: "+this.request.headers.Route.toString()+"\r\n");this.ack+="To: "+a.getHeader("to")+"\r\n";
this.ack+="From: "+this.request.headers.From.toString()+"\r\n";this.ack+="Call-ID: "+this.request.headers["Call-ID"].toString()+"\r\n";this.ack+="Content-Length: 0\r\n";this.ack+="CSeq: "+this.request.headers.CSeq.toString().split(" ")[0];this.ack+=" ACK\r\n\r\n";this.D=b.Timers.setTimeout(this.timer_D.bind(this),b.Timers.TIMER_D);this.transport.send(this.ack)};e.prototype.cancel_request=function(a,c){var e=a.request;this.cancel=b.C.CANCEL+" "+e.ruri+" SIP/2.0\r\n";this.cancel+="Via: "+e.headers.Via.toString()+
"\r\n";this.request.headers.Route&&(this.cancel+="Route: "+e.headers.Route.toString()+"\r\n");this.cancel+="To: "+e.headers.To.toString()+"\r\n";this.cancel+="From: "+e.headers.From.toString()+"\r\n";this.cancel+="Call-ID: "+e.headers["Call-ID"].toString()+"\r\n";this.cancel+="CSeq: "+e.headers.CSeq.toString().split(" ")[0]+" CANCEL\r\n";c&&(this.cancel+="Reason: "+c+"\r\n");this.cancel+="Content-Length: 0\r\n\r\n";this.transport.send(this.cancel)};e.prototype.receiveResponse=function(a){var c=a.status_code;
if(100<=c&&199>=c)switch(this.state){case h.STATUS_CALLING:this.stateChanged(h.STATUS_PROCEEDING);this.request_sender.receiveResponse(a);this.cancel&&this.transport.send(this.cancel);break;case h.STATUS_PROCEEDING:this.request_sender.receiveResponse(a)}else if(200<=c&&299>=c)switch(this.state){case h.STATUS_CALLING:case h.STATUS_PROCEEDING:this.stateChanged(h.STATUS_ACCEPTED);this.M=b.Timers.setTimeout(this.timer_M.bind(this),b.Timers.TIMER_M);this.request_sender.receiveResponse(a);break;case h.STATUS_ACCEPTED:this.request_sender.receiveResponse(a)}else if(300<=
c&&699>=c)switch(this.state){case h.STATUS_CALLING:case h.STATUS_PROCEEDING:this.stateChanged(h.STATUS_COMPLETED);this.sendACK(a);this.request_sender.receiveResponse(a);break;case h.STATUS_COMPLETED:this.sendACK(a)}};var g=function(a,b,c){this.transport=c;this.id="z9hG4bK"+Math.floor(1E7*Math.random());this.request_sender=a;this.request=b;this.logger=a.ua.getLogger("sip.transaction.nict",this.id);b="SIP/2.0/"+(a.ua.configuration.hackViaTcp?"TCP":c.server.scheme);b+=" "+a.ua.configuration.viaHost+
";branch="+this.id;this.request.setHeader("via",b)};g.prototype=Object.create(b.EventEmitter.prototype);g.prototype.send=function(){if(!this.transport.send(this.request))this.onTransportError()};g.prototype.onTransportError=function(){this.logger.log("transport error occurred, for an ACK client transaction "+this.id);this.request_sender.onTransportError()};var a=function(a,b){this.type=h.NON_INVITE_SERVER;this.id=a.via_branch;this.request=a;this.transport=a.transport;this.ua=b;this.last_response=
"";a.server_transaction=this;this.logger=b.getLogger("sip.transaction.nist",this.id);this.state=h.STATUS_TRYING;b.newTransaction(this)};a.prototype=Object.create(b.EventEmitter.prototype);a.prototype.stateChanged=function(a){this.state=a;this.emit("stateChanged")};a.prototype.timer_J=function(){this.logger.log("Timer J expired for non-INVITE server transaction "+this.id);this.stateChanged(h.STATUS_TERMINATED);this.ua.destroyTransaction(this)};a.prototype.onTransportError=function(){this.transportError||
(this.transportError=!0,this.logger.log("transport error occurred, deleting non-INVITE server transaction "+this.id),b.Timers.clearTimeout(this.J),this.stateChanged(h.STATUS_TERMINATED),this.ua.destroyTransaction(this))};a.prototype.receiveResponse=function(a,c){var e=b.Utils.defer();if(100===a)switch(this.state){case h.STATUS_TRYING:this.stateChanged(h.STATUS_PROCEEDING);if(!this.transport.send(c))this.onTransportError();break;case h.STATUS_PROCEEDING:this.last_response=c,this.transport.send(c)?
e.resolve():(this.onTransportError(),e.reject())}else if(200<=a&&699>=a)switch(this.state){case h.STATUS_TRYING:case h.STATUS_PROCEEDING:this.stateChanged(h.STATUS_COMPLETED),this.last_response=c,this.J=b.Timers.setTimeout(this.timer_J.bind(this),b.Timers.TIMER_J),this.transport.send(c)?e.resolve():(this.onTransportError(),e.reject())}return e.promise};var c=function(a,b){this.type=h.INVITE_SERVER;this.id=a.via_branch;this.request=a;this.transport=a.transport;this.ua=b;this.last_response="";a.server_transaction=
this;this.logger=b.getLogger("sip.transaction.ist",this.id);this.state=h.STATUS_PROCEEDING;b.newTransaction(this);this.resendProvisionalTimer=null;a.reply(100)};c.prototype=Object.create(b.EventEmitter.prototype);c.prototype.stateChanged=function(a){this.state=a;this.emit("stateChanged")};c.prototype.timer_H=function(){this.logger.log("Timer H expired for INVITE server transaction "+this.id);this.state===h.STATUS_COMPLETED&&this.logger.warn("transactions","ACK for INVITE server transaction was never received, call will be terminated");
this.stateChanged(h.STATUS_TERMINATED);this.ua.destroyTransaction(this)};c.prototype.timer_I=function(){this.stateChanged(h.STATUS_TERMINATED);this.ua.destroyTransaction(this)};c.prototype.timer_L=function(){this.logger.log("Timer L expired for INVITE server transaction "+this.id);this.state===h.STATUS_ACCEPTED&&(this.stateChanged(h.STATUS_TERMINATED),this.ua.destroyTransaction(this))};c.prototype.onTransportError=function(){this.transportError||(this.transportError=!0,this.logger.log("transport error occurred, deleting INVITE server transaction "+
this.id),null!==this.resendProvisionalTimer&&(b.Timers.clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null),b.Timers.clearTimeout(this.L),b.Timers.clearTimeout(this.H),b.Timers.clearTimeout(this.I),this.stateChanged(h.STATUS_TERMINATED),this.ua.destroyTransaction(this))};c.prototype.resend_provisional=function(){if(!this.transport.send(this.last_response))this.onTransportError()};c.prototype.receiveResponse=function(a,c){var e=b.Utils.defer();if(100<=a&&199>=a)switch(this.state){case h.STATUS_PROCEEDING:if(!this.transport.send(c))this.onTransportError();
this.last_response=c}if(100<a&&199>=a&&this.state===h.STATUS_PROCEEDING)null===this.resendProvisionalTimer&&(this.resendProvisionalTimer=b.Timers.setInterval(this.resend_provisional.bind(this),b.Timers.PROVISIONAL_RESPONSE_INTERVAL));else if(200<=a&&299>=a)switch(this.state){case h.STATUS_PROCEEDING:this.stateChanged(h.STATUS_ACCEPTED),this.last_response=c,this.L=b.Timers.setTimeout(this.timer_L.bind(this),b.Timers.TIMER_L),null!==this.resendProvisionalTimer&&(b.Timers.clearInterval(this.resendProvisionalTimer),
this.resendProvisionalTimer=null);case h.STATUS_ACCEPTED:this.transport.send(c)?e.resolve():(this.onTransportError(),e.reject())}else if(300<=a&&699>=a)switch(this.state){case h.STATUS_PROCEEDING:null!==this.resendProvisionalTimer&&(b.Timers.clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null),this.transport.send(c)?(this.stateChanged(h.STATUS_COMPLETED),this.H=b.Timers.setTimeout(this.timer_H.bind(this),b.Timers.TIMER_H),e.resolve()):(this.onTransportError(),e.reject())}return e.promise};
b.Transactions={C:h,checkTransaction:function(a,c){var e;switch(c.method){case b.C.INVITE:if(e=a.transactions.ist[c.via_branch]){switch(e.state){case h.STATUS_PROCEEDING:e.transport.send(e.last_response)}return!0}break;case b.C.ACK:if(e=a.transactions.ist[c.via_branch]){if(e.state===h.STATUS_ACCEPTED)return!1;if(e.state===h.STATUS_COMPLETED)return e.state=h.STATUS_CONFIRMED,e.I=b.Timers.setTimeout(e.timer_I.bind(e),b.Timers.TIMER_I),!0}else return!1;break;case b.C.CANCEL:if(e=a.transactions.ist[c.via_branch])return c.reply_sl(200),
e.state===h.STATUS_PROCEEDING?!1:!0;c.reply_sl(481);return!0;default:if(e=a.transactions.nist[c.via_branch]){switch(e.state){case h.STATUS_PROCEEDING:case h.STATUS_COMPLETED:e.transport.send(e.last_response)}return!0}}},NonInviteClientTransaction:f,InviteClientTransaction:e,AckClientTransaction:g,NonInviteServerTransaction:a,InviteServerTransaction:c}}},{}],62:[function(k,l,n){l.exports=function(b,h){var f;f=function(b,f){this.logger=b.getLogger("sip.transport");this.ua=b;this.ws=null;this.server=
f;this.reconnection_attempts=0;this.connected=this.closed=!1;this.reconnectTimer=null;this.lastTransportError={};this.ua.transport=this;this.connect()};f.prototype={send:function(b){b=b.toString();if(this.ws&&this.ws.readyState===h.OPEN)return!0===this.ua.configuration.traceSip&&this.logger.log("sending WebSocket message:\n\n"+b+"\n"),this.ws.send(b),!0;this.logger.warn("unable to send message, WebSocket is not open");return!1},disconnect:function(){this.ws&&(b.Timers.clearTimeout(this.reconnectTimer),
this.closed=!0,this.logger.log("closing WebSocket "+this.server.ws_uri),this.ws.close());null!==this.reconnectTimer&&(b.Timers.clearTimeout(this.reconnectTimer),this.reconnectTimer=null,this.ua.emit("disconnected",{transport:this,code:this.lastTransportError.code,reason:this.lastTransportError.reason}))},connect:function(){var b=this;if(this.ws&&(this.ws.readyState===h.OPEN||this.ws.readyState===h.CONNECTING))return this.logger.log("WebSocket "+this.server.ws_uri+" is already connected"),!1;this.ws&&
this.ws.close();this.logger.log("connecting to WebSocket "+this.server.ws_uri);this.ua.onTransportConnecting(this,0===this.reconnection_attempts?1:this.reconnection_attempts);try{this.ws=new h(this.server.ws_uri,"sip")}catch(f){this.logger.warn("error connecting to WebSocket "+this.server.ws_uri+": "+f)}this.ws.binaryType="arraybuffer";this.ws.onopen=function(){b.onOpen()};this.ws.onclose=function(a){b.onClose(a)};this.ws.onmessage=function(a){b.onMessage(a)};this.ws.onerror=function(a){b.onError(a)}},
onOpen:function(){this.connected=!0;this.logger.log("WebSocket "+this.server.ws_uri+" connected");null!==this.reconnectTimer&&(b.Timers.clearTimeout(this.reconnectTimer),this.reconnectTimer=null);this.reconnection_attempts=0;this.closed=!1;this.ua.onTransportConnected(this)},onClose:function(b){var f=this.connected;this.lastTransportError.code=b.code;this.lastTransportError.reason=b.reason;if(0<this.reconnection_attempts)this.logger.log("Reconnection attempt "+this.reconnection_attempts+" failed (code: "+
b.code+(b.reason?"| reason: "+b.reason:"")+")"),this.reconnect();else if(this.connected=!1,this.logger.log("WebSocket disconnected (code: "+b.code+(b.reason?"| reason: "+b.reason:"")+")"),!1===b.wasClean&&this.logger.warn("WebSocket abrupt disconnection"),!0===f)this.ua.onTransportClosed(this),this.closed?this.ua.emit("disconnected",{transport:this,code:this.lastTransportError.code,reason:this.lastTransportError.reason}):this.reconnect();else this.ua.onTransportError(this)},onMessage:function(e){var f;
e=e.data;if("\r\n"===e)!0===this.ua.configuration.traceSip&&this.logger.log("received WebSocket message with CRLF Keep Alive response");else{if("string"!==typeof e){try{e=String.fromCharCode.apply(null,new Uint8Array(e))}catch(a){this.logger.warn("received WebSocket binary message failed to be converted into string, message discarded");return}!0===this.ua.configuration.traceSip&&this.logger.log("received WebSocket binary message:\n\n"+e+"\n")}else!0===this.ua.configuration.traceSip&&this.logger.log("received WebSocket text message:\n\n"+
e+"\n");if((e=b.Parser.parseMessage(e,this.ua))&&!(this.ua.status===b.UA.C.STATUS_USER_CLOSED&&e instanceof b.IncomingRequest)&&b.sanityCheck(e,this.ua,this))if(e instanceof b.IncomingRequest)e.transport=this,this.ua.receiveRequest(e);else if(e instanceof b.IncomingResponse)switch(e.method){case b.C.INVITE:(f=this.ua.transactions.ict[e.via_branch])&&f.receiveResponse(e);break;case b.C.ACK:break;default:(f=this.ua.transactions.nict[e.via_branch])&&f.receiveResponse(e)}}},onError:function(b){this.logger.warn("WebSocket connection error: "+
JSON.stringify(b))},reconnect:function(){var e=this;this.reconnection_attempts+=1;this.reconnection_attempts>this.ua.configuration.wsServerMaxReconnection?(this.logger.warn("maximum reconnection attempts for WebSocket "+this.server.ws_uri),this.ua.onTransportError(this)):1===this.reconnection_attempts?(this.logger.log("Connection to WebSocket "+this.server.ws_uri+" severed, attempting first reconnect"),e.connect()):(this.logger.log("trying to reconnect to WebSocket "+this.server.ws_uri+" (reconnection attempt "+
this.reconnection_attempts+")"),this.reconnectTimer=b.Timers.setTimeout(function(){e.connect();e.reconnectTimer=null},1E3*this.ua.configuration.wsServerReconnectionTimeout))}};f.C={STATUS_READY:0,STATUS_DISCONNECTED:1,STATUS_ERROR:2};return f}},{}],63:[function(k,l,n){l.exports=function(b,h){function f(a){if(a instanceof Function)return a.initialize||(a.initialize=function(){return b.Utils.Promise.resolve()}),a}var e,g={STATUS_INIT:0,STATUS_READY:1,STATUS_USER_CLOSED:2,STATUS_NOT_READY:3,CONFIGURATION_ERROR:1,
NETWORK_ERROR:2,EVENT_METHODS:{invite:"INVITE",message:"MESSAGE"},ALLOWED_METHODS:"ACK CANCEL BYE OPTIONS INFO NOTIFY".split(" "),ACCEPTED_BODY_TYPES:["application/sdp","application/dtmf-relay"],MAX_FORWARDS:70,TAG_LENGTH:10};e=function(a){g.ACCEPTED_BODY_TYPES=g.ACCEPTED_BODY_TYPES.toString();this.log=new b.LoggerFactory;this.logger=this.getLogger("sip.ua");this.cache={credentials:{}};this.configuration={};this.dialogs={};this.applicants={};this.data={};this.sessions={};this.subscriptions={};this.contact=
this.transport=null;this.status=g.STATUS_INIT;this.error=null;this.transactions={nist:{},nict:{},ist:{},ict:{}};this.transportRecoverAttempts=0;this.transportRecoveryTimer=null;Object.defineProperties(this,{transactionsCount:{get:function(){var a,b=["nist","nict","ist","ict"],c=0;for(a in b)c+=Object.keys(this.transactions[b[a]]).length;return c}},nictTransactionsCount:{get:function(){return Object.keys(this.transactions.nict).length}},nistTransactionsCount:{get:function(){return Object.keys(this.transactions.nist).length}},
ictTransactionsCount:{get:function(){return Object.keys(this.transactions.ict).length}},istTransactionsCount:{get:function(){return Object.keys(this.transactions.ist).length}}});if(void 0===a)a={};else if("string"===typeof a||a instanceof String)a={uri:a};a.log&&(a.log.hasOwnProperty("builtinEnabled")&&(this.log.builtinEnabled=a.log.builtinEnabled),a.log.hasOwnProperty("level")&&(this.log.level=a.log.level),a.log.hasOwnProperty("connector")&&(this.log.connector=a.log.connector));try{this.loadConfig(a)}catch(c){throw this.status=
g.STATUS_NOT_READY,this.error=g.CONFIGURATION_ERROR,c;}this.registerContext=new b.RegisterContext(this);this.registerContext.on("failed",this.emit.bind(this,"registrationFailed"));this.registerContext.on("registered",this.emit.bind(this,"registered"));this.registerContext.on("unregistered",this.emit.bind(this,"unregistered"));this.configuration.autostart&&this.start();"function"===typeof h.addEventListener&&h.addEventListener("unload",this.stop.bind(this))};e.prototype=Object.create(b.EventEmitter.prototype);
e.prototype.register=function(a){this.configuration.register=!0;this.registerContext.register(a);return this};e.prototype.unregister=function(a){this.configuration.register=!1;this.registerContext.unregister(a);return this};e.prototype.isRegistered=function(){return this.registerContext.registered};e.prototype.isConnected=function(){return this.transport?this.transport.connected:!1};e.prototype.afterConnected=function(a){if(this.isConnected())a();else this.once("connected",a)};e.prototype.invite=
function(a,c){var d=new b.InviteClientContext(this,a,c);this.afterConnected(d.invite.bind(d));return d};e.prototype.subscribe=function(a,c,d){a=new b.Subscription(this,a,c,d);this.afterConnected(a.subscribe.bind(a));return a};e.prototype.message=function(a,c,d){if(void 0===c)throw new TypeError("Not enough arguments");d=Object.create(d||Object.prototype);d.contentType||(d.contentType="text/plain");d.body=c;return this.request(b.C.MESSAGE,a,d)};e.prototype.request=function(a,c,d){a=new b.ClientContext(this,
a,c,d);this.afterConnected(a.send.bind(a));return a};e.prototype.stop=function(){function a(){0===f.nistTransactionsCount&&0===f.nictTransactionsCount&&(f.removeListener("transactionDestroyed",a),f.transport.disconnect())}var c,d,e,f=this;this.logger.log("user requested closure...");if(this.status===g.STATUS_USER_CLOSED)return this.logger.warn("UA already closed"),this;b.Timers.clearTimeout(this.transportRecoveryTimer);this.logger.log("closing registerContext");this.registerContext.close();for(c in this.sessions)this.logger.log("closing session "+
c),this.sessions[c].terminate();for(d in this.subscriptions)this.logger.log("unsubscribing from subscription "+d),this.subscriptions[d].close();for(e in this.applicants)this.applicants[e].close();this.status=g.STATUS_USER_CLOSED;if(0===this.nistTransactionsCount&&0===this.nictTransactionsCount)this.transport.disconnect();else this.on("transactionDestroyed",a);return this};e.prototype.start=function(){var a;this.logger.log("user requested startup...");this.status===g.STATUS_INIT?(a=this.getNextWsServer(),
new b.Transport(this,a)):this.status===g.STATUS_USER_CLOSED?(this.logger.log("resuming"),this.status=g.STATUS_READY,this.transport.connect()):this.status===g.STATUS_READY?this.logger.log("UA is in READY status, not resuming"):this.logger.error("Connection is down. Auto-Recovery system is trying to connect");return this};e.prototype.normalizeTarget=function(a){return b.Utils.normalizeTarget(a,this.configuration.hostportParams)};e.prototype.saveCredentials=function(a){this.cache.credentials[a.realm]=
this.cache.credentials[a.realm]||{};this.cache.credentials[a.realm][a.uri]=a;return this};e.prototype.getCredentials=function(a){var b,d;b=a.ruri.host;this.cache.credentials[b]&&this.cache.credentials[b][a.ruri]&&(d=this.cache.credentials[b][a.ruri],d.method=a.method);return d};e.prototype.getLogger=function(a,b){return this.log.getLogger(a,b)};e.prototype.onTransportClosed=function(a){var c,d,e=["nict","ict","nist","ist"];a.server.status=b.Transport.C.STATUS_DISCONNECTED;this.logger.log("connection state set to "+
b.Transport.C.STATUS_DISCONNECTED);d=e.length;for(a=0;a<d;a++)for(c in this.transactions[e[a]])this.transactions[e[a]][c].onTransportError();this.contact.pub_gruu||this.closeSessionsOnTransportError()};e.prototype.onTransportError=function(a){this.logger.log("transport "+a.server.ws_uri+" failed | connection state set to "+b.Transport.C.STATUS_ERROR);a.server.status=b.Transport.C.STATUS_ERROR;this.emit("disconnected",{transport:a});this.status!==g.STATUS_USER_CLOSED&&((a=this.getNextWsServer())?new b.Transport(this,
a):(this.closeSessionsOnTransportError(),this.error&&this.error===g.NETWORK_ERROR||(this.status=g.STATUS_NOT_READY,this.error=g.NETWORK_ERROR),this.recoverTransport()))};e.prototype.onTransportConnected=function(a){this.transport=a;this.transportRecoverAttempts=0;a.server.status=b.Transport.C.STATUS_READY;this.logger.log("connection state set to "+b.Transport.C.STATUS_READY);this.status!==g.STATUS_USER_CLOSED&&(this.status=g.STATUS_READY,this.error=null,this.configuration.register&&this.configuration.authenticationFactory.initialize().then(function(){this.registerContext.onTransportConnected()}.bind(this)),
this.emit("connected",{transport:a}))};e.prototype.onTransportConnecting=function(a,b){this.emit("connecting",{transport:a,attempts:b})};e.prototype.newTransaction=function(a){this.transactions[a.type][a.id]=a;this.emit("newTransaction",{transaction:a})};e.prototype.destroyTransaction=function(a){delete this.transactions[a.type][a.id];this.emit("transactionDestroyed",{transaction:a})};e.prototype.receiveRequest=function(a){function c(b){return b&&b.user===a.ruri.user}var d,e,f;e=a.method;f=a.method.toLowerCase();
var h=this;if(!(c(this.configuration.uri)||c(this.contact.uri)||c(this.contact.pub_gruu)||c(this.contact.temp_gruu)))this.logger.warn("Request-URI does not point to us"),a.method!==b.C.ACK&&a.reply_sl(404);else if(a.ruri.scheme===b.C.SIPS)a.reply_sl(416);else if(!b.Transactions.checkTransaction(this,a)){if(e===b.C.OPTIONS)new b.Transactions.NonInviteServerTransaction(a,this),a.reply(200,null,["Allow: "+b.Utils.getAllowedMethods(this),"Accept: "+g.ACCEPTED_BODY_TYPES]);else if(e===b.C.MESSAGE){if(!this.listeners(f).length){new b.Transactions.NonInviteServerTransaction(a,
this);a.reply(405,null,["Allow: "+b.Utils.getAllowedMethods(this)]);return}f=new b.ServerContext(this,a);f.body=a.body;f.content_type=a.getHeader("Content-Type")||"text/plain";a.reply(200,null);this.emit("message",f)}else e!==b.C.INVITE&&e!==b.C.ACK&&new b.ServerContext(this,a);if(a.to_tag)(d=this.findDialog(a))?(e===b.C.INVITE&&new b.Transactions.InviteServerTransaction(a,this),d.receiveRequest(a)):e===b.C.NOTIFY?(e=this.findSession(a))?e.receiveRequest(a):(this.logger.warn("received NOTIFY request for a non existent session"),
a.reply(481,"Subscription does not exist")):e!==b.C.ACK&&a.reply(481);else switch(e){case b.C.INVITE:if(e=this.configuration.replaces!==b.C.supported.UNSUPPORTED&&a.parseHeader("replaces"))if(d=this.dialogs[e.call_id+e.replaces_to_tag+e.replaces_from_tag],!d){a.reply_sl(481,null);break}else if(d.owner.status===b.Session.C.STATUS_TERMINATED){a.reply_sl(603,null);break}else if(d.state===b.Dialog.C.STATUS_CONFIRMED&&e.early_only){a.reply_sl(486,null);break}e=this.configuration.mediaHandlerFactory.isSupported;
!e||e()?(e=new b.InviteServerContext(this,a),e.replacee=d&&d.owner,e.on("invite",function(){h.emit("invite",this)})):(this.logger.warn("INVITE received but WebRTC is not supported"),a.reply(488));break;case b.C.BYE:a.reply(481);break;case b.C.CANCEL:(e=this.findSession(a))?e.receiveRequest(a):this.logger.warn("received CANCEL request for a non existent session");break;case b.C.ACK:break;default:a.reply(405)}}};e.prototype.findSession=function(a){return this.sessions[a.call_id+a.from_tag]||this.sessions[a.call_id+
a.to_tag]||null};e.prototype.findDialog=function(a){return this.dialogs[a.call_id+a.from_tag+a.to_tag]||this.dialogs[a.call_id+a.to_tag+a.from_tag]||null};e.prototype.getNextWsServer=function(){var a,c,d,e=[];c=this.configuration.wsServers.length;for(a=0;a<c;a++)d=this.configuration.wsServers[a],d.status!==b.Transport.C.STATUS_ERROR&&(0===e.length?e.push(d):d.weight>e[0].weight?e=[d]:d.weight===e[0].weight&&e.push(d));a=Math.floor(Math.random()*e.length);return e[a]};e.prototype.closeSessionsOnTransportError=
function(){for(var a in this.sessions)this.sessions[a].onTransportError();this.registerContext.onTransportClosed()};e.prototype.recoverTransport=function(a){var c,d,e,f;a=a||this;e=a.transportRecoverAttempts;d=a.configuration.wsServers.length;for(c=0;c<d;c++)a.configuration.wsServers[c].status=0;f=a.getNextWsServer();c=Math.floor(Math.random()*Math.pow(2,e)+1)*a.configuration.connectionRecoveryMinInterval;c>a.configuration.connectionRecoveryMaxInterval&&(this.logger.log("time for next connection attempt exceeds connectionRecoveryMaxInterval, resetting counter"),
c=a.configuration.connectionRecoveryMinInterval,e=0);this.logger.log("next connection attempt in "+c+" seconds");this.transportRecoveryTimer=b.Timers.setTimeout(function(){a.transportRecoverAttempts=e+1;new b.Transport(a,f)},1E3*c)};e.prototype.loadConfig=function(a){function c(b,c){var d=b.replace(/([a-z][A-Z])/g,function(a){return a[0]+"_"+a[1].toLowerCase()});if(b!==d){var e=a.hasOwnProperty(b);a.hasOwnProperty(d)&&(c.warn(d+" is deprecated, please use "+b),e&&c.warn(b+" overriding "+d));a[b]=
e?a[b]:a[d]}}var d,g,h,k={viaHost:b.Utils.createRandomToken(12)+".invalid",uri:new b.URI("sip","anonymous."+b.Utils.createRandomToken(6),"anonymous.invalid",null,null),wsServers:[{scheme:"WSS",sip_uri:"<sip:edge.sip.onsip.com;transport=ws;lr>",status:0,weight:0,ws_uri:"wss://edge.sip.onsip.com"}],password:null,registerExpires:600,register:!0,registrarServer:null,wsServerMaxReconnection:3,wsServerReconnectionTimeout:4,connectionRecoveryMinInterval:2,connectionRecoveryMaxInterval:30,usePreloadedRoute:!1,
userAgentString:b.C.USER_AGENT,iceCheckingTimeout:5E3,noAnswerTimeout:60,stunServers:["stun:stun.l.google.com:19302"],turnServers:[],traceSip:!1,hackViaTcp:!1,hackIpInContact:!1,hackWssInTransport:!1,autostart:!0,rel100:b.C.supported.UNSUPPORTED,replaces:b.C.supported.UNSUPPORTED,mediaHandlerFactory:b.WebRTC.MediaHandler.defaultFactory,authenticationFactory:f(function(a){return new b.DigestAuthentication(a)})};for(d in e.configuration_check.mandatory)if(c(d,this.logger),a.hasOwnProperty(d))if(g=a[d],
h=e.configuration_check.mandatory[d](g),void 0!==h)k[d]=h;else throw new b.Exceptions.ConfigurationError(d,g);else throw new b.Exceptions.ConfigurationError(d);b.Utils.optionsOverride(a,"rel100","reliable",!0,this.logger,b.C.supported.UNSUPPORTED);var l=["stunServers","turnServers"];for(d in e.configuration_check.optional)if(c(d,this.logger),a.hasOwnProperty(d)&&(g=a[d],!(g instanceof Array&&0===g.length&&0>l.indexOf(d)||null===g||""===g||void 0===g||"number"===typeof g&&isNaN(g))))if(h=e.configuration_check.optional[d](g),
void 0!==h)k[d]=h;else throw new b.Exceptions.ConfigurationError(d,g);if(k.connectionRecoveryMaxInterval<k.connectionRecoveryMinInterval)throw new b.Exceptions.ConfigurationError("connectionRecoveryMaxInterval",k.connectionRecoveryMaxInterval);0===k.displayName&&(k.displayName="0");k.instanceId||(k.instanceId=b.Utils.newUUID());k.sipjsId=b.Utils.createRandomToken(5);g=k.uri.clone();g.user=null;k.hostportParams=g.toString().replace(/^sip:/i,"");k.authorizationUser||(k.authorizationUser=k.uri.user);
k.registrarServer||(g=k.uri.clone(),g.user=null,k.registrarServer=g);k.noAnswerTimeout*=1E3;k.hackIpInContact&&(k.viaHost=b.Utils.getRandomTestNetIP());this.contact={pub_gruu:null,temp_gruu:null,uri:new b.URI("sip",b.Utils.createRandomToken(8),k.viaHost,null,{transport:k.hackWssInTransport?"wss":"ws"}),toString:function(a){a=a||{};var b=a.outbound||null,c="<",c=a.anonymous?c+(this.temp_gruu||("sip:anonymous@anonymous.invalid;transport="+k.hackWssInTransport?"wss":"ws")).toString():c+(this.pub_gruu||
this.uri).toString();b&&(c+=";ob");return c+">"}};b.Utils.optionsOverride(k,"media","mediaConstraints",!0,this.logger);for(d in k)e.configuration_skeleton[d].value=k[d];Object.defineProperties(this.configuration,e.configuration_skeleton);for(d in k)e.configuration_skeleton[d].value="";this.logger.log("configuration parameters after validation:");for(d in k)switch(d){case "uri":case "registrarServer":case "mediaHandlerFactory":this.logger.log("\u00b7 "+d+": "+k[d]);break;case "password":this.logger.log("\u00b7 "+
d+": NOT SHOWN");break;default:this.logger.log("\u00b7 "+d+": "+JSON.stringify(k[d]))}};e.configuration_skeleton=function(){var a,b,d={},e="sipjsId hostportParams uri wsServers authorizationUser connectionRecoveryMaxInterval connectionRecoveryMinInterval displayName hackViaTcp hackIpInContact hackWssInTransport iceCheckingTimeout instanceId noAnswerTimeout password registerExpires registrarServer reliable rel100 replaces userAgentString autostart stunServers traceSip turnServers usePreloadedRoute wsServerMaxReconnection wsServerReconnectionTimeout mediaHandlerFactory media mediaConstraints authenticationFactory via_core_value viaHost".split(" ");
for(a in e)b=e[a],d[b]={value:"",writable:!1,configurable:!1};d.register={value:"",writable:!0,configurable:!1};return d}();e.configuration_check={mandatory:{},optional:{uri:function(a){/^sip:/i.test(a)||(a=b.C.SIP+":"+a);if((a=b.URI.parse(a))&&a.user)return a},wsServers:function(a){var c,d,e;if("string"===typeof a)a=[{ws_uri:a}];else if(a instanceof Array)for(d=a.length,c=0;c<d;c++)"string"===typeof a[c]&&(a[c]={ws_uri:a[c]});else return;if(0===a.length)return!1;d=a.length;for(c=0;c<d;c++){if(!a[c].ws_uri||
a[c].weight&&!Number(a[c].weight))return;e=b.Grammar.parse(a[c].ws_uri,"absoluteURI");if(-1===e||"wss"!==e.scheme&&"ws"!==e.scheme)return;a[c].sip_uri="<sip:"+e.host+(e.port?":"+e.port:"")+";transport=ws;lr>";a[c].weight||(a[c].weight=0);a[c].status=0;a[c].scheme=e.scheme.toUpperCase()}return a},authorizationUser:function(a){if(-1!==b.Grammar.parse('"'+a+'"',"quoted_string"))return a},connectionRecoveryMaxInterval:function(a){if(b.Utils.isDecimal(a)&&(a=Number(a),0<a))return a},connectionRecoveryMinInterval:function(a){if(b.Utils.isDecimal(a)&&
(a=Number(a),0<a))return a},displayName:function(a){if(-1!==b.Grammar.parse('"'+a+'"',"displayName"))return a},hackViaTcp:function(a){if("boolean"===typeof a)return a},hackIpInContact:function(a){if("boolean"===typeof a)return a},iceCheckingTimeout:function(a){if(b.Utils.isDecimal(a))return 500>a?5E3:a},hackWssInTransport:function(a){if("boolean"===typeof a)return a},instanceId:function(a){if("string"===typeof a&&(/^uuid:/i.test(a)&&(a=a.substr(5)),-1!==b.Grammar.parse(a,"uuid")))return a},noAnswerTimeout:function(a){if(b.Utils.isDecimal(a)&&
(a=Number(a),0<a))return a},password:function(a){return String(a)},rel100:function(a){return a===b.C.supported.REQUIRED?b.C.supported.REQUIRED:a===b.C.supported.SUPPORTED?b.C.supported.SUPPORTED:b.C.supported.UNSUPPORTED},replaces:function(a){return a===b.C.supported.REQUIRED?b.C.supported.REQUIRED:a===b.C.supported.SUPPORTED?b.C.supported.SUPPORTED:b.C.supported.UNSUPPORTED},register:function(a){if("boolean"===typeof a)return a},registerExpires:function(a){if(b.Utils.isDecimal(a)&&(a=Number(a),0<
a))return a},registrarServer:function(a){if("string"===typeof a&&(/^sip:/i.test(a)||(a=b.C.SIP+":"+a),(a=b.URI.parse(a))&&!a.user))return a},stunServers:function(a){var c,d,e;if("string"===typeof a)a=[a];else if(!(a instanceof Array))return;d=a.length;for(c=0;c<d;c++){e=a[c];/^stuns?:/.test(e)||(e="stun:"+e);if(-1===b.Grammar.parse(e,"stun_URI"))return;a[c]=e}return a},traceSip:function(a){if("boolean"===typeof a)return a},turnServers:function(a){var c,d,e,f,g,h;a instanceof Array||(a=[a]);e=a.length;
for(c=0;c<e;c++){f=a[c];f.server&&(f.urls=[f.server]);if(!f.urls||!f.username||!f.password)return;f.urls instanceof Array?g=f.urls.length:(f.urls=[f.urls],g=1);for(d=0;d<g;d++)if(h=f.urls[d],/^turns?:/.test(h)||(h="turn:"+h),-1===b.Grammar.parse(h,"turn_URI"))return}return a},userAgentString:function(a){if("string"===typeof a)return a},usePreloadedRoute:function(a){if("boolean"===typeof a)return a},wsServerMaxReconnection:function(a){if(b.Utils.isDecimal(a)&&(a=Number(a),0<a))return a},wsServerReconnectionTimeout:function(a){if(b.Utils.isDecimal(a)&&
(a=Number(a),0<a))return a},autostart:function(a){if("boolean"===typeof a)return a},mediaHandlerFactory:function(a){if(a instanceof Function){var c=function(){function c(a){1<e[a].length&&(e[a]=b.Utils.promisify(e,a,"getDescription"===a))}var e=a.apply(this,arguments);c("getDescription");c("setDescription");return e};c.isSupported=a.isSupported;return c}},authenticationFactory:f}};e.C=g;b.UA=e}},{}],64:[function(k,l,n){l.exports=function(b){var h;h=function(f,e,g,a,c,d){var h,k;if(!g)throw new TypeError('missing or invalid "host" parameter');
f=f||b.C.SIP;this.parameters={};this.headers={};for(h in c)this.setParam(h,c[h]);for(k in d)this.setHeader(k,d[k]);Object.defineProperties(this,{scheme:{get:function(){return f},set:function(a){f=a.toLowerCase()}},user:{get:function(){return e},set:function(a){e=a}},host:{get:function(){return g},set:function(a){g=a.toLowerCase()}},aor:{get:function(){return e+"@"+g}},port:{get:function(){return a},set:function(b){a=0===b?b:parseInt(b,10)||null}}})};h.prototype={setParam:function(b,e){b&&(this.parameters[b.toLowerCase()]=
"undefined"===typeof e||null===e?null:e.toString().toLowerCase())},getParam:function(b){if(b)return this.parameters[b.toLowerCase()]},hasParam:function(b){if(b)return this.parameters.hasOwnProperty(b.toLowerCase())&&!0||!1},deleteParam:function(b){var e;b=b.toLowerCase();if(this.parameters.hasOwnProperty(b))return e=this.parameters[b],delete this.parameters[b],e},clearParams:function(){this.parameters={}},setHeader:function(f,e){this.headers[b.Utils.headerize(f)]=e instanceof Array?e:[e]},getHeader:function(f){if(f)return this.headers[b.Utils.headerize(f)]},
hasHeader:function(f){if(f)return this.headers.hasOwnProperty(b.Utils.headerize(f))&&!0||!1},deleteHeader:function(f){var e;f=b.Utils.headerize(f);if(this.headers.hasOwnProperty(f))return e=this.headers[f],delete this.headers[f],e},clearHeaders:function(){this.headers={}},clone:function(){return new h(this.scheme,this.user,this.host,this.port,JSON.parse(JSON.stringify(this.parameters)),JSON.parse(JSON.stringify(this.headers)))},toString:function(){var f,e,g,a,c=[];a=this.scheme+":";this.scheme.match("^sips?$")||
(a+="//");this.user&&(a+=b.Utils.escapeUser(this.user)+"@");a+=this.host;if(this.port||0===this.port)a+=":"+this.port;for(e in this.parameters)a+=";"+e,null!==this.parameters[e]&&(a+="="+this.parameters[e]);for(f in this.headers)for(g in this.headers[f])c.push(f+"="+this.headers[f][g]);0<c.length&&(a+="?"+c.join("&"));return a}};h.parse=function(f){f=b.Grammar.parse(f,"SIP_URI");if(-1!==f)return f};b.URI=h}},{}],65:[function(k,l,n){l.exports=function(b,h){var f;f={Promise:h.Promise,defer:function(){var b=
{};b.promise=new f.Promise(function(f,a){b.resolve=f;b.reject=a});return b},promisify:function(b,g,a){var c=b[g];return function(d,g,h){return(new f.Promise(function(f,g){var h=[d,f,g];a&&(h=[f,g,d]);c.apply(b,h)})).then(g,h)}},augment:function(b,f,a,c){var d,h;h=f.prototype;for(d in h)if(c||void 0===b[d])b[d]=h[d];f.apply(b,a)},optionsOverride:function(b,f,a,c,d,h){c&&b[a]&&d.warn(a+" is deprecated, please use "+f+" instead");b[f]&&b[a]&&d.warn(f+" overriding "+a);b[f]=b[f]||b[a]||h},str_utf8_length:function(b){return encodeURIComponent(b).replace(/%[A-F\d]{2}/g,
"U").length},generateFakeSDP:function(b){if(b){var f=b.indexOf("o="),a=b.indexOf("\r\n",f);return"v=0\r\n"+b.slice(f,a)+"\r\ns=-\r\nt=0 0\r\nc=IN IP4 0.0.0.0"}},isFunction:function(b){return void 0!==b?"[object Function]"===Object.prototype.toString.call(b):!1},isDecimal:function(b){return!isNaN(b)&&parseFloat(b)===parseInt(b,10)},createRandomToken:function(b,f){var a,c,d="";f=f||32;for(a=0;a<b;a++)c=Math.random()*f|0,d+=c.toString(f);return d},newTag:function(){return b.Utils.createRandomToken(b.UA.C.TAG_LENGTH)},
newUUID:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var f=16*Math.random()|0;return("x"===b?f:f&3|8).toString(16)})},hostType:function(e){if(e&&(e=b.Grammar.parse(e,"host"),-1!==e))return e.host_type},normalizeTarget:function(e,f){var a,c;if(e){if(e instanceof b.URI)return e;if("string"===typeof e){c=e.split("@");switch(c.length){case 1:if(!f)return;a=e;c=f;break;case 2:a=c[0];c=c[1];break;default:a=c.slice(0,c.length-1).join("@"),c=c[c.length-1]}a=a.replace(/^(sips?|tel):/i,
"");/^[\-\.\(\)]*\+?[0-9\-\.\(\)]+$/.test(a)&&(a=a.replace(/[\-\.\(\)]/g,""));e=b.C.SIP+":"+b.Utils.escapeUser(a)+"@"+c;if(a=b.URI.parse(e))return a}}},escapeUser:function(b){return encodeURIComponent(decodeURIComponent(b)).replace(/%3A/ig,":").replace(/%2B/ig,"+").replace(/%3F/ig,"?").replace(/%2F/ig,"/")},headerize:function(b){var f={"Call-Id":"Call-ID",Cseq:"CSeq",Rack:"RAck",Rseq:"RSeq","Www-Authenticate":"WWW-Authenticate"};b=b.toLowerCase().replace(/_/g,"-").split("-");var a="",c=b.length,d;
for(d=0;d<c;d++)0!==d&&(a+="-"),a+=b[d].charAt(0).toUpperCase()+b[d].substring(1);f[a]&&(a=f[a]);return a},sipErrorCause:function(e){for(var f in b.C.SIP_ERROR_CAUSES)if(-1!==b.C.SIP_ERROR_CAUSES[f].indexOf(e))return b.C.causes[f];return b.C.causes.SIP_FAILURE_CODE},getReasonPhrase:function(e,f){return f||b.C.REASON_PHRASE[e]||""},getReasonHeaderValue:function(e,f){f=b.Utils.getReasonPhrase(e,f);return"SIP ;cause="+e+' ;text="'+f+'"'},getCancelReason:function(e,f){if(e&&200>e||699<e)throw new TypeError("Invalid status_code: "+
e);if(e)return b.Utils.getReasonHeaderValue(e,f)},buildStatusLine:function(b,g){b=b||null;g=g||null;if(!b||100>b||699<b)throw new TypeError("Invalid status_code: "+b);if(g&&"string"!==typeof g&&!(g instanceof String))throw new TypeError("Invalid reason_phrase: "+g);g=f.getReasonPhrase(b,g);return"SIP/2.0 "+b+" "+g+"\r\n"},getRandomTestNetIP:function(){return"192.0.2."+Math.floor(254*Math.random()+1)},getAllowedMethods:function(e){var f,a=b.UA.C.ALLOWED_METHODS.toString();for(f in b.UA.C.EVENT_METHODS)e.listeners(f).length&&
(a+=","+b.UA.C.EVENT_METHODS[f]);return a},calculateMD5:function(b){function f(a,b){var c,d,e,g,h;e=a&2147483648;g=b&2147483648;c=a&1073741824;d=b&1073741824;h=(a&1073741823)+(b&1073741823);return c&d?h^2147483648^e^g:c|d?h&1073741824?h^3221225472^e^g:h^1073741824^e^g:h^e^g}function a(a,b,c,d,e,h,k){a=f(a,f(f(b&c|~b&d,e),k));return f(a<<h|a>>>32-h,b)}function c(a,b,c,d,e,h,k){a=f(a,f(f(b&d|c&~d,e),k));return f(a<<h|a>>>32-h,b)}function d(a,b,c,d,e,h,k){a=f(a,f(f(b^c^d,e),k));return f(a<<h|a>>>32-
h,b)}function h(a,b,c,d,e,k,l){a=f(a,f(f(c^(b|~d),e),l));return f(a<<k|a>>>32-k,b)}function k(a){var b="",c="",d;for(d=0;3>=d;d++)c=a>>>8*d&255,c="0"+c.toString(16),b+=c.substr(c.length-2,2);return b}var l=[],n,A,v,C,q,t,r,u;b=function(a){a=a.replace(/\r\n/g,"\n");for(var b="",c=0;c<a.length;c++){var d=a.charCodeAt(c);128>d?b+=String.fromCharCode(d):(127<d&&2048>d?b+=String.fromCharCode(d>>6|192):(b+=String.fromCharCode(d>>12|224),b+=String.fromCharCode(d>>6&63|128)),b+=String.fromCharCode(d&63|128))}return b}(b);
l=function(a){var b,c=a.length;b=c+8;for(var d=16*((b-b%64)/64+1),e=Array(d-1),f=0,g=0;g<c;)b=(g-g%4)/4,f=g%4*8,e[b]|=a.charCodeAt(g)<<f,g++;b=(g-g%4)/4;e[b]|=128<<g%4*8;e[d-2]=c<<3;e[d-1]=c>>>29;return e}(b);q=1732584193;t=4023233417;r=2562383102;u=271733878;for(b=0;b<l.length;b+=16)n=q,A=t,v=r,C=u,q=a(q,t,r,u,l[b+0],7,3614090360),u=a(u,q,t,r,l[b+1],12,3905402710),r=a(r,u,q,t,l[b+2],17,606105819),t=a(t,r,u,q,l[b+3],22,3250441966),q=a(q,t,r,u,l[b+4],7,4118548399),u=a(u,q,t,r,l[b+5],12,1200080426),
r=a(r,u,q,t,l[b+6],17,2821735955),t=a(t,r,u,q,l[b+7],22,4249261313),q=a(q,t,r,u,l[b+8],7,1770035416),u=a(u,q,t,r,l[b+9],12,2336552879),r=a(r,u,q,t,l[b+10],17,4294925233),t=a(t,r,u,q,l[b+11],22,2304563134),q=a(q,t,r,u,l[b+12],7,1804603682),u=a(u,q,t,r,l[b+13],12,4254626195),r=a(r,u,q,t,l[b+14],17,2792965006),t=a(t,r,u,q,l[b+15],22,1236535329),q=c(q,t,r,u,l[b+1],5,4129170786),u=c(u,q,t,r,l[b+6],9,3225465664),r=c(r,u,q,t,l[b+11],14,643717713),t=c(t,r,u,q,l[b+0],20,3921069994),q=c(q,t,r,u,l[b+5],5,3593408605),
u=c(u,q,t,r,l[b+10],9,38016083),r=c(r,u,q,t,l[b+15],14,3634488961),t=c(t,r,u,q,l[b+4],20,3889429448),q=c(q,t,r,u,l[b+9],5,568446438),u=c(u,q,t,r,l[b+14],9,3275163606),r=c(r,u,q,t,l[b+3],14,4107603335),t=c(t,r,u,q,l[b+8],20,1163531501),q=c(q,t,r,u,l[b+13],5,2850285829),u=c(u,q,t,r,l[b+2],9,4243563512),r=c(r,u,q,t,l[b+7],14,1735328473),t=c(t,r,u,q,l[b+12],20,2368359562),q=d(q,t,r,u,l[b+5],4,4294588738),u=d(u,q,t,r,l[b+8],11,2272392833),r=d(r,u,q,t,l[b+11],16,1839030562),t=d(t,r,u,q,l[b+14],23,4259657740),
q=d(q,t,r,u,l[b+1],4,2763975236),u=d(u,q,t,r,l[b+4],11,1272893353),r=d(r,u,q,t,l[b+7],16,4139469664),t=d(t,r,u,q,l[b+10],23,3200236656),q=d(q,t,r,u,l[b+13],4,681279174),u=d(u,q,t,r,l[b+0],11,3936430074),r=d(r,u,q,t,l[b+3],16,3572445317),t=d(t,r,u,q,l[b+6],23,76029189),q=d(q,t,r,u,l[b+9],4,3654602809),u=d(u,q,t,r,l[b+12],11,3873151461),r=d(r,u,q,t,l[b+15],16,530742520),t=d(t,r,u,q,l[b+2],23,3299628645),q=h(q,t,r,u,l[b+0],6,4096336452),u=h(u,q,t,r,l[b+7],10,1126891415),r=h(r,u,q,t,l[b+14],15,2878612391),
t=h(t,r,u,q,l[b+5],21,4237533241),q=h(q,t,r,u,l[b+12],6,1700485571),u=h(u,q,t,r,l[b+3],10,2399980690),r=h(r,u,q,t,l[b+10],15,4293915773),t=h(t,r,u,q,l[b+1],21,2240044497),q=h(q,t,r,u,l[b+8],6,1873313359),u=h(u,q,t,r,l[b+15],10,4264355552),r=h(r,u,q,t,l[b+6],15,2734768916),t=h(t,r,u,q,l[b+13],21,1309151649),q=h(q,t,r,u,l[b+4],6,4149444226),u=h(u,q,t,r,l[b+11],10,3174756917),r=h(r,u,q,t,l[b+2],15,718787259),t=h(t,r,u,q,l[b+9],21,3951481745),q=f(q,n),t=f(t,A),r=f(r,v),u=f(u,C);return(k(q)+k(t)+k(r)+
k(u)).toLowerCase()}};b.Utils=f}},{}],66:[function(k,l,n){l.exports=function(b,h){var f;f={};f.MediaHandler=k("./WebRTC/MediaHandler")(b);f.MediaStreamManager=k("./WebRTC/MediaStreamManager")(b,h);var e;f.isSupported=function(){if(void 0!==e)return e;f.MediaStream=h.MediaStream;f.getUserMedia=h.getUserMedia;f.RTCPeerConnection=h.RTCPeerConnection;f.RTCSessionDescription=h.RTCSessionDescription;f.RTCPeerConnection&&f.RTCSessionDescription?(f.getUserMedia&&(f.getUserMedia=b.Utils.promisify(h,"getUserMedia")),
e=!0):e=!1;return e};return f}},{"./WebRTC/MediaHandler":67,"./WebRTC/MediaStreamManager":68}],67:[function(k,l,n){l.exports=function(b){var h=function(f,e){function g(a,b){if(a.mediaStreamManager.on)a.mediaStreamManager.on(b,function(){a.emit.apply(a,[b].concat(Array.prototype.slice.call(arguments)))})}e=e||{};this.logger=f.ua.getLogger("sip.invitecontext.mediahandler",f.id);this.session=f;this.localMedia=null;this.ready=!0;this.mediaStreamManager=e.mediaStreamManager||new b.WebRTC.MediaStreamManager(this.logger);
this.videoMuted=this.audioMuted=!1;var a,c,d,h,k=this,l=[];a=e.stunServers||null;var n=e.turnServers||null,A=this.session.ua.configuration;this.RTCConstraints=e.RTCConstraints||{};a||(a=A.stunServers);n||(n=A.turnServers);[].concat(a).forEach(function(a){l.push({url:a})});d=n.length;for(a=0;a<d;a++)for(h=n[a],c=0;c<h.urls.length;c++)l.push({url:h.urls[c],username:h.username,credential:h.password});this.onIceCompleted=b.Utils.defer();this.onIceCompleted.promise.then(function(a){k.emit("iceGatheringComplete",
a);k.iceCheckingTimer&&(b.Timers.clearTimeout(k.iceCheckingTimer),k.iceCheckingTimer=null)});this.peerConnection=new b.WebRTC.RTCPeerConnection({iceServers:l},this.RTCConstraints);this._remoteStreams=[];this.peerConnection.onaddstream=function(a){k.logger.log("stream added: "+a.stream.id);k._remoteStreams.push(a.stream);k.render();k.emit("addStream",a)};this.peerConnection.onremovestream=function(a){k.logger.log("stream removed: "+a.stream.id)};this.peerConnection.onicecandidate=function(a){k.emit("iceCandidate",
a);a.candidate?k.logger.log("ICE candidate received: "+(null===a.candidate.candidate?null:a.candidate.candidate.trim())):k.onIceCompleted.resolve(this)};this.peerConnection.onicegatheringstatechange=function(){k.logger.log("RTCIceGatheringState changed: "+this.iceGatheringState);"gathering"===this.iceGatheringState&&k.emit("iceGathering",this);"complete"===this.iceGatheringState&&k.onIceCompleted.resolve(this)};this.peerConnection.oniceconnectionstatechange=function(){var a;"checking"===this.iceConnectionState&&
(k.iceCheckingTimer=b.Timers.setTimeout(function(){k.logger.log("RTCIceChecking Timeout Triggered after "+A.iceCheckingTimeout+" micro seconds");k.onIceCompleted.resolve(this)}.bind(this),A.iceCheckingTimeout));switch(this.iceConnectionState){case "new":a="iceConnection";break;case "checking":a="iceConnectionChecking";break;case "connected":a="iceConnectionConnected";break;case "completed":a="iceConnectionCompleted";break;case "failed":a="iceConnectionFailed";break;case "disconnected":a="iceConnectionDisconnected";
break;case "closed":a="iceConnectionClosed";break;default:k.logger.warn("Unknown iceConnection state:",this.iceConnectionState);return}k.emit(a,this)};this.peerConnection.onstatechange=function(){k.logger.log('PeerConnection state changed to "'+this.readyState+'"')};g(this,"userMediaRequest");g(this,"userMedia");g(this,"userMediaFailed")};h.defaultFactory=function(b,e){return new h(b,e)};h.defaultFactory.isSupported=function(){return b.WebRTC.isSupported()};h.prototype=Object.create(b.MediaHandler.prototype,
{isReady:{writable:!0,value:function(){return this.ready}},close:{writable:!0,value:function(){this.logger.log("closing PeerConnection");this._remoteStreams=[];this.peerConnection&&"closed"!==this.peerConnection.signalingState&&(this.peerConnection.close(),this.localMedia&&this.mediaStreamManager.release(this.localMedia))}},getDescription:{writable:!0,value:function(f){var e=this,g=e.mediaStreamManager.acquire;1<g.length&&(g=b.Utils.promisify(this.mediaStreamManager,"acquire",!0));f=f||{};!0===f.dataChannel&&
(f.dataChannel={});this.mediaHint=f;e.localMedia?(e.logger.log("already have local media"),g=b.Utils.Promise.resolve(e.localMedia)):(e.logger.log("acquiring local media"),g=g.call(e.mediaStreamManager,f).then(function(a){e.logger.log("acquired local media streams");e.localMedia=a;e.session.connecting();return a},function(a){e.logger.error("unable to acquire streams");e.logger.error(a);e.session.connecting();throw a;}).then(this.addStreams.bind(this)));return g.then(function(){e.hasOffer("remote")?
e.peerConnection.ondatachannel=function(a){e.dataChannel=a.channel;e.emit("dataChannel",e.dataChannel)}:f.dataChannel&&e.peerConnection.createDataChannel&&(e.dataChannel=e.peerConnection.createDataChannel("sipjs",f.dataChannel),e.emit("dataChannel",e.dataChannel));e.render();return e.createOfferOrAnswer(e.RTCConstraints)})}},setDescription:{writable:!0,value:function(f){f={type:this.hasOffer("local")?"answer":"offer",sdp:f};this.emit("setDescription",f);f=new b.WebRTC.RTCSessionDescription(f);return b.Utils.promisify(this.peerConnection,
"setRemoteDescription")(f)}},getReferMedia:{writable:!0,value:function(){function b(e,a){return 0<a[e]().length}function e(e){return this.getLocalStreams().some(b.bind(null,e))&&this.getRemoteStreams().some(b.bind(null,e))}return{constraints:{audio:e.call(this,"getAudioTracks"),video:e.call(this,"getVideoTracks")}}}},isMuted:{writable:!0,value:function(){return{audio:this.audioMuted,video:this.videoMuted}}},mute:{writable:!0,value:function(b){if(0!==this.getLocalStreams().length){b=b||{audio:0<this.getLocalStreams()[0].getAudioTracks().length,
video:0<this.getLocalStreams()[0].getVideoTracks().length};var e=!1,g=!1;b.audio&&!this.audioMuted&&(this.audioMuted=e=!0,this.toggleMuteAudio(!0));b.video&&!this.videoMuted&&(this.videoMuted=g=!0,this.toggleMuteVideo(!0));if(e||g)return{audio:e,video:g}}}},unmute:{writable:!0,value:function(b){if(0!==this.getLocalStreams().length){b=b||{audio:0<this.getLocalStreams()[0].getAudioTracks().length,video:0<this.getLocalStreams()[0].getVideoTracks().length};var e=!1,g=!1;b.audio&&this.audioMuted&&(e=!0,
this.audioMuted=!1,this.toggleMuteAudio(!1));b.video&&this.videoMuted&&(g=!0,this.videoMuted=!1,this.toggleMuteVideo(!1));if(e||g)return{audio:e,video:g}}}},hold:{writable:!0,value:function(){this.toggleMuteAudio(!0);this.toggleMuteVideo(!0)}},unhold:{writable:!0,value:function(){this.audioMuted||this.toggleMuteAudio(!1);this.videoMuted||this.toggleMuteVideo(!1)}},getLocalStreams:{writable:!0,value:function(){var b=this.peerConnection;return b&&"closed"===b.signalingState?(this.logger.warn("peerConnection is closed, getLocalStreams returning []"),
[]):b.getLocalStreams&&b.getLocalStreams()||b.localStreams||[]}},getRemoteStreams:{writable:!0,value:function(){var b=this.peerConnection;return b&&"closed"===b.signalingState?(this.logger.warn("peerConnection is closed, getRemoteStreams returning this._remoteStreams"),this._remoteStreams):b.getRemoteStreams&&b.getRemoteStreams()||b.remoteStreams||[]}},render:{writable:!0,value:function(f){f=f||this.mediaHint&&this.mediaHint.render;if(!f)return!1;var e={local:"getLocalStreams",remote:"getRemoteStreams"};
Object.keys(e).forEach(function(g){var a=this[e[g]]();b.WebRTC.MediaStreamManager.render(a,f[g])}.bind(this))}},hasOffer:{writable:!0,value:function(b){return this.peerConnection.signalingState==="have-"+b+"-offer"}},createOfferOrAnswer:{writable:!0,value:function(f){var e=this,g,a=e.peerConnection;e.ready=!1;g=e.hasOffer("remote")?"createAnswer":"createOffer";return b.Utils.promisify(a,g,!0)(f).then(b.Utils.promisify(a,"setLocalDescription")).then(function(){var c=b.Utils.defer();"complete"===a.iceConnectionState||
"completed"===a.iceConnectionState?c.resolve():e.onIceCompleted.promise.then(c.resolve);return c.promise}).then(function(){var c=a.localDescription.sdp,c=b.Hacks.Chrome.needsExplicitlyInactiveSDP(c),c=b.Hacks.AllBrowsers.unmaskDtls(c),c=b.Hacks.Firefox.hasIncompatibleCLineWithSomeSIPEndpoints(c),c={type:"createOffer"===g?"offer":"answer",sdp:c};e.emit("getDescription",c);e.ready=!0;return c.sdp}).catch(function(a){e.logger.error(a);e.ready=!0;throw new b.Exceptions.GetDescriptionError(a);})}},addStreams:{writable:!0,
value:function(f){try{f=[].concat(f),f.forEach(function(b){this.peerConnection.addStream(b)},this)}catch(e){return this.logger.error("error adding stream"),this.logger.error(e),b.Utils.Promise.reject(e)}return b.Utils.Promise.resolve()}},toggleMuteHelper:{writable:!0,value:function(b,e){this.getLocalStreams().forEach(function(g){g[b]().forEach(function(a){a.enabled=!e})})}},toggleMuteAudio:{writable:!0,value:function(b){this.toggleMuteHelper("getAudioTracks",b)}},toggleMuteVideo:{writable:!0,value:function(b){this.toggleMuteHelper("getVideoTracks",
b)}}});return h}},{}],68:[function(k,l,n){l.exports=function(b,h){var f=function(e,f){if(!b.WebRTC.isSupported())throw new b.Exceptions.NotSupportedError("Media not supported");this.mediaHint=f||{constraints:{audio:!0,video:!0}};this.acquisitions={}};f.streamId=function(b){return b.getAudioTracks().concat(b.getVideoTracks()).map(function(b){return b.id}).join("")};f.render=function(e,f){function a(a,b){if("undefined"!==typeof a.src)h.revokeObjectURL(a.src),a.src=h.createObjectURL(b);else if("undefined"!==
typeof(a.srcObject||a.mozSrcObject))a.srcObject=a.mozSrcObject=b;else return!1;return!0}function c(a){a.ensurePlayingIntervalId=b.Timers.setInterval(function(){a.paused?a.play():b.Timers.clearInterval(a.ensurePlayingIntervalId)},100)}if(!f)return!1;if(Array.isArray(f)&&!f.length)throw new TypeError("elements must not be empty");f=[].concat(f);[].concat(e).forEach(function(b,e,f){"function"===typeof b&&(b=b());b=b[f%b.length];(h.attachMediaStream||a)(b,e);c(b)}.bind(null,f))};f.prototype=Object.create(b.EventEmitter.prototype,
{acquire:{writable:!0,value:function(e){e=Object.keys(e||{}).length?e:this.mediaHint;var g=function(a,c){c=[].concat(c);c.forEach(function(b){b=f.streamId(b);this.acquisitions[b]=!!a},this);return b.Utils.Promise.resolve(c)}.bind(this);if(e.stream)return g(!0,e.stream);var a=e.constraints||this.mediaHint&&this.mediaHint.constraints||{audio:!0,video:!0},c=b.Utils.defer();b.Timers.setTimeout(function(){this.emit("userMediaRequest",a);var d=function(a,b){var c=Array.prototype.slice.call(arguments,2),
d=[a].concat(c);this.emit.apply(this,d);return b.apply(null,c)}.bind(this);c.resolve(b.WebRTC.getUserMedia(a).then(d.bind(this,"userMedia",g.bind(null,!1)),d.bind(this,"userMediaFailed",function(a){throw a;})))}.bind(this),0);return c.promise}},release:{writable:!0,value:function(b){b=[].concat(b);b.forEach(function(b){var a=f.streamId(b);!1===this.acquisitions[a]&&b.stop();delete this.acquisitions[a]},this)}}});return f}},{}],69:[function(k,l,n){(function(b){function h(b,e){if(null!=b){var g=e.charAt(0).toUpperCase()+
e.slice(1),g=[e,"webkit"+g,"moz"+g],a;for(a in g){var c=b[g[a]];if(c)return c.bind(b)}}}b=b.window||b;l.exports={WebSocket:b.WebSocket,Transport:k("./Transport"),open:b.open,Promise:b.Promise,timers:b,console:b.console||{debug:function(){},log:function(){},warn:function(){},error:function(){}},MediaStream:h(b,"MediaStream"),getUserMedia:h(b.navigator,"getUserMedia"),RTCPeerConnection:h(b,"RTCPeerConnection"),RTCSessionDescription:h(b,"RTCSessionDescription"),addEventListener:h(b,"addEventListener"),
HTMLMediaElement:b.HTMLMediaElement,attachMediaStream:b.attachMediaStream,createObjectURL:b.URL&&b.URL.createObjectURL,revokeObjectURL:b.URL&&b.URL.revokeObjectURL}}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./Transport":62}],70:[function(k,l,n){l.exports=k("./SIP")(k("./environment"))},{"./SIP":53,"./environment":69}],71:[function(k,l,n){n.XMLHttpRequest=XMLHttpRequest},{}],72:[function(k,l,n){l.exports={name:"twilio-rtc-conversations",
title:"Twilio RTC Conversations",description:"Twilio RTC Conversations JavaScript library",version:"0.8.1",homepage:"https://twilio.com",author:"Mark Andrus Roberts <mroberts@twilio.com>",keywords:["twilio","webrtc","library","javascript"],devDependencies:{browserify:"^9.0.3",cheerio:"^0.18.0",closurecompiler:"^1.5.1",jsdoc:"^3.3.0-beta2",jshint:"^2.6.3","jshint-stylish":"^1.0.0",jsonwebtoken:"^5.0.0",mocha:"^1.21.5",promptly:"^0.2.0",q:"^1.0.1",twilio:"*"},engines:{node:">=0.12"},license:"MIT","private":!0,
scripts:{test:"make test"},dependencies:{"sip.js":"^0.7.0",ws:"^0.6.3",xmlhttprequest:"https://github.com/markandrus/node-XMLHttpRequest.git"}}},{}],73:[function(k,l,n){(function(b){function h(){Object.defineProperties(this,{AccessToken:{enumerable:!0,value:f},Endpoint:{enumerable:!0,value:e},getUserMedia:{enumerable:!0,value:g},LocalMedia:{enumerable:!0,value:a}});return this}var f=k("../lib/accesstoken"),e=k("../lib/endpoint"),g=k("../lib/webrtc/getusermedia"),a=k("../lib/media").LocalMedia;(b.Twilio=
b.Twilio||new h).Endpoint||h.call(b.Twilio)}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"../lib/accesstoken":1,"../lib/endpoint":3,"../lib/media":5,"../lib/webrtc/getusermedia":25}]},{},[73]);